<?xml version="1.0"?>
<!ENTITY % article SYSTEM "http://jats.nlm.nih.gov/archiving/1.2/JATS-archivearticle1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="1.2" article-type="research-article" xml:lang="en">
      <?properties open_access?>
      <front>
        <journal-meta>
          <journal-id journal-id-type="publisher-id">13321</journal-id>
          <journal-title-group>
            <journal-title>Journal of Cheminformatics</journal-title>
            <abbrev-journal-title abbrev-type="publisher">J Cheminform</abbrev-journal-title>
          </journal-title-group>
          <issn pub-type="epub">1758-2946</issn>
          <publisher>
            <publisher-name>Springer International Publishing</publisher-name>
            <publisher-loc>Cham</publisher-loc>
          </publisher>
        </journal-meta>
        <article-meta>
          <article-id pub-id-type="publisher-id">s13321-019-0396-x</article-id>
          <article-id pub-id-type="manuscript">396</article-id>
          <article-id pub-id-type="doi">10.1186/s13321-019-0396-x</article-id>
          <article-categories>
            <subj-group subj-group-type="heading">
              <subject>Research Article</subject>
            </subj-group>
          </article-categories>
          <title-group>
            <article-title xml:lang="en">Efficient learning of non-autoregressive graph variational autoencoders for molecular graph generation</article-title>
          </title-group>
          <contrib-group>
            <contrib contrib-type="author" id="Au1">
              <name>
                <surname>Kwon</surname>
                <given-names>Youngchun</given-names>
              </name>
              <xref ref-type="aff" rid="Aff1">1</xref>
              <xref ref-type="aff" rid="Aff2">2</xref>
            </contrib>
            <contrib contrib-type="author" id="Au2">
              <name>
                <surname>Yoo</surname>
                <given-names>Jiho</given-names>
              </name>
              <xref ref-type="aff" rid="Aff1">1</xref>
            </contrib>
            <contrib contrib-type="author" id="Au3">
              <name>
                <surname>Choi</surname>
                <given-names>Youn-Suk</given-names>
              </name>
              <xref ref-type="aff" rid="Aff1">1</xref>
            </contrib>
            <contrib contrib-type="author" id="Au4">
              <name>
                <surname>Son</surname>
                <given-names>Won-Joon</given-names>
              </name>
              <xref ref-type="aff" rid="Aff1">1</xref>
            </contrib>
            <contrib contrib-type="author" id="Au5">
              <name>
                <surname>Lee</surname>
                <given-names>Dongseon</given-names>
              </name>
              <xref ref-type="aff" rid="Aff1">1</xref>
            </contrib>
            <contrib contrib-type="author" corresp="yes" id="Au6">
              <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-0960-0294</contrib-id>
              <name>
                <surname>Kang</surname>
                <given-names>Seokho</given-names>
              </name>
              <address>
                <email>HIDDEN</email>
              </address>
              <xref ref-type="aff" rid="Aff3">3</xref>
              <xref ref-type="corresp" rid="IDs133210190396x_cor6">f</xref>
            </contrib>
            <aff id="Aff1">
              <label>1</label>
              <institution-wrap>
                <institution-id institution-id-type="ISNI">0000 0001 1945 5898</institution-id>
                <institution-id institution-id-type="GRID">grid.419666.a</institution-id>
                <institution content-type="org-name">Samsung Advanced Institute of Technology, Samsung Electronics Co. Ltd.</institution>
              </institution-wrap>
              <addr-line content-type="street">130 Samsung-ro, Yeongtong-gu</addr-line>
              <addr-line content-type="city">Suwon</addr-line>
              <country country="KR">Republic of Korea</country>
            </aff>
            <aff id="Aff2">
              <label>2</label>
              <institution-wrap>
                <institution-id institution-id-type="ISNI">0000 0004 0470 5905</institution-id>
                <institution-id institution-id-type="GRID">grid.31501.36</institution-id>
                <institution content-type="org-division">Department of Computer Science and Engineering</institution>
                <institution content-type="org-name">Seoul National University</institution>
              </institution-wrap>
              <addr-line content-type="street">1 Gwanak-ro, Gwanak-gu</addr-line>
              <addr-line content-type="city">Seoul</addr-line>
              <country country="KR">Republic of Korea</country>
            </aff>
            <aff id="Aff3">
              <label>3</label>
              <institution-wrap>
                <institution-id institution-id-type="ISNI">0000 0001 2181 989X</institution-id>
                <institution-id institution-id-type="GRID">grid.264381.a</institution-id>
                <institution content-type="org-division">Department of Systems Management Engineering</institution>
                <institution content-type="org-name">Sungkyunkwan University</institution>
              </institution-wrap>
              <addr-line content-type="street">2066 Seobu-ro, Jangan-gu</addr-line>
              <addr-line content-type="city">Suwon</addr-line>
              <country country="KR">Republic of Korea</country>
            </aff>
          </contrib-group>
          <author-notes>
            <corresp id="IDs133210190396x_cor6">
              <label>f</label>
              <email>HIDDEN</email>
            </corresp>
          </author-notes>
          <pub-date date-type="pub" publication-format="electronic">
            <day>21</day>
            <month>11</month>
            <year>2019</year>
          </pub-date>
          <pub-date date-type="collection" publication-format="electronic">
            <month>12</month>
            <year>2019</year>
          </pub-date>
          <volume>11</volume>
          <issue seq="70">1</issue>
          <elocation-id>70</elocation-id>
          <history>
            <date date-type="registration">
              <day>13</day>
              <month>11</month>
              <year>2019</year>
            </date>
            <date date-type="received">
              <day>29</day>
              <month>8</month>
              <year>2019</year>
            </date>
            <date date-type="accepted">
              <day>13</day>
              <month>11</month>
              <year>2019</year>
            </date>
            <date date-type="online">
              <day>21</day>
              <month>11</month>
              <year>2019</year>
            </date>
          </history>
          <permissions>
            <copyright-statement content-type="compact">© The Author(s) 2019</copyright-statement>
            <copyright-year>2019</copyright-year>
            <copyright-holder>The Author(s)</copyright-holder>
            <license license-type="open-access" xlink:href="http://creativecommons.org/licenses/by/4.0/">
              <license-p><bold>Open Access</bold>This article is distributed under the terms of the Creative Commons Attribution 4.0 International License (<ext-link xlink:href="http://creativecommons.org/licenses/by/4.0/" ext-link-type="uri">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted use, distribution, and reproduction in any medium, provided you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The Creative Commons Public Domain Dedication waiver (http://creativecommons.org/publicdomain/zero/1.0/) applies to the data made available in this article, unless otherwise stated.</license-p>
            </license>
          </permissions>
          <abstract xml:lang="en" id="Abs1">
            <title>Abstract</title>
            <p id="Par1">With the advancements in deep learning, deep generative models combined with graph neural networks have been successfully employed for data-driven molecular graph generation. Early methods based on the non-autoregressive approach have been effective in generating molecular graphs quickly and efficiently but have suffered from low performance. In this paper, we present an improved learning method involving a graph variational autoencoder for efficient molecular graph generation in a non-autoregressive manner. We introduce three additional learning objectives and incorporate them into the training of the model: approximate graph matching, reinforcement learning, and auxiliary property prediction. We demonstrate the effectiveness of the proposed method by evaluating it for molecular graph generation tasks using QM9 and ZINC datasets. The model generates molecular graphs with high chemical validity and diversity compared with existing non-autoregressive methods. It can also conditionally generate molecular graphs satisfying various target conditions.</p>
          </abstract>
          <kwd-group xml:lang="en">
            <title>Keywords</title>
            <kwd>Molecular graph</kwd>
            <kwd>Variational autoencoder</kwd>
            <kwd>Graph neural network</kwd>
            <kwd>Deep learning</kwd>
          </kwd-group>
          <funding-group>
            <award-group>
              <funding-source>
                <institution-wrap>
                  <institution>Samsung Advanced Institute of Technology</institution>
                  <institution-id institution-id-type="doi" vocab="open-funder-registry">http://dx.doi.org/10.13039/100014553</institution-id>
                </institution-wrap>
              </funding-source>
            </award-group>
            <award-group>
              <funding-source>
                <institution-wrap>
                  <institution>National Research Foundation of Korea</institution>
                </institution-wrap>
              </funding-source>
              <award-id award-type="FundRef grant">NRF-2017R1C1B5075685</award-id>
              <award-id award-type="FundRef grant">NRF-2019R1A4A1024732</award-id>
              <principal-award-recipient>
                <name>
                  <surname>Kang</surname>
                  <given-names>Seokho</given-names>
                </name>
              </principal-award-recipient>
              <principal-award-recipient>
                <name>
                  <surname>Kang</surname>
                  <given-names>Seokho</given-names>
                </name>
              </principal-award-recipient>
            </award-group>
          </funding-group>
          <custom-meta-group>
            <custom-meta>
              <meta-name>publisher-imprint-name</meta-name>
              <meta-value>Springer</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>volume-issue-count</meta-name>
              <meta-value>1</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>issue-article-count</meta-name>
              <meta-value>0</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>issue-toc-levels</meta-name>
              <meta-value>0</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>issue-pricelist-year</meta-name>
              <meta-value>2019</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>issue-copyright-holder</meta-name>
              <meta-value>The Author(s)</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>issue-copyright-year</meta-name>
              <meta-value>2019</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-contains-esm</meta-name>
              <meta-value>No</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-numbering-style</meta-name>
              <meta-value>Unnumbered</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-registration-date-year</meta-name>
              <meta-value>2019</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-registration-date-month</meta-name>
              <meta-value>11</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-registration-date-day</meta-name>
              <meta-value>13</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-toc-levels</meta-name>
              <meta-value>0</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>toc-levels</meta-name>
              <meta-value>0</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>volume-type</meta-name>
              <meta-value>Regular</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-product</meta-name>
              <meta-value>ArchiveJournal</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>numbering-style</meta-name>
              <meta-value>Unnumbered</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-grants-type</meta-name>
              <meta-value>OpenChoice</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>metadata-grant</meta-name>
              <meta-value>OpenAccess</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>abstract-grant</meta-name>
              <meta-value>OpenAccess</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>bodypdf-grant</meta-name>
              <meta-value>OpenAccess</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>bodyhtml-grant</meta-name>
              <meta-value>OpenAccess</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>bibliography-grant</meta-name>
              <meta-value>OpenAccess</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>esm-grant</meta-name>
              <meta-value>OpenAccess</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>online-first</meta-name>
              <meta-value>false</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>pdf-file-reference</meta-name>
              <meta-value>BodyRef/PDF/13321_2019_Article_396.pdf</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>pdf-type</meta-name>
              <meta-value>Typeset</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>target-type</meta-name>
              <meta-value>OnlinePDF</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>issue-type</meta-name>
              <meta-value>Regular</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-type</meta-name>
              <meta-value>OriginalPaper</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-subject-primary</meta-name>
              <meta-value>Chemistry</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-subject-secondary</meta-name>
              <meta-value>Computer Applications in Chemistry</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-subject-secondary</meta-name>
              <meta-value>Documentation and Information in Chemistry</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-subject-secondary</meta-name>
              <meta-value>Theoretical and Computational Chemistry</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-subject-secondary</meta-name>
              <meta-value>Computational Biology/Bioinformatics</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-subject-collection</meta-name>
              <meta-value>Chemistry and Materials Science</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>open-access</meta-name>
              <meta-value>true</meta-value>
            </custom-meta>
          </custom-meta-group>
        </article-meta>
      </front>
      <body>
        <sec id="Sec1">
          <title>Introduction</title>
          <p id="Par2">In recent years, machine learning has been actively adopted to accelerate the discovery of novel molecules with desired properties [<xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR4">4</xref>]. While traditional approaches, such as manual design and enumeration [<xref ref-type="bibr" rid="CR5">5</xref>–<xref ref-type="bibr" rid="CR8">8</xref>], depend highly on domain knowledge and intuition of human experts, machine learning approaches have allowed automated design of desired molecules in a data-driven manner. Thus, they have attracted considerable attention from academia and industry. A typical way to accomplish so is to construct a generative model by learning from data to capture the underlying distribution of the data, and use it to generate new molecules [<xref ref-type="bibr" rid="CR9">9</xref>, <xref ref-type="bibr" rid="CR10">10</xref>]. The large number of known molecules that have been discovered in the past can be a valuable source for the data [<xref ref-type="bibr" rid="CR11">11</xref>, <xref ref-type="bibr" rid="CR12">12</xref>]. Although this research area is currently in the incipient stage and remains challenging, studies are increasingly performed, demonstrating improved effectiveness.</p>
          <p id="Par3">The main consideration is how to represent molecules to be processed within a model and to be generated by a model. Various types of molecular representations can be considered. Among them, most existing studies have employed a simplified molecular-input line-entry system (SMILES) [<xref ref-type="bibr" rid="CR13">13</xref>] to represent molecules. SMILES is a line notation that encodes its graph structure via depth-first traversal into a sequence of symbols with a simple vocabulary and grammar rules. There have been implemented deep generative models based on a recurrent neural network (RNN), which learn a generative distribution from data to produce a SMILES string from a latent vector. They include RNN language models [<xref ref-type="bibr" rid="CR14">14</xref>–<xref ref-type="bibr" rid="CR17">17</xref>], variational autoencoders (VAEs) [<xref ref-type="bibr" rid="CR18">18</xref>–<xref ref-type="bibr" rid="CR21">21</xref>] and generative adversarial networks (GANs) [<xref ref-type="bibr" rid="CR22">22</xref>, <xref ref-type="bibr" rid="CR23">23</xref>]. To conditionally generate SMILES strings with specified target properties, additional optimization procedures have been adopted along with the generative models, including Bayesian optimization [<xref ref-type="bibr" rid="CR18">18</xref>] and reinforcement learning [<xref ref-type="bibr" rid="CR14">14</xref>, <xref ref-type="bibr" rid="CR15">15</xref>, <xref ref-type="bibr" rid="CR22">22</xref>, <xref ref-type="bibr" rid="CR23">23</xref>]. Conditional generative models, which directly sample new SMILES strings from a conditional generative distribution without any extra optimization procedure, have also been presented for targeted generation [<xref ref-type="bibr" rid="CR19">19</xref>, <xref ref-type="bibr" rid="CR24">24</xref>].</p>
          <p id="Par4">SMILES representation has proven useful in learning generative models for molecular design tasks owing to its simplicity. However, several limitations hinder the generation of chemically valid molecules. This representation cannot fully represent the entire chemical space, but only a part of the chemical space can be represented as SMILES strings. It is inadequate to capture the similarity between molecules, because a small perturbation in a molecule may result in a significant change in the representation. To address such limitations, numerous research attempts have been made to generate molecular graphs directly using generative models. A molecular graph <inline-formula id="IEq1"><alternatives><mml:math id="IEq1_Math"><mml:mi mathvariant="script">G</mml:mi></mml:math><tex-math id="IEq1_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {G}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq1.gif" /></alternatives></inline-formula> is a natural representation of a molecule, which is expressed as an undirected graph of varying size whose nodes and edges correspond to atoms and bonds, respectively. This representation provides high coverage of the chemical space, and can convey various chemical features within it.</p>
          <p id="Par5">With recent advances in graph neural networks [<xref ref-type="bibr" rid="CR25">25</xref>–<xref ref-type="bibr" rid="CR27">27</xref>], various methods for extending deep generative models to molecular graph generation have been proposed. They can be categorized into two main approaches: non-autoregressive and autoregressive. The non-autoregressive approach allows more principled use of generative models, generating a molecular graph <inline-formula id="IEq2"><alternatives><mml:math id="IEq2_Math"><mml:mi mathvariant="script">G</mml:mi></mml:math><tex-math id="IEq2_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {G}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq2.gif" /></alternatives></inline-formula> directly from a latent vector <inline-formula id="IEq3"><alternatives><mml:math id="IEq3_Math"><mml:mi mathvariant="bold">z</mml:mi></mml:math><tex-math id="IEq3_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {z}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq3.gif" /></alternatives></inline-formula> using a non-autoregressive distribution <inline-formula id="IEq4"><alternatives><mml:math id="IEq4_Math"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><tex-math id="IEq4_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p({\mathcal {G}}|{\mathbf {z}})$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq4.gif" /></alternatives></inline-formula> without any iterative procedure. Few methods based on this approach have been presented, owing to the challenge imposed by graph isomorphism, meaning that a molecular graph is invariant to permutations of its nodes. Notably, Simonovsky and Komodakis [<xref ref-type="bibr" rid="CR28">28</xref>] presented a non-autoregressive VAE that generates molecular graphs, named GraphVAE. Its training requires calculating the reconstruction loss for generated graphs. The problem of graph isomorphism is addressed by a graph matching procedure that entails expensive computation. De Cao and Kipf [<xref ref-type="bibr" rid="CR29">29</xref>] sidestepped graph isomorphism by using a non-autoregressive GAN for molecular graph generation, named MolGAN. Its training however suffers from the mode-collapse problem, thus less diverse molecular graphs are generated. The non-autoregressive approach successfully generates small molecular graphs in a very fast and efficient manner but suffers from difficulty in model training and a low validity ratio when generating larger graphs. Owing to such limitations, the autoregressive approach, which aims at sequentially generating a molecular graph node by node using an autoregressive distribution, has been a main research direction [<xref ref-type="bibr" rid="CR30">30</xref>–<xref ref-type="bibr" rid="CR33">33</xref>]. These methods successfully generate molecular graphs with a high validity ratio, while involves an iterative procedure for each generation which makes them less efficient.</p>
          <p id="Par6">This work focuses on the non-autoregressive approach for fast and efficient generation of molecular graphs. Here we propose an efficient learning method to train a VAE that generates molecular graphs in a non-autoregressive manner. To improve the molecular graph generation, we train the VAE by incorporating three additional learning objectives: approximate graph matching, reinforcement learning, and auxiliary property prediction. The trained VAE can almost always generate chemically valid molecular graphs with improved diversity compared with existing non-autoregressive methods. The proposed method also allows constrained generation of molecular graphs with specified target properties.</p>
        </sec>
        <sec id="Sec2" sec-type="methods">
          <title>Methods</title>
          <sec id="Sec3">
            <title>Molecules as graphs</title>
            <p id="Par7">In this work, we use the molecular graph representation defined as follows. A molecule is represented by an undirected graph <inline-formula id="IEq5"><alternatives><mml:math id="IEq5_Math"><mml:mrow><mml:mi mathvariant="script">G</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">V</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="script">E</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><tex-math id="IEq5_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {G}}=({\mathcal {V}},{\mathcal {E}})$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq5.gif" /></alternatives></inline-formula> with up to <italic>m</italic> nodes, where <inline-formula id="IEq6"><alternatives><mml:math id="IEq6_Math"><mml:mi mathvariant="script">V</mml:mi></mml:math><tex-math id="IEq6_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {V}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq6.gif" /></alternatives></inline-formula> and <inline-formula id="IEq7"><alternatives><mml:math id="IEq7_Math"><mml:mi mathvariant="script">E</mml:mi></mml:math><tex-math id="IEq7_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {E}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq7.gif" /></alternatives></inline-formula> represent the set of nodes and the set of edges, respectively. The node vectors <inline-formula id="IEq8"><alternatives><mml:math id="IEq8_Math"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">v</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>∈</mml:mo><mml:mi mathvariant="script">V</mml:mi></mml:mrow></mml:math><tex-math id="IEq8_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {v}}^i \in {\mathcal {V}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq8.gif" /></alternatives></inline-formula> and edge vectors <inline-formula id="IEq9"><alternatives><mml:math id="IEq9_Math"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">e</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msup><mml:mo>∈</mml:mo><mml:mi mathvariant="script">E</mml:mi></mml:mrow></mml:math><tex-math id="IEq9_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {e}}^{i,j} \in {\mathcal {E}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq9.gif" /></alternatives></inline-formula> are associated with heavy atoms and their bonds, respectively, in the molecule. It should be noted that <inline-formula id="IEq10"><alternatives><mml:math id="IEq10_Math"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">e</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">e</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math><tex-math id="IEq10_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {e}}^{i,j}={\mathbf {e}}^{j,i}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq10.gif" /></alternatives></inline-formula> because we use an undirected graph. For the <italic>i</italic>-th atom, <inline-formula id="IEq11"><alternatives><mml:math id="IEq11_Math"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">v</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>v</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msup><mml:mi>v</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>p</mml:mi></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq11_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {v}}^i=(v^{i,1},\ldots ,v^{i,p})$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq11.gif" /></alternatives></inline-formula> is a <italic>p</italic>-dimensional vector formed by concatenating three one-hot vectors indicating the atom type, formal charge, and number of explicit hydrogens. The dimension <italic>p</italic> depends on the dataset used. For the bond between the <italic>i</italic>-th and <italic>j</italic>-th atoms, <inline-formula id="IEq12"><alternatives><mml:math id="IEq12_Math"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">e</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>q</mml:mi></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq12_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {e}}^{i,j}=(e^{i,j,1},\ldots ,e^{i,j,q})$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq12.gif" /></alternatives></inline-formula> is a <italic>q</italic>-dimensional one-hot vector associated with the bond type. We kekulize the molecule for simplicity so that the only bond types to consider are single, double, triple, and none, hence <inline-formula id="IEq13"><alternatives><mml:math id="IEq13_Math"><mml:mrow><mml:mi>q</mml:mi><mml:mo>=</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:math><tex-math id="IEq13_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$q=4$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq13.gif" /></alternatives></inline-formula>. Additionally, the properties of the molecule are represented as a property vector <inline-formula id="IEq14"><alternatives><mml:math id="IEq14_Math"><mml:mrow><mml:mi mathvariant="bold">y</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>y</mml:mi><mml:mn>1</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msup><mml:mi>y</mml:mi><mml:mi>l</mml:mi></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><tex-math id="IEq14_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {y}}=(y^1,\ldots ,y^l)$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq14.gif" /></alternatives></inline-formula>.</p>
          </sec>
          <sec id="Sec4">
            <title>Graph variational autoencoder</title>
            <p id="Par8">We construct a conditional version of the graph VAE [<xref ref-type="bibr" rid="CR34">34</xref>] in a non-autoregressive manner. It seeks to find the generative distribution of <inline-formula id="IEq15"><alternatives><mml:math id="IEq15_Math"><mml:mi mathvariant="script">G</mml:mi></mml:math><tex-math id="IEq15_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {G}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq15.gif" /></alternatives></inline-formula> conditioned on a latent vector <inline-formula id="IEq16"><alternatives><mml:math id="IEq16_Math"><mml:mi mathvariant="bold">z</mml:mi></mml:math><tex-math id="IEq16_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {z}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq16.gif" /></alternatives></inline-formula> and a property vector <inline-formula id="IEq17"><alternatives><mml:math id="IEq17_Math"><mml:mi mathvariant="bold">y</mml:mi></mml:math><tex-math id="IEq17_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {y}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq17.gif" /></alternatives></inline-formula> and parameterized by <inline-formula id="IEq18"><alternatives><mml:math id="IEq18_Math"><mml:mi>θ</mml:mi></mml:math><tex-math id="IEq18_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\theta $$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq18.gif" /></alternatives></inline-formula>, denoted as <inline-formula id="IEq19"><alternatives><mml:math id="IEq19_Math"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>θ</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq19_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p_\theta ({\mathcal {G}}|{\mathbf {z}},{\mathbf {y}})$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq19.gif" /></alternatives></inline-formula>. The prior distributions of <inline-formula id="IEq20"><alternatives><mml:math id="IEq20_Math"><mml:mi mathvariant="bold">z</mml:mi></mml:math><tex-math id="IEq20_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {z}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq20.gif" /></alternatives></inline-formula> and <inline-formula id="IEq21"><alternatives><mml:math id="IEq21_Math"><mml:mi mathvariant="bold">y</mml:mi></mml:math><tex-math id="IEq21_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {y}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq21.gif" /></alternatives></inline-formula> are assumed to be <inline-formula id="IEq22"><alternatives><mml:math id="IEq22_Math"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi mathvariant="script">N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mn mathvariant="bold">0</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="bold">I</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><tex-math id="IEq22_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p({\mathbf {z}})={\mathcal {N}}({\mathbf {z}}|{\mathbf {0}},{\mathbf {I}})$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq22.gif" /></alternatives></inline-formula> and <inline-formula id="IEq23"><alternatives><mml:math id="IEq23_Math"><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="script">N</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi mathvariant="bold">y</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mi mathvariant="bold">y</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq23_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p({\mathbf {y}})={\mathcal {N}}({\mathbf {y}}|\varvec{\mu }_{\mathbf {y}},\varvec{\Sigma }_{\mathbf {y}})$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq23.gif" /></alternatives></inline-formula>, respectively. To address the intractability of the posterior distribution <inline-formula id="IEq24"><alternatives><mml:math id="IEq24_Math"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>θ</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq24_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p_\theta ({\mathbf {z}}|{\mathcal {G}},{\mathbf {y}})$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq24.gif" /></alternatives></inline-formula>, we introduce an approximate posterior distribution <inline-formula id="IEq25"><alternatives><mml:math id="IEq25_Math"><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>ϕ</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="script">N</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:msub><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mtext>diag</mml:mtext><mml:mo stretchy="false">(</mml:mo></mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mi mathvariant="bold">z</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq25_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$q_\phi ({\mathbf {z}}|{\mathcal {G}},{\mathbf {y}})={\mathcal {N}}({\mathbf {z}}|{\varvec{\mu }_{\mathbf {z}}({\mathcal {G}},{\mathbf {y}}), \text {diag}(\varvec{\sigma }^2_{\mathbf {z}}({\mathcal {G}},{\mathbf {y}})}))$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq25.gif" /></alternatives></inline-formula>, which has a normal distribution and is parameterized by <inline-formula id="IEq26"><alternatives><mml:math id="IEq26_Math"><mml:mi>ϕ</mml:mi></mml:math><tex-math id="IEq26_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\phi $$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq26.gif" /></alternatives></inline-formula>.</p>
            <p id="Par9">The distributions <inline-formula id="IEq27"><alternatives><mml:math id="IEq27_Math"><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>ϕ</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq27_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$q_\phi ({\mathbf {z}}|{\mathcal {G}},{\mathbf {y}})$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq27.gif" /></alternatives></inline-formula> and <inline-formula id="IEq28"><alternatives><mml:math id="IEq28_Math"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>θ</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq28_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p_\theta ({\mathcal {G}}|{\mathbf {z}},{\mathbf {y}})$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq28.gif" /></alternatives></inline-formula> are called the encoder and decoder of the VAE, respectively. For the encoder, we use a message passing neural network (MPNN) [<xref ref-type="bibr" rid="CR27">27</xref>], which is a variant of a graph neural network that operates directly on graphs of different sizes and is invariant to graph isomorphism. The encoder takes <inline-formula id="IEq29"><alternatives><mml:math id="IEq29_Math"><mml:mi mathvariant="script">G</mml:mi></mml:math><tex-math id="IEq29_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {G}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq29.gif" /></alternatives></inline-formula> and <inline-formula id="IEq30"><alternatives><mml:math id="IEq30_Math"><mml:mi mathvariant="bold">y</mml:mi></mml:math><tex-math id="IEq30_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {y}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq30.gif" /></alternatives></inline-formula> and outputs the mean vector <inline-formula id="IEq31"><alternatives><mml:math id="IEq31_Math"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq31_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{\mu }_{\mathbf {z}}({\mathcal {G}},{\mathbf {y}})$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq31.gif" /></alternatives></inline-formula> and variance vector <inline-formula id="IEq32"><alternatives><mml:math id="IEq32_Math"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mi mathvariant="bold">z</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq32_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{\sigma }^2_{\mathbf {z}}({\mathcal {G}},{\mathbf {y}})$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq32.gif" /></alternatives></inline-formula>, from which <inline-formula id="IEq33"><alternatives><mml:math id="IEq33_Math"><mml:mi mathvariant="bold">z</mml:mi></mml:math><tex-math id="IEq33_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {z}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq33.gif" /></alternatives></inline-formula> is sampled based on reparametrization as <inline-formula id="IEq34"><alternatives><mml:math id="IEq34_Math"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">ϵ</mml:mi></mml:mrow><mml:mo>⊙</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mi mathvariant="bold">z</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq34_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{\mu }_{\mathbf {z}}({\mathcal {G}},{\mathbf {y}})+\varvec{\epsilon } \odot \varvec{\sigma }^2_{\mathbf {z}}({\mathcal {G}},{\mathbf {y}})$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq34.gif" /></alternatives></inline-formula> with <inline-formula id="IEq35"><alternatives><mml:math id="IEq35_Math"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">ϵ</mml:mi></mml:mrow><mml:mo>∼</mml:mo><mml:mi mathvariant="script">N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn mathvariant="bold">0</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="bold">I</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><tex-math id="IEq35_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varvec{\epsilon } \sim {\mathcal {N}}({\mathbf {0}},{\mathbf {I}})$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq35.gif" /></alternatives></inline-formula>. The decoder is modeled as a fully-connected neural network that outputs <inline-formula id="IEq36"><alternatives><mml:math id="IEq36_Math"><mml:mrow><mml:mi>m</mml:mi><mml:mi>p</mml:mi><mml:mo>+</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mi>q</mml:mi><mml:mo stretchy="false">/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math><tex-math id="IEq36_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$mp+m(m-1)q/2$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq36.gif" /></alternatives></inline-formula> values at once from <inline-formula id="IEq37"><alternatives><mml:math id="IEq37_Math"><mml:mi mathvariant="bold">z</mml:mi></mml:math><tex-math id="IEq37_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {z}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq37.gif" /></alternatives></inline-formula> and <inline-formula id="IEq38"><alternatives><mml:math id="IEq38_Math"><mml:mi mathvariant="bold">y</mml:mi></mml:math><tex-math id="IEq38_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {y}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq38.gif" /></alternatives></inline-formula> with node-wise and edge-wise softmax activation. The output values form a probabilistic graph <inline-formula id="IEq39"><alternatives><mml:math id="IEq39_Math"><mml:mrow><mml:mi>g</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><tex-math id="IEq39_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$g({\mathbf {z}},{\mathbf {y}})$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq39.gif" /></alternatives></inline-formula> composed of <italic>m</italic> nodes and <inline-formula id="IEq40"><alternatives><mml:math id="IEq40_Math"><mml:mrow><mml:mi>m</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math><tex-math id="IEq40_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$m(m-1)/2$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq40.gif" /></alternatives></inline-formula> edges.</p>
            <p id="Par10">The original learning objective of the VAE is given with respect the parameters <inline-formula id="IEq41"><alternatives><mml:math id="IEq41_Math"><mml:mi>ϕ</mml:mi></mml:math><tex-math id="IEq41_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\phi $$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq41.gif" /></alternatives></inline-formula> and <inline-formula id="IEq42"><alternatives><mml:math id="IEq42_Math"><mml:mi>θ</mml:mi></mml:math><tex-math id="IEq42_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\theta $$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq42.gif" /></alternatives></inline-formula> as:<disp-formula id="Equ1"><label>1</label><alternatives><mml:math display="block" id="Equ1_Math"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi mathvariant="script">L</mml:mi><mml:mtext>VAE</mml:mtext></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϕ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi mathvariant="double-struck">E</mml:mi><mml:mrow><mml:mi mathvariant="bold">z</mml:mi><mml:mo>∼</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>ϕ</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mfenced close="]" open="[" separators=""><mml:mo>-</mml:mo><mml:mo>log</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>θ</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:msub><mml:mi mathvariant="script">D</mml:mi><mml:mtext>KL</mml:mtext></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo></mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>ϕ</mml:mi></mml:msub><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><tex-math id="Equ1_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} {\mathcal {L}}_\text {VAE} (\phi ,\theta ) = {\mathbb {E}}_{{\mathbf {z}} \sim q_\phi ({\mathbf {z}}|{\mathcal {G}},{\mathbf {y}})} \left[ -\log p_\theta ({\mathcal {G}}|{\mathbf {z}},{\mathbf {y}}) \right] + {\mathcal {D}}_\text {KL}(q_\phi ({\mathbf {z}}|{\mathcal {G}},{\mathbf {y}})|| p({\mathbf {z}}) ), \end{aligned}$$\end{document}</tex-math><graphic position="anchor" xlink:href="13321_2019_396_Article_Equ1.gif" /></alternatives></disp-formula>where the first and second terms on the right-hand side are regarded as the reconstruction loss and regularization loss, respectively. Owing to graph isomorphism, the calculation of the reconstruction loss necessitates a graph matching procedure that involves comparing an input graph and its probabilistic reconstruction which is computationally expensive. For example, the max-pooling matching algorithm has computational complexity of <inline-formula id="IEq43"><alternatives><mml:math id="IEq43_Math"><mml:mrow><mml:mi mathvariant="script">O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>m</mml:mi><mml:mn>4</mml:mn></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><tex-math id="IEq43_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {O}}(m^4)$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq43.gif" /></alternatives></inline-formula> [<xref ref-type="bibr" rid="CR28">28</xref>].</p>
            <p id="Par11">To make the learning more efficient, we introduce an approximate graph matching procedure, which aims to alleviate the computational burden for the reconstruction loss. Additionally, we incorporate reinforcement learning and auxiliary property prediction into the training of the VAE to further improve the generation performance. Details regarding the learning objectives utilized in this work are presented in the following subsection.</p>
          </sec>
          <sec id="Sec5">
            <title>Approximate graph matching</title>
            <p id="Par12">The reconstruction loss <inline-formula id="IEq44"><alternatives><mml:math id="IEq44_Math"><mml:mrow><mml:msub><mml:mi mathvariant="double-struck">E</mml:mi><mml:mrow><mml:mi mathvariant="bold">z</mml:mi><mml:mo>∼</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>ϕ</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mfenced close="]" open="[" separators=""><mml:mo>-</mml:mo><mml:mo>log</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>θ</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfenced></mml:mrow></mml:math><tex-math id="IEq44_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbb {E}}_{{\mathbf {z}} \sim q_\phi ({\mathbf {z}}|{\mathcal {G}},{\mathbf {y}})} \left[ -\log p_\theta ({\mathcal {G}}|{\mathbf {z}},{\mathbf {y}}) \right] $$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq44.gif" /></alternatives></inline-formula> involves comparing an original input graph <inline-formula id="IEq45"><alternatives><mml:math id="IEq45_Math"><mml:mrow><mml:mi mathvariant="script">G</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">V</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="script">E</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><tex-math id="IEq45_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {G}}=({\mathcal {V}},{\mathcal {E}})$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq45.gif" /></alternatives></inline-formula> and its reconstruction by the VAE. In this subsection, we denote the reconstruction of <inline-formula id="IEq46"><alternatives><mml:math id="IEq46_Math"><mml:mi mathvariant="script">G</mml:mi></mml:math><tex-math id="IEq46_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {G}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq46.gif" /></alternatives></inline-formula> as a probabilistic graph <inline-formula id="IEq47"><alternatives><mml:math id="IEq47_Math"><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="true">~</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi mathvariant="script">V</mml:mi><mml:mo stretchy="true">~</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mi mathvariant="script">E</mml:mi><mml:mo stretchy="true">~</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq47_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\widetilde{{\mathcal {G}}}=(\widetilde{{\mathcal {V}}},\widetilde{{\mathcal {E}}})$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq47.gif" /></alternatives></inline-formula>, where <inline-formula id="IEq48"><alternatives><mml:math id="IEq48_Math"><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi mathvariant="bold">v</mml:mi><mml:mo stretchy="true">~</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msup><mml:mo>∈</mml:mo><mml:mover accent="true"><mml:mi mathvariant="script">V</mml:mi><mml:mo stretchy="true">~</mml:mo></mml:mover></mml:mrow></mml:math><tex-math id="IEq48_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\widetilde{{\mathbf {v}}}^i \in \widetilde{{\mathcal {V}}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq48.gif" /></alternatives></inline-formula> and <inline-formula id="IEq49"><alternatives><mml:math id="IEq49_Math"><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi mathvariant="bold">e</mml:mi><mml:mo stretchy="true">~</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msup><mml:mo>∈</mml:mo><mml:mover accent="true"><mml:mi mathvariant="script">E</mml:mi><mml:mo stretchy="true">~</mml:mo></mml:mover></mml:mrow></mml:math><tex-math id="IEq49_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\widetilde{{\mathbf {e}}}^{i,j} \in \widetilde{{\mathcal {E}}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq49.gif" /></alternatives></inline-formula>. Because the reconstruction loss must be invariant to graph isomorphism, a graph matching procedure that seeks the best possible matching between the two graphs is needed. To avoid expensive computation, we propose to use approximate graph matching. The main idea is to approximate the distance between <inline-formula id="IEq50"><alternatives><mml:math id="IEq50_Math"><mml:mi mathvariant="script">G</mml:mi></mml:math><tex-math id="IEq50_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {G}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq50.gif" /></alternatives></inline-formula> and <inline-formula id="IEq51"><alternatives><mml:math id="IEq51_Math"><mml:mover accent="true"><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="true">~</mml:mo></mml:mover></mml:math><tex-math id="IEq51_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\widetilde{{\mathcal {G}}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq51.gif" /></alternatives></inline-formula> by comparing the numbers of atom types, bond types, atom-bond pair types, and atom-bond-atom pair types.</p>
            <p id="Par13">Assuming that each edge vector is represented as a four-dimensional vector as <inline-formula id="IEq52"><alternatives><mml:math id="IEq52_Math"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">e</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="monospace">single</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="monospace">double</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="monospace">triple</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="monospace">none</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq52_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {e}}^{i,j}=(e^{i,j(\texttt {single})},e^{i,j(\texttt {double})},e^{i,j(\texttt {triple})},e^{i,j(\texttt {none})})$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq52.gif" /></alternatives></inline-formula>, the reconstruction loss is approximated as follows:<disp-formula id="Equ2"><label>2</label><alternatives><mml:math display="block" id="Equ2_Math"><mml:mrow><mml:mtable><mml:mtr><mml:mtd /><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mi mathvariant="double-struck">E</mml:mi><mml:mrow><mml:mi mathvariant="bold">z</mml:mi><mml:mo>∼</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>ϕ</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mfenced close="]" open="[" separators=""><mml:mo>-</mml:mo><mml:mo>log</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>θ</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfenced><mml:mo>≃</mml:mo><mml:msup><mml:mfenced close="∥" open="∥" separators=""><mml:mfenced close=")" open="(" separators=""><mml:munder><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:munder><mml:msup><mml:mrow><mml:mi mathvariant="bold">v</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup></mml:mfenced><mml:mo>-</mml:mo><mml:mfenced close=")" open="(" separators=""><mml:munder><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:munder><mml:msup><mml:mover accent="true"><mml:mi mathvariant="bold">v</mml:mi><mml:mo stretchy="true">~</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msup></mml:mfenced></mml:mfenced><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mrow /></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mspace width="1em" /><mml:mo>+</mml:mo><mml:msup><mml:mfenced close="∥" open="∥" separators=""><mml:mfenced close=")" open="(" separators=""><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mi mathvariant="bold">e</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msup></mml:mfenced><mml:mo>-</mml:mo><mml:mfenced close=")" open="(" separators=""><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:munder><mml:msup><mml:mover accent="true"><mml:mi mathvariant="bold">e</mml:mi><mml:mo stretchy="false">~</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msup></mml:mfenced></mml:mfenced><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mrow /></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mspace width="1em" /><mml:mo>+</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi mathvariant="monospace">b</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mi mathvariant="monospace">single</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="monospace">double</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="monospace">triple</mml:mi><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:msup><mml:mfenced close="∥" open="∥" separators=""><mml:mfenced close=")" open="(" separators=""><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="monospace">b</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">v</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup></mml:mrow></mml:mfenced><mml:mo>-</mml:mo><mml:mfenced close=")" open="(" separators=""><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msup><mml:mrow><mml:mover accent="true"><mml:mi>e</mml:mi><mml:mo stretchy="false">~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="monospace">b</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="bold">v</mml:mi><mml:mo stretchy="true">~</mml:mo></mml:mover></mml:mrow><mml:mi>i</mml:mi></mml:msup></mml:mrow></mml:mfenced></mml:mfenced><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mrow /></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mspace width="1em" /><mml:mo>+</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi mathvariant="monospace">b</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mi mathvariant="monospace">single</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="monospace">double</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="monospace">triple</mml:mi><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:msup><mml:mfenced close="∥" open="∥" separators=""><mml:mfenced close=")" open="(" separators=""><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="monospace">b</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">v</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">v</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">jT</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>-</mml:mo><mml:mfenced close=")" open="(" separators=""><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msup><mml:mrow><mml:mover accent="true"><mml:mi>e</mml:mi><mml:mo stretchy="false">~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="monospace">b</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="bold">v</mml:mi><mml:mo stretchy="true">~</mml:mo></mml:mover></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:msup><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="bold">v</mml:mi><mml:mo stretchy="true">~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi mathvariant="italic">jT</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mfenced><mml:mn>2</mml:mn></mml:msup><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><tex-math id="Equ2_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned}&amp;{\mathbb {E}}_{{\mathbf {z}} \sim q_\phi ({\mathbf {z}}|{\mathcal {G}},{\mathbf {y}})} \left[ -\log p_\theta ({\mathcal {G}}|{\mathbf {z}},{\mathbf {y}}) \right] \simeq \left\| \left( \sum _i{{\mathbf {v}}^i}\right) - \left( \sum _i{\widetilde{{\mathbf {v}}}^i}\right) \right\| ^2 \nonumber \\&amp;\quad + \left\| \left( \sum _{i,j}{{\mathbf {e}}^{i,j}}\right) - \left( \sum _{i,j}{\tilde{{\mathbf {e}}}^{i,j}}\right) \right\| ^2\nonumber \\&amp;\quad + \sum _{\texttt {b}\in {\{\texttt {single},\texttt {double},\texttt {triple}\}}} \left\| \left( \sum _{i,j}{e^{i,j (\texttt {b})}{\mathbf {v}}^i }\right) - \left( \sum _{i,j}{{\tilde{e}}^{i,j (\texttt {b})}\mathbf {{\widetilde{v}}}^i }\right) \right\| ^2\nonumber \\&amp;\quad + \sum _{\texttt {b}\in {\{\texttt {single},\texttt {double},\texttt {triple}\}}} \left\| \left( \sum _{i,j}{e^{i,j (\texttt {b})}{\mathbf {v}}^i {{\mathbf {v}}^{jT}}}\right) - \left( \sum _{i,j}{ {\tilde{e}}^{i,j (\texttt {b})}\mathbf {{\widetilde{v}}}^i {\mathbf {{\widetilde{v}}}^{jT}}}\right) \right\| ^2, \end{aligned}$$\end{document}</tex-math><graphic position="anchor" xlink:href="13321_2019_396_Article_Equ2.gif" /></alternatives></disp-formula>where <inline-formula id="IEq53"><alternatives><mml:math id="IEq53_Math"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">v</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>∈</mml:mo><mml:mi mathvariant="script">V</mml:mi></mml:mrow></mml:math><tex-math id="IEq53_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\mathbf {v}}}^i \in {{\mathcal {V}}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq53.gif" /></alternatives></inline-formula>, <inline-formula id="IEq54"><alternatives><mml:math id="IEq54_Math"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">e</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msup><mml:mo>∈</mml:mo><mml:mi mathvariant="script">E</mml:mi></mml:mrow></mml:math><tex-math id="IEq54_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\mathbf {e}}}^{i,j} \in {{\mathcal {E}}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq54.gif" /></alternatives></inline-formula>, <inline-formula id="IEq55"><alternatives><mml:math id="IEq55_Math"><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi mathvariant="bold">v</mml:mi><mml:mo stretchy="true">~</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msup><mml:mo>∈</mml:mo><mml:mover accent="true"><mml:mi mathvariant="script">V</mml:mi><mml:mo stretchy="true">~</mml:mo></mml:mover></mml:mrow></mml:math><tex-math id="IEq55_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\widetilde{{\mathbf {v}}}^i \in \widetilde{{\mathcal {V}}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq55.gif" /></alternatives></inline-formula>, and <inline-formula id="IEq56"><alternatives><mml:math id="IEq56_Math"><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi mathvariant="bold">e</mml:mi><mml:mo stretchy="true">~</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msup><mml:mo>∈</mml:mo><mml:mover accent="true"><mml:mi mathvariant="script">E</mml:mi><mml:mo stretchy="true">~</mml:mo></mml:mover></mml:mrow></mml:math><tex-math id="IEq56_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\widetilde{{\mathbf {e}}}^{i,j} \in \widetilde{{\mathcal {E}}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq56.gif" /></alternatives></inline-formula>. When calculating the approximated reconstruction loss, we discard the non-atom and non-bond types from the vectors. The first, second, third, and fourth terms on the right-hand side correspond to the comparison of the numbers of atom types, bond types, atom-bond pair types, and atom-bond-atom pair types, respectively. They are independent of node ordering because they summate over the nodes in a graph, and are thus invariant to graph isomorphism. All the operations in the above equation are differentiable.</p>
          </sec>
          <sec id="Sec6">
            <title>Reinforcement learning</title>
            <p id="Par14">We further improve the VAE via reinforcement learning with the aim of generating chemically valid molecules. We adopt a deterministic policy gradient framework, in which the decoder of the VAE is regarded as a policy network that takes the two vectors <inline-formula id="IEq57"><alternatives><mml:math id="IEq57_Math"><mml:mi mathvariant="bold">z</mml:mi></mml:math><tex-math id="IEq57_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {z}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq57.gif" /></alternatives></inline-formula> and <inline-formula id="IEq58"><alternatives><mml:math id="IEq58_Math"><mml:mi mathvariant="bold">y</mml:mi></mml:math><tex-math id="IEq58_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {y}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq58.gif" /></alternatives></inline-formula> as state inputs. It outputs a probabilistic graph as an action from the state. The reward for the action is the chemical validity of the probabilistic graph, which is evaluated using an external reward function <italic>R</italic>. The reward function returns 1 if the probabilistic graph can be decoded into a chemically valid molecular graph and 0 otherwise. In this work, the chemical validity of a molecular graph <inline-formula id="IEq59"><alternatives><mml:math id="IEq59_Math"><mml:mi mathvariant="script">G</mml:mi></mml:math><tex-math id="IEq59_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {G}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq59.gif" /></alternatives></inline-formula> is evaluated via a sanitization check. With the reward function, the policy network learns how to generate a probabilistic graph that fulfills the expected reward of 1.</p>
            <p id="Par15">We wish to optimize the molecular graph generation of the VAE for maximizing the external reward function <italic>R</italic>. Because the reward function is non-differentiable, it cannot be incorporated directly into the learning procedure. We build a reward network <italic>r</italic> that approximates the reward function <italic>R</italic>. The reward network is modeled as an MPNN with a sigmoid output. It takes a probabilistic graph as input and predicts its actual reward value. The reward network can backpropagate the VAE. We train the VAE to generate a probabilistic graph towards maximizing the output of the reward network.</p>
            <p id="Par16">For the learning objective, we derive two additional losses <inline-formula id="IEq60"><alternatives><mml:math id="IEq60_Math"><mml:mrow><mml:msub><mml:mi mathvariant="script">L</mml:mi><mml:mtext>RL</mml:mtext></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϕ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq60_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {L}}_\text {RL} (\phi ,\theta )$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq60.gif" /></alternatives></inline-formula> and <inline-formula id="IEq61"><alternatives><mml:math id="IEq61_Math"><mml:mrow><mml:msub><mml:mi mathvariant="script">L</mml:mi><mml:mtext>RL</mml:mtext></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq61_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\mathcal {L}}_\text {RL} (r)}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq61.gif" /></alternatives></inline-formula> as:<disp-formula id="Equ3"><label>3</label><alternatives><mml:math display="block" id="Equ3_Math"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi mathvariant="script">L</mml:mi><mml:mtext>RL</mml:mtext></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϕ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo><mml:mrow /><mml:msub><mml:mi mathvariant="double-struck">E</mml:mi><mml:mrow><mml:mi mathvariant="bold">z</mml:mi><mml:mo>∼</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>ϕ</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:msub><mml:mi mathvariant="double-struck">E</mml:mi><mml:mrow><mml:mi mathvariant="script">G</mml:mi><mml:mo>∼</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>θ</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mo>-</mml:mo><mml:mo>log</mml:mo><mml:mi>r</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mrow /></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mspace width="1em" /><mml:mo>+</mml:mo><mml:msub><mml:mi mathvariant="double-struck">E</mml:mi><mml:mrow><mml:mi mathvariant="bold">z</mml:mi><mml:mo>∼</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo>∼</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mi mathvariant="double-struck">E</mml:mi><mml:mrow><mml:mi mathvariant="script">G</mml:mi><mml:mo>∼</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>θ</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mo>-</mml:mo><mml:mo>log</mml:mo><mml:mi>r</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo></mml:mrow><mml:mo>;</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><tex-math id="Equ3_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} {{\mathcal {L}}_\text {RL} (\phi ,\theta )} &amp; =  {} {\mathbb {E}}_{{\mathbf {z}} \sim q_\phi ({\mathbf {z}}|{\mathcal {G}},{\mathbf {y}})}{\mathbb {E}}_{{\mathcal {G}} \sim p_\theta ({\mathcal {G}}|{\mathbf {z}},{\mathbf {y}})}{[-\log r({\mathcal {G}}) ]} \nonumber \\ &amp; \quad + {\mathbb {E}}_{{\mathbf {z}} \sim p({\mathbf {z}}), {\mathbf {y}} \sim p({\mathbf {y}})}{\mathbb {E}}_{{\mathcal {G}} \sim p_\theta ({\mathcal {G}}|{\mathbf {z}},{\mathbf {y}})}{[-\log r({\mathcal {G}})]}; \end{aligned}$$\end{document}</tex-math><graphic position="anchor" xlink:href="13321_2019_396_Article_Equ3.gif" /></alternatives></disp-formula><disp-formula id="Equ4"><label>4</label><alternatives><mml:math display="block" id="Equ4_Math"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi mathvariant="script">L</mml:mi><mml:mtext>RL</mml:mtext></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo><mml:mrow /><mml:mrow><mml:mo>-</mml:mo><mml:mi>R</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>log</mml:mo><mml:mi>r</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>-</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>R</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>log</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>r</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mrow /></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mspace width="1em" /><mml:mo>+</mml:mo><mml:msub><mml:mi mathvariant="double-struck">E</mml:mi><mml:mrow><mml:mi mathvariant="bold">z</mml:mi><mml:mo>∼</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>ϕ</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:msub><mml:mi mathvariant="double-struck">E</mml:mi><mml:mrow><mml:mi mathvariant="script">G</mml:mi><mml:mo>∼</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>θ</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mo>-</mml:mo><mml:mi>R</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>log</mml:mo><mml:mi>r</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>-</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>R</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>log</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>r</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mrow /></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mspace width="1em" /><mml:mo>+</mml:mo><mml:msub><mml:mi mathvariant="double-struck">E</mml:mi><mml:mrow><mml:mi mathvariant="bold">z</mml:mi><mml:mo>∼</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo>∼</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mi mathvariant="double-struck">E</mml:mi><mml:mrow><mml:mi mathvariant="script">G</mml:mi><mml:mo>∼</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>θ</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mo>-</mml:mo><mml:mi>R</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>log</mml:mo><mml:mi>r</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>-</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>R</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>log</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>r</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><tex-math id="Equ4_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} {{\mathcal {L}}_\text {RL} (r)} &amp;=  {} {-R({\mathcal {G}})\log r({\mathcal {G}})-(1-R({\mathcal {G}}))\log (1-r({\mathcal {G}}))}\nonumber \\ &amp; \quad +{\mathbb {E}}_{{\mathbf {z}} \sim q_\phi ({\mathbf {z}}|{\mathcal {G}},{\mathbf {y}})}{\mathbb {E}}_{{\mathcal {G}} \sim p_\theta ({\mathcal {G}}|{\mathbf {z}},{\mathbf {y}})}{[- R({\mathcal {G}}) \log r({\mathcal {G}}) - (1-R({\mathcal {G}})) \log (1-r({\mathcal {G}})) ]}\nonumber \\ &amp; \quad + {\mathbb {E}}_{{\mathbf {z}} \sim p({\mathbf {z}}), {\mathbf {y}} \sim p({\mathbf {y}})}{\mathbb {E}}_{{\mathcal {G}} \sim p_\theta ({\mathcal {G}}|{\mathbf {z}},{\mathbf {y}})}{[- R({\mathcal {G}}) \log r({\mathcal {G}}) - (1-R({\mathcal {G}})) \log (1-r({\mathcal {G}})) ]}. \end{aligned}$$\end{document}</tex-math><graphic position="anchor" xlink:href="13321_2019_396_Article_Equ4.gif" /></alternatives></disp-formula>The VAE is trained for minimizing <inline-formula id="IEq62"><alternatives><mml:math id="IEq62_Math"><mml:mrow><mml:msub><mml:mi mathvariant="script">L</mml:mi><mml:mtext>RL</mml:mtext></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϕ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq62_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {L}}_\text {RL} (\phi ,\theta )$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq62.gif" /></alternatives></inline-formula>, while the reward network <italic>r</italic> is trained to minimize <inline-formula id="IEq63"><alternatives><mml:math id="IEq63_Math"><mml:mrow><mml:msub><mml:mi mathvariant="script">L</mml:mi><mml:mtext>RL</mml:mtext></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq63_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\mathcal {L}}_\text {RL} (r)}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq63.gif" /></alternatives></inline-formula>.</p>
            <p id="Par17">It should be noted that we can impose extra domain-specific constraints regarding structures or properties on the external reward function <italic>R</italic> for constrained generation. For example, we can define a blacklist of undesired substructures and make the value of the reward function 0 when its input contains any substructure in the blacklist. This prevents generated molecules from having undesired substructures.</p>
          </sec>
          <sec id="Sec7">
            <title>Auxiliary property prediction</title>
            <p id="Par18">Augmenting a generative model with side information has known to improve the quality of generated samples as well as the stability of model training [<xref ref-type="bibr" rid="CR19">19</xref>, <xref ref-type="bibr" rid="CR35">35</xref>]. We incorporate auxiliary property prediction into the VAE learning to enable generating probabilistic graphs that correspond to desired properties as well as to diversify the generated outcomes. We build a predictor network as an MPNN with <italic>l</italic> linear outputs. It learns from the training dataset to predict the property vector <inline-formula id="IEq64"><alternatives><mml:math id="IEq64_Math"><mml:mi mathvariant="bold">y</mml:mi></mml:math><tex-math id="IEq64_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {y}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq64.gif" /></alternatives></inline-formula> of a given graph. Because the predictor network can backpropagate the VAE, we train the VAE to generate a probabilistic graph whose corresponding <inline-formula id="IEq65"><alternatives><mml:math id="IEq65_Math"><mml:mi mathvariant="bold">y</mml:mi></mml:math><tex-math id="IEq65_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {y}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq65.gif" /></alternatives></inline-formula> is to be reconstructed by the predictor network.</p>
            <p id="Par19">For learning with auxiliary property prediction, we derive two additional losses <inline-formula id="IEq66"><alternatives><mml:math id="IEq66_Math"><mml:mrow><mml:msub><mml:mi mathvariant="script">L</mml:mi><mml:mtext>Y</mml:mtext></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϕ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq66_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {L}}_\text {Y} (\phi ,\theta )$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq66.gif" /></alternatives></inline-formula> and <inline-formula id="IEq67"><alternatives><mml:math id="IEq67_Math"><mml:mrow><mml:msub><mml:mi mathvariant="script">L</mml:mi><mml:mtext>Y</mml:mtext></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq67_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\mathcal {L}}_\text {Y} (f)}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq67.gif" /></alternatives></inline-formula> as:<disp-formula id="Equ5"><label>5</label><alternatives><mml:math display="block" id="Equ5_Math"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi mathvariant="script">L</mml:mi><mml:mtext>Y</mml:mtext></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϕ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo><mml:mrow /><mml:msub><mml:mi mathvariant="double-struck">E</mml:mi><mml:mrow><mml:mi mathvariant="bold">z</mml:mi><mml:mo>∼</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>ϕ</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:msub><mml:mi mathvariant="double-struck">E</mml:mi><mml:mrow><mml:mi mathvariant="script">G</mml:mi><mml:mo>∼</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>θ</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mfenced close="]" open="[" separators=""><mml:mi>R</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>·</mml:mo><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="bold">y</mml:mi></mml:mrow><mml:mo>-</mml:mo><mml:msup><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mfenced></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mrow /></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mspace width="1em" /><mml:mo>+</mml:mo><mml:msub><mml:mi mathvariant="double-struck">E</mml:mi><mml:mrow><mml:mi mathvariant="bold">z</mml:mi><mml:mo>∼</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo>∼</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mi mathvariant="double-struck">E</mml:mi><mml:mrow><mml:mi mathvariant="script">G</mml:mi><mml:mo>∼</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>θ</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mfenced close="]" open="[" separators=""><mml:mi>R</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>·</mml:mo><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="bold">y</mml:mi></mml:mrow><mml:mo>-</mml:mo><mml:msup><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mfenced><mml:mo>;</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><tex-math id="Equ5_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} {\mathcal {L}}_\text {Y} (\phi ,\theta ) &amp; =  {} {\mathbb {E}}_{{\mathbf {z}} \sim q_\phi ({\mathbf {z}}|{\mathcal {G}},{\mathbf {y}})}{\mathbb {E}}_{{\mathcal {G}} \sim p_\theta ({\mathcal {G}}|{\mathbf {z}},{\mathbf {y}})}{ \left[ R({\mathcal {G}}) \cdot ||{\mathbf {y}}-f({\mathcal {G}})||^2 \right] }\nonumber \\ &amp; \quad + {\mathbb {E}}_{{\mathbf {z}} \sim p({\mathbf {z}}), {\mathbf {y}} \sim p({\mathbf {y}})}{\mathbb {E}}_{{\mathcal {G}} \sim p_\theta ({\mathcal {G}}|{\mathbf {z}},{\mathbf {y}})}{\left[ R({\mathcal {G}}) \cdot ||{\mathbf {y}}-f({\mathcal {G}})||^2 \right] }; \end{aligned}$$\end{document}</tex-math><graphic position="anchor" xlink:href="13321_2019_396_Article_Equ5.gif" /></alternatives></disp-formula><disp-formula id="Equ6"><label>6</label><alternatives><mml:math display="block" id="Equ6_Math"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi mathvariant="script">L</mml:mi><mml:mtext>Y</mml:mtext></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mrow><mml:mrow /><mml:mo stretchy="false">|</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="bold">y</mml:mi></mml:mrow><mml:mo>-</mml:mo><mml:msup><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><tex-math id="Equ6_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} {\mathcal {L}}_\text {Y} (f)= &amp; {} ||{\mathbf {y}}-f({\mathcal {G}})||^2. \end{aligned}$$\end{document}</tex-math><graphic position="anchor" xlink:href="13321_2019_396_Article_Equ6.gif" /></alternatives></disp-formula>Only the probabilistic graphs that are deemed valid by the external reward function <italic>R</italic> are incorporated into the first loss <inline-formula id="IEq68"><alternatives><mml:math id="IEq68_Math"><mml:mrow><mml:msub><mml:mi mathvariant="script">L</mml:mi><mml:mtext>Y</mml:mtext></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϕ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq68_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {L}}_\text {Y} (\phi ,\theta )$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq68.gif" /></alternatives></inline-formula>. The VAE is trained to minimize <inline-formula id="IEq69"><alternatives><mml:math id="IEq69_Math"><mml:mrow><mml:msub><mml:mi mathvariant="script">L</mml:mi><mml:mtext>Y</mml:mtext></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϕ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq69_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {L}}_\text {Y} (\phi ,\theta )$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq69.gif" /></alternatives></inline-formula>. Simultaneously, the predictor network <italic>f</italic> is trained to minimize <inline-formula id="IEq70"><alternatives><mml:math id="IEq70_Math"><mml:mrow><mml:msub><mml:mi mathvariant="script">L</mml:mi><mml:mtext>Y</mml:mtext></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq70_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\mathcal {L}}_\text {Y} (f)}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq70.gif" /></alternatives></inline-formula>.</p>
          </sec>
          <sec id="Sec8">
            <title>Learning from data</title>
            <p id="Par20">The proposed model is composed of four main components: the encoder network <inline-formula id="IEq71"><alternatives><mml:math id="IEq71_Math"><mml:msub><mml:mi>q</mml:mi><mml:mi>ϕ</mml:mi></mml:msub></mml:math><tex-math id="IEq71_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$q_\phi $$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq71.gif" /></alternatives></inline-formula>, decoder network <inline-formula id="IEq72"><alternatives><mml:math id="IEq72_Math"><mml:msub><mml:mi>p</mml:mi><mml:mi>θ</mml:mi></mml:msub></mml:math><tex-math id="IEq72_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p_\theta $$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq72.gif" /></alternatives></inline-formula>, reward network <italic>r</italic>, and predictor network <italic>f</italic>. The full learning objective combines the vanilla objective of VAE (<xref rid="Equ1" ref-type="disp-formula">1</xref>) along with objectives for approximate graph matching (<xref rid="Equ2" ref-type="disp-formula">2</xref>), reinforcement learning (<xref rid="Equ3" ref-type="disp-formula">3</xref>–<xref rid="Equ4" ref-type="disp-formula">4</xref>), and auxiliary property prediction (<xref rid="Equ5" ref-type="disp-formula">5</xref>–<xref rid="Equ6" ref-type="disp-formula">6</xref>). The objective functions for the VAE part and the other part are <inline-formula id="IEq73"><alternatives><mml:math id="IEq73_Math"><mml:msub><mml:mi mathvariant="script">J</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math><tex-math id="IEq73_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {J}}_1$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq73.gif" /></alternatives></inline-formula> and <inline-formula id="IEq74"><alternatives><mml:math id="IEq74_Math"><mml:msub><mml:mi mathvariant="script">J</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math><tex-math id="IEq74_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {J}}_2$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq74.gif" /></alternatives></inline-formula>, respectively, given as:<disp-formula id="Equ7"><label>7</label><alternatives><mml:math display="block" id="Equ7_Math"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi mathvariant="script">J</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϕ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mrow /><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi mathvariant="script">G</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi mathvariant="bold">y</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>∼</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mtext>data</mml:mtext></mml:msub></mml:mrow></mml:munder><mml:mfenced close="]" open="[" separators=""><mml:msub><mml:mi mathvariant="script">L</mml:mi><mml:mtext>VAE</mml:mtext></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϕ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>·</mml:mo><mml:msub><mml:mi mathvariant="script">L</mml:mi><mml:mtext>RL</mml:mtext></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϕ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>·</mml:mo><mml:msub><mml:mi mathvariant="script">L</mml:mi><mml:mtext>Y</mml:mtext></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϕ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfenced><mml:mo>;</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><tex-math id="Equ7_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} {\mathcal {J}}_1 (\phi ,\theta )= &amp; {} \sum _{({\mathcal {G}}_t,{\mathbf {y}}_t)\sim {p}_\text {data}}\left[ {\mathcal {L}}_\text {VAE} (\phi ,\theta )+ \beta _1 \cdot {\mathcal {L}}_\text {RL} (\phi ,\theta )+ \beta _2 \cdot {\mathcal {L}}_\text {Y} (\phi ,\theta )\right] ; \end{aligned}$$\end{document}</tex-math><graphic position="anchor" xlink:href="13321_2019_396_Article_Equ7.gif" /></alternatives></disp-formula><disp-formula id="Equ8"><label>8</label><alternatives><mml:math display="block" id="Equ8_Math"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi mathvariant="script">J</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mrow /><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi mathvariant="script">G</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi mathvariant="bold">y</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>∼</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mtext>data</mml:mtext></mml:msub></mml:mrow></mml:munder><mml:mfenced close="]" open="[" separators=""><mml:msub><mml:mi>β</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>·</mml:mo><mml:msub><mml:mi mathvariant="script">L</mml:mi><mml:mtext>RL</mml:mtext></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>·</mml:mo><mml:msub><mml:mi mathvariant="script">L</mml:mi><mml:mtext>Y</mml:mtext></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfenced><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><tex-math id="Equ8_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} {\mathcal {J}}_2 (r,f)= &amp; {} \sum _{({\mathcal {G}}_t,{\mathbf {y}}_t)\sim {p}_\text {data}}\left[ \beta _1 \cdot {\mathcal {L}}_\text {RL} (r)+ \beta _2 \cdot {\mathcal {L}}_\text {Y} (f)\right] , \end{aligned}$$\end{document}</tex-math><graphic position="anchor" xlink:href="13321_2019_396_Article_Equ8.gif" /></alternatives></disp-formula>where <inline-formula id="IEq75"><alternatives><mml:math id="IEq75_Math"><mml:msub><mml:mi>β</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math><tex-math id="IEq75_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\beta _1$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq75.gif" /></alternatives></inline-formula> and <inline-formula id="IEq76"><alternatives><mml:math id="IEq76_Math"><mml:msub><mml:mi>β</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math><tex-math id="IEq76_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\beta _2$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq76.gif" /></alternatives></inline-formula> are hyperparameters that control the trade-off between different learning objectives.</p>
            <p id="Par21">Given an empirical data distribution <inline-formula id="IEq77"><alternatives><mml:math id="IEq77_Math"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mtext>data</mml:mtext></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq77_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p_\text {data}({\mathcal {G}},{\mathbf {y}})$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq77.gif" /></alternatives></inline-formula>, we train the entire model for minimizing the two objective functions <inline-formula id="IEq78"><alternatives><mml:math id="IEq78_Math"><mml:mrow><mml:msub><mml:mi mathvariant="script">J</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϕ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq78_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {J}}_1(\phi , \theta )$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq78.gif" /></alternatives></inline-formula> and <inline-formula id="IEq79"><alternatives><mml:math id="IEq79_Math"><mml:mrow><mml:msub><mml:mi mathvariant="script">J</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq79_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {J}}_2(r,f)$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq79.gif" /></alternatives></inline-formula> simultaneously. For each iteration, a training batch <italic>X</italic> is sampled from the data distribution. The VAE parameters <inline-formula id="IEq80"><alternatives><mml:math id="IEq80_Math"><mml:mi>ϕ</mml:mi></mml:math><tex-math id="IEq80_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\phi $$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq80.gif" /></alternatives></inline-formula> and <inline-formula id="IEq81"><alternatives><mml:math id="IEq81_Math"><mml:mi>θ</mml:mi></mml:math><tex-math id="IEq81_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\theta $$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq81.gif" /></alternatives></inline-formula> are updated via gradient descent of <inline-formula id="IEq82"><alternatives><mml:math id="IEq82_Math"><mml:mrow><mml:msub><mml:mi mathvariant="script">J</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ϕ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq82_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {J}}_1(\phi , \theta )$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq82.gif" /></alternatives></inline-formula> on <italic>X</italic>, and the reward network <italic>r</italic> and predictor network <italic>f</italic> are updated via gradient descent of <inline-formula id="IEq83"><alternatives><mml:math id="IEq83_Math"><mml:mrow><mml:msub><mml:mi mathvariant="script">J</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq83_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {J}}_2(r,f)$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq83.gif" /></alternatives></inline-formula>. Algorithm 1 presents the pseudocode of the learning procedure. <fig id="Figa" position="anchor"><graphic specific-use="HTML" mime-subtype="PNG" xlink:href="MediaObjects/13321_2019_396_Figa_HTML.png" position="anchor" /></fig></p>
          </sec>
          <sec id="Sec9">
            <title>Molecular graph generation</title>
            <p id="Par22">Once the model is trained, we use the decoder <inline-formula id="IEq84"><alternatives><mml:math id="IEq84_Math"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>θ</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq84_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p_\theta ({\mathcal {G}}|{\mathbf {z}},{\mathbf {y}})$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq84.gif" /></alternatives></inline-formula> to generate molecular graphs. For unconditional generation, <inline-formula id="IEq85"><alternatives><mml:math id="IEq85_Math"><mml:msub><mml:mi mathvariant="bold">y</mml:mi><mml:mrow><mml:mrow /><mml:mo>∗</mml:mo></mml:mrow></mml:msub></mml:math><tex-math id="IEq85_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {y}}_*$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq85.gif" /></alternatives></inline-formula> is sampled from its prior distribution <inline-formula id="IEq86"><alternatives><mml:math id="IEq86_Math"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><tex-math id="IEq86_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p({\mathbf {y}})$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq86.gif" /></alternatives></inline-formula>. To conditionally generate molecular graphs, <inline-formula id="IEq87"><alternatives><mml:math id="IEq87_Math"><mml:msub><mml:mi mathvariant="bold">y</mml:mi><mml:mrow><mml:mrow /><mml:mo>∗</mml:mo></mml:mrow></mml:msub></mml:math><tex-math id="IEq87_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {y}}_*$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq87.gif" /></alternatives></inline-formula> is sampled from a conditional distribution. For example, if the target condition is given as <inline-formula id="IEq88"><alternatives><mml:math id="IEq88_Math"><mml:mrow><mml:msup><mml:mi>y</mml:mi><mml:mi>k</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:mi>τ</mml:mi></mml:mrow></mml:math><tex-math id="IEq88_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$y^k=\tau $$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq88.gif" /></alternatives></inline-formula>, then <inline-formula id="IEq89"><alternatives><mml:math id="IEq89_Math"><mml:mrow><mml:msub><mml:mi mathvariant="bold">y</mml:mi><mml:mrow><mml:mrow /><mml:mo>∗</mml:mo></mml:mrow></mml:msub><mml:mo>∼</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:msup><mml:mi>y</mml:mi><mml:mi>k</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:mi>τ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq89_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {y}}_* \sim p({\mathbf {y}}|y^k=\tau )$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq89.gif" /></alternatives></inline-formula>. We sample <inline-formula id="IEq90"><alternatives><mml:math id="IEq90_Math"><mml:msub><mml:mi mathvariant="bold">z</mml:mi><mml:mrow><mml:mrow /><mml:mo>∗</mml:mo></mml:mrow></mml:msub></mml:math><tex-math id="IEq90_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {z}}_*$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq90.gif" /></alternatives></inline-formula> from <inline-formula id="IEq91"><alternatives><mml:math id="IEq91_Math"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><tex-math id="IEq91_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p({\mathbf {z}})$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq91.gif" /></alternatives></inline-formula>. Given <inline-formula id="IEq92"><alternatives><mml:math id="IEq92_Math"><mml:msub><mml:mi mathvariant="bold">y</mml:mi><mml:mrow><mml:mrow /><mml:mo>∗</mml:mo></mml:mrow></mml:msub></mml:math><tex-math id="IEq92_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {y}}_*$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq92.gif" /></alternatives></inline-formula> and <inline-formula id="IEq93"><alternatives><mml:math id="IEq93_Math"><mml:msub><mml:mi mathvariant="bold">z</mml:mi><mml:mrow><mml:mrow /><mml:mo>∗</mml:mo></mml:mrow></mml:msub></mml:math><tex-math id="IEq93_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {z}}_*$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq93.gif" /></alternatives></inline-formula>, the decoder returns a probabilistic output, which is decoded based on node-wise and edge-wise argmax to obtain a molecular graph <inline-formula id="IEq94"><alternatives><mml:math id="IEq94_Math"><mml:msub><mml:mi mathvariant="script">G</mml:mi><mml:mrow><mml:mrow /><mml:mo>∗</mml:mo></mml:mrow></mml:msub></mml:math><tex-math id="IEq94_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathcal {G}}_*$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq94.gif" /></alternatives></inline-formula> as<disp-formula id="Equ9"><label>9</label><alternatives><mml:math display="block" id="Equ9_Math"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi mathvariant="script">G</mml:mi><mml:mrow><mml:mrow /><mml:mo>∗</mml:mo></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mtext>argmax</mml:mtext><mml:mspace width="0.333333em" /></mml:mrow><mml:mi mathvariant="script">G</mml:mi></mml:munder><mml:msub><mml:mi>p</mml:mi><mml:mi>θ</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi mathvariant="bold">z</mml:mi><mml:mrow><mml:mrow /><mml:mo>∗</mml:mo></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi mathvariant="bold">y</mml:mi><mml:mrow><mml:mrow /><mml:mo>∗</mml:mo></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><tex-math id="Equ9_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} {\mathcal {G}}_* =\underset{{\mathcal {G}}}{\text {argmax }}p_\theta ({\mathcal {G}}|{\mathbf {z}}={\mathbf {z}}_*,{\mathbf {y}}={\mathbf {y}}_*). \end{aligned}$$\end{document}</tex-math><graphic position="anchor" xlink:href="13321_2019_396_Article_Equ9.gif" /></alternatives></disp-formula>We use a simple decoding method to discretize probabilistic outputs for deriving molecular graphs. Some studies reported that post-processing of probabilistic outputs based on such methods as maximum spanning tree [<xref ref-type="bibr" rid="CR28">28</xref>] and beam search [<xref ref-type="bibr" rid="CR36">36</xref>] can improve the validity of the generated molecular graphs.</p>
          </sec>
        </sec>
        <sec id="Sec10">
          <title>Results and discussion</title>
          <sec id="Sec11">
            <title>Datasets</title>
            <p id="Par23">We conducted experiments to investigate the effectiveness of the proposed method. In this work, we utilized two molecular datasets: QM9 and ZINC. They are publicly available and have commonly been used for the evaluation of molecular graph generation.</p>
            <p id="Par24">The QM9 dataset [<xref ref-type="bibr" rid="CR37">37</xref>, <xref ref-type="bibr" rid="CR38">38</xref>] originally contains 133,885 organic molecules with at most nine heavy atoms of the following types: {C, N, O, F, none}. We sampled 100,000 unique molecular graphs from the original set. For each atom in a molecular graph, the formal charge and the number of explicit hydrogens belonged to <inline-formula id="IEq95"><alternatives><mml:math id="IEq95_Math"><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mo>-</mml:mo><mml:mspace width="0.166667em" /><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math><tex-math id="IEq95_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{-\,1,0,1\}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq95.gif" /></alternatives></inline-formula> and <inline-formula id="IEq96"><alternatives><mml:math id="IEq96_Math"><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mn>3</mml:mn><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math><tex-math id="IEq96_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{0,1,2,3\}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq96.gif" /></alternatives></inline-formula>, respectively. Thus, the dimensions <italic>p</italic> and <italic>q</italic> were 12 and 4, respectively.</p>
            <p id="Par25">The ZINC dataset was constituted by sampling 100,000 unique molecular graphs from the drug-like part of the ZINC database [<xref ref-type="bibr" rid="CR11">11</xref>]. Each molecular graph in the dataset contained up to 38 heavy atoms with ten atom types: {C, N, O, F, P, S, Cl, Br, I, none}. In the dataset used, the formal charge and the number of explicit hydrogens were in <inline-formula id="IEq97"><alternatives><mml:math id="IEq97_Math"><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mo>-</mml:mo><mml:mspace width="0.166667em" /><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math><tex-math id="IEq97_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{-\,1,0,1\}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq97.gif" /></alternatives></inline-formula> and <inline-formula id="IEq98"><alternatives><mml:math id="IEq98_Math"><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mn>3</mml:mn><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math><tex-math id="IEq98_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{0,1,2,3\}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq98.gif" /></alternatives></inline-formula>, respectively. The dimensions <italic>p</italic> and <italic>q</italic> were 17 and 4, respectively.</p>
            <p id="Par26">We employed two properties that are readily calculable using the RDKit package [<xref ref-type="bibr" rid="CR39">39</xref>]: the molecular weight (MolWt) and Wildman-Crippen partition coefficient (LogP) [<xref ref-type="bibr" rid="CR40">40</xref>]. The property vector of each molecular graph was constituted with the three properties. Thus, the dimension <italic>l</italic> was 2. These properties can be evaluated efficiently without high costs for newly generated molecular graphs.</p>
          </sec>
          <sec id="Sec12">
            <title>Experiments</title>
            <p id="Par27">In the proposed method, the model architecture was determined as follows. For the molecular graph representation, the hyperparameter <italic>m</italic> was set as 5 plus the maximum number of heavy atoms in a molecule in the dataset used, i.e., <italic>m</italic> = 14 for QM9 and <italic>m</italic> = 43 for ZINC. The encoder, reward, and predictor networks were modeled as MPNNs. Each MPNN had three message passing layers with 50 hidden units, followed by a 100-dimensional node aggregation layer, which was then further processed by two fully-connected layers with 100 tanh hidden units. The decoder network was a fully-connected network with three fully-connected layers having dimensions of 500 with LeakyReLU activation. The dimension of <inline-formula id="IEq99"><alternatives><mml:math id="IEq99_Math"><mml:mi mathvariant="bold">z</mml:mi></mml:math><tex-math id="IEq99_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {z}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq99.gif" /></alternatives></inline-formula> was set as 100. Each property in <inline-formula id="IEq100"><alternatives><mml:math id="IEq100_Math"><mml:mi mathvariant="bold">y</mml:mi></mml:math><tex-math id="IEq100_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf {y}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq100.gif" /></alternatives></inline-formula> was normalized to have a mean of 0 and a standard deviation of 1 for training. For the prior distribution <inline-formula id="IEq101"><alternatives><mml:math id="IEq101_Math"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><tex-math id="IEq101_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p({\mathbf {y}})$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq101.gif" /></alternatives></inline-formula>, we estimated the mean vector <inline-formula id="IEq102"><alternatives><mml:math id="IEq102_Math"><mml:msub><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi mathvariant="bold">y</mml:mi></mml:msub></mml:math><tex-math id="IEq102_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat{\varvec{\mu }}_{\mathbf {y}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq102.gif" /></alternatives></inline-formula> and covariance matrix <inline-formula id="IEq103"><alternatives><mml:math id="IEq103_Math"><mml:msub><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi mathvariant="bold">y</mml:mi></mml:msub></mml:math><tex-math id="IEq103_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat{\varvec{\Sigma }}_{\mathbf {y}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq103.gif" /></alternatives></inline-formula> from the training dataset. For reinforcement learning, the external reward function was implemented using the RDKit package [<xref ref-type="bibr" rid="CR39">39</xref>]. Figure <xref rid="Fig1" ref-type="fig">1</xref> shows the architectural details of the model used in the experiments. For the objective functions, the hyperparameters <inline-formula id="IEq104"><alternatives><mml:math id="IEq104_Math"><mml:msub><mml:mi>β</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math><tex-math id="IEq104_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\beta _1$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq104.gif" /></alternatives></inline-formula> and <inline-formula id="IEq105"><alternatives><mml:math id="IEq105_Math"><mml:msub><mml:mi>β</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math><tex-math id="IEq105_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\beta _2$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq105.gif" /></alternatives></inline-formula> were both set as 1. Given a dataset, the model was trained for 50 epochs using the RMSProp optimizer with a learning rate of 0.0005 and a batch size of 20.</p>
            <p id="Par28">We compared the proposed method with two baseline methods that generate molecular graphs in a non-autoregressive manner: GraphVAE [<xref ref-type="bibr" rid="CR28">28</xref>] and MolGAN [<xref ref-type="bibr" rid="CR29">29</xref>]. We also performed an ablation study on our method to investigate the efficacy of reinforcement learning and auxiliary property prediction. We evaluated two ablation models, denoted A1 and A2. For model A1, we removed both the reward and predictor networks by setting <inline-formula id="IEq106"><alternatives><mml:math id="IEq106_Math"><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math><tex-math id="IEq106_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\beta _1=0$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq106.gif" /></alternatives></inline-formula> and <inline-formula id="IEq107"><alternatives><mml:math id="IEq107_Math"><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math><tex-math id="IEq107_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\beta _2=0$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq107.gif" /></alternatives></inline-formula>, which indicates that the reinforcement learning and auxiliary property prediction were excluded from the learning objective. For model A2, the predictor network was removed by setting <inline-formula id="IEq108"><alternatives><mml:math id="IEq108_Math"><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math><tex-math id="IEq108_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\beta _1=1$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq108.gif" /></alternatives></inline-formula> and <inline-formula id="IEq109"><alternatives><mml:math id="IEq109_Math"><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math><tex-math id="IEq109_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\beta _2=0$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq109.gif" /></alternatives></inline-formula> to discard auxiliary property prediction only.<fig id="Fig1"><label>Fig. 1</label><caption xml:lang="en"><p>Model architecture used in case study</p></caption><graphic specific-use="HTML" mime-subtype="PNG" xlink:href="MediaObjects/13321_2019_396_Fig1_HTML.png" /></fig></p>
            <p id="Par29">The performance of each model for molecular graph generation was evaluated with regard to three metrics: <italic>Validity</italic>, <italic>Uniqueness</italic>, and <italic>Novelty</italic>. We sampled 10,000 molecular graphs from each model. Then, <italic>Validity</italic> was calculated as the fraction of valid molecular graphs out of 10,000 generated molecular graphs. <italic>Uniqueness</italic> was the fraction of valid graphs that were not duplicates. <italic>Novelty</italic> was the fraction of valid graphs that were not included in the training dataset. The values of each metric ranged from 0 to 1. Because the primary goal is to generate molecular graphs that are valid, unique, and novel, we calculated the geometric mean (G-mean) of the three metrics for an overall comparison among the models.</p>
            <p id="Par30">All the experiments were implemented based on GPU-accelerated TensorFlow in Python.</p>
          </sec>
          <sec id="Sec13">
            <title>Results</title>
            <p id="Par31">Table <xref rid="Tab1" ref-type="table">1</xref> presents the results of unconditional molecular graph generation for QM9 and ZINC. We report the validity, uniqueness, novelty, and G-mean for the five compared models. The best value in each row is highlighted in italics. Figures <xref rid="Fig2" ref-type="fig">2</xref> and <xref rid="Fig3" ref-type="fig">3</xref> show example molecular graphs generated randomly by the proposed models trained with QM9 and ZINC, respectively.</p>
            <p id="Par32">The proposed model exhibited the highest G-mean for both the QM9 and ZINC datasets, as the model achieved good performance for all three metrics. The proposed model exhibited a validity score of > 90% for both datasets, indicating that it almost always generated chemically valid molecules. Additionally, it generated more diverse molecules, as evident from its comparable uniqueness and novelty scores. In the case of ZINC, all the compared models yielded novelty of 1, indicating that all the generated molecules were not included in the training set. The baseline models yielded relatively good performance for QM9 but rarely generated valid molecular graphs for ZINC.</p>
            <p id="Par33">Compared with the ablated models, reinforcement learning helped the proposed model generate chemically valid molecules, as evident from the observation that model A2 was superior to model A1 in terms of validity. The auxiliary property prediction contributed to the diversification of the generated molecules, as the proposed model exhibited higher uniqueness than model A2.<fig id="Fig2"><label>Fig. 2</label><caption xml:lang="en"><p>Examples of newly generated molecular graphs from QM9</p></caption><graphic specific-use="HTML" mime-subtype="PNG" xlink:href="MediaObjects/13321_2019_396_Fig2_HTML.png" /></fig><fig id="Fig3"><label>Fig. 3</label><caption xml:lang="en"><p>Examples of newly generated molecular graphs from ZINC</p></caption><graphic specific-use="HTML" mime-subtype="PNG" xlink:href="MediaObjects/13321_2019_396_Fig3_HTML.png" /></fig><table-wrap id="Tab1"><label>Table 1</label><caption xml:lang="en"><p>Performance comparison for unconditional molecular graph generation</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" rowspan="2"><p>Dataset</p></th><th align="left" rowspan="2"><p>Metric</p></th><th align="left" rowspan="2"><p>GraphVAE [<xref ref-type="bibr" rid="CR28">28</xref>]</p></th><th align="left" rowspan="2"><p>MolGAN [<xref ref-type="bibr" rid="CR29">29</xref>]</p></th><th align="left" colspan="3"><p>Proposed</p></th></tr><tr><th align="left"><p>A1</p></th><th align="left"><p>A2</p></th><th align="left"><p>Full</p></th></tr></thead><tbody><tr><td align="left" rowspan="4"><p>QM9</p></td><td align="left"><p><italic>Validity</italic></p></td><td char="." align="char"><p>0.610</p></td><td char="." align="char"><p><italic>0.981</italic></p></td><td char="." align="char"><p>0.550</p></td><td char="." align="char"><p>0.965</p></td><td char="." align="char"><p>0.945</p></td></tr><tr><td align="left"><p>Uniqueness</p></td><td char="." align="char"><p><italic>0.409</italic></p></td><td char="." align="char"><p>0.104</p></td><td char="." align="char"><p>0.293</p></td><td char="." align="char"><p>0.275</p></td><td char="." align="char"><p>0.343</p></td></tr><tr><td align="left"><p><italic>Novelty</italic></p></td><td char="." align="char"><p>0.850</p></td><td char="." align="char"><p><italic>0.942</italic></p></td><td char="." align="char"><p>0.612</p></td><td char="." align="char"><p>0.737</p></td><td char="." align="char"><p>0.806</p></td></tr><tr><td align="left"><p>G-mean</p></td><td char="." align="char"><p>0.596</p></td><td char="." align="char"><p>0.458</p></td><td char="." align="char"><p>0.462</p></td><td char="." align="char"><p>0.581</p></td><td char="." align="char"><p><italic>0.639</italic></p></td></tr><tr><td align="left" rowspan="4"><p>ZINC</p></td><td align="left"><p><italic>Validity</italic></p></td><td char="." align="char"><p>0.140</p></td><td char="." align="char"><p>0.017</p></td><td char="." align="char"><p>0.008</p></td><td char="." align="char"><p><italic>0.926</italic></p></td><td char="." align="char"><p>0.919</p></td></tr><tr><td align="left"><p>Uniqueness</p></td><td char="." align="char"><p>0.316</p></td><td char="." align="char"><p>0.201</p></td><td char="." align="char"><p><italic>0.949</italic></p></td><td char="." align="char"><p>0.614</p></td><td char="." align="char"><p>0.762</p></td></tr><tr><td align="left"><p><italic>Novelty</italic></p></td><td char="." align="char"><p><italic>1.000</italic></p></td><td char="." align="char"><p><italic>1.000</italic></p></td><td char="." align="char"><p><italic>1.000</italic></p></td><td char="." align="char"><p><italic>1.000</italic></p></td><td char="." align="char"><p><italic>1.000</italic></p></td></tr><tr><td align="left"><p>G-mean</p></td><td char="." align="char"><p>0.354</p></td><td char="." align="char"><p>0.151</p></td><td char="." align="char"><p>0.197</p></td><td char="." align="char"><p>0.828</p></td><td char="." align="char"><p><italic>0.888</italic></p></td></tr></tbody></table><table-wrap-foot><p>Best score for each metric is given in italic</p></table-wrap-foot></table-wrap></p>
            <p id="Par34">Table <xref rid="Tab2" ref-type="table">2</xref> presents summary statistics for the newly generated molecules of each target condition by the proposed model. For conditional generation, the target conditions for MolWt and LogP were set as <inline-formula id="IEq110"><alternatives><mml:math id="IEq110_Math"><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mn>120</mml:mn><mml:mo>,</mml:mo><mml:mn>125</mml:mn><mml:mo>,</mml:mo><mml:mn>130</mml:mn><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math><tex-math id="IEq110_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{120, 125, 130\}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq110.gif" /></alternatives></inline-formula> and <inline-formula id="IEq111"><alternatives><mml:math id="IEq111_Math"><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mo>-</mml:mo><mml:mspace width="0.166667em" /><mml:mn>0.4</mml:mn><mml:mo>,</mml:mo><mml:mn>0.2</mml:mn><mml:mo>,</mml:mo><mml:mn>0.8</mml:mn><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math><tex-math id="IEq111_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{-\,0.4, 0.2, 0.8\}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq111.gif" /></alternatives></inline-formula>, respectively, for QM9, and <inline-formula id="IEq112"><alternatives><mml:math id="IEq112_Math"><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mn>300</mml:mn><mml:mo>,</mml:mo><mml:mn>350</mml:mn><mml:mo>,</mml:mo><mml:mn>400</mml:mn><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math><tex-math id="IEq112_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{300, 350, 400\}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq112.gif" /></alternatives></inline-formula> and <inline-formula id="IEq113"><alternatives><mml:math id="IEq113_Math"><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mn>1.5</mml:mn><mml:mo>,</mml:mo><mml:mn>2.5</mml:mn><mml:mo>,</mml:mo><mml:mn>3.5</mml:mn><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math><tex-math id="IEq113_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{1.5, 2.5, 3.5\}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_396_Article_IEq113.gif" /></alternatives></inline-formula>, respectively, for ZINC. The property distributions obtained via unconditional generation were similar to those of the training set. Compared with the unconditional generation, the conditional generation results exhibited a slightly lower G-mean and a smaller number of unique molecular graphs. As shown in Table <xref rid="Tab2" ref-type="table">2</xref>, when a target condition was set, the proposed model successfully generated molecular graphs whose properties were close to the target value.<table-wrap id="Tab2"><label>Table 2</label><caption xml:lang="en"><p>Conditional molecular graph generation with proposed model</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"><p>Dataset</p></th><th align="left"><p>Target condition</p></th><th align="left"><p>G-mean</p></th><th align="left"><p>Unique count</p></th><th align="left"><p>MolWt</p></th><th align="left"><p>LogP</p></th></tr></thead><tbody><tr><td align="left" rowspan="8"><p>QM9</p></td><td align="left"><p>Training set</p></td><td align="left"><p>–</p></td><td char="." align="char"><p>100,000</p></td><td char="±" align="char"><p>122.97 ± 7.61</p></td><td align="left"><p>0.14 ± 1.16</p></td></tr><tr><td align="left"><p>Unconditional generation</p></td><td align="left"><p>0.639</p></td><td char="." align="char"><p>3243</p></td><td char="±" align="char"><p>123.01 ± 8.04</p></td><td align="left"><p>− 0.06 ± 1.36</p></td></tr><tr><td align="left"><p>MolWt = 120</p></td><td align="left"><p>0.583</p></td><td char="." align="char"><p>2316</p></td><td char="±" align="char"><p>121.85 ± 5.11</p></td><td align="left"><p>0.02 ± 1.36</p></td></tr><tr><td align="left"><p>MolWt = 125</p></td><td align="left"><p>0.543</p></td><td char="." align="char"><p>1947</p></td><td char="±" align="char"><p>125.11 ± 4.56</p></td><td align="left"><p>− 0.27 ± 1.22</p></td></tr><tr><td align="left"><p>MolWt = 130</p></td><td align="left"><p>0.482</p></td><td char="." align="char"><p>1475</p></td><td char="±" align="char"><p>128.98 ± 4.27</p></td><td align="left"><p>− 0.41 ± 1.33</p></td></tr><tr><td align="left"><p>LogP = − 0.4</p></td><td align="left"><p>0.576</p></td><td char="." align="char"><p>2399</p></td><td char="±" align="char"><p>122.97 ± 8.26</p></td><td align="left"><p>− 0.40 ± 0.73</p></td></tr><tr><td align="left"><p>LogP = 0.2</p></td><td align="left"><p>0.543</p></td><td char="." align="char"><p>2099</p></td><td char="±" align="char"><p>122.53 ± 8.17</p></td><td align="left"><p>0.19 ± 0.75</p></td></tr><tr><td align="left"><p>LogP = 0.8</p></td><td align="left"><p>0.537</p></td><td char="." align="char"><p>1989</p></td><td char="±" align="char"><p>122.17 ± 8.09</p></td><td align="left"><p>0.83 ± 0.72</p></td></tr><tr><td align="left" rowspan="8"><p>ZINC</p></td><td align="left"><p>Training set</p></td><td align="left"><p>–</p></td><td char="." align="char"><p>100,000</p></td><td char="±" align="char"><p>357.94 ± 65.48</p></td><td align="left"><p>2.62 ± 1.36</p></td></tr><tr><td align="left"><p>Unconditional generation</p></td><td align="left"><p>0.888</p></td><td char="." align="char"><p>7000</p></td><td char="±" align="char"><p>366.44 ± 51.63</p></td><td align="left"><p>2.49 ± 1.43</p></td></tr><tr><td align="left"><p>MolWt = 300</p></td><td align="left"><p>0.742</p></td><td char="." align="char"><p>4090</p></td><td char="±" align="char"><p>313.12 ± 13.72</p></td><td align="left"><p>1.91 ± 1.50</p></td></tr><tr><td align="left"><p>MolWt = 350</p></td><td align="left"><p>0.796</p></td><td char="." align="char"><p>5045</p></td><td char="±" align="char"><p>356.22 ± 12.66</p></td><td align="left"><p>2.24 ± 1.36</p></td></tr><tr><td align="left"><p>MolWt = 400</p></td><td align="left"><p>0.805</p></td><td char="." align="char"><p>5212</p></td><td char="±" align="char"><p>400.95 ± 13.66</p></td><td align="left"><p>2.78 ± 1.30</p></td></tr><tr><td align="left"><p>LogP = 1.5</p></td><td align="left"><p>0.865</p></td><td char="." align="char"><p>6470</p></td><td char="±" align="char"><p>352.33 ± 46.78</p></td><td align="left"><p>1.66 ± 0.94</p></td></tr><tr><td align="left"><p>LogP = 2.5</p></td><td align="left"><p>0.860</p></td><td char="." align="char"><p>6356</p></td><td char="±" align="char"><p>366.64 ± 48.30</p></td><td align="left"><p>2.46 ± 0.92</p></td></tr><tr><td align="left"><p>LogP = 3.5</p></td><td align="left"><p>0.827</p></td><td char="." align="char"><p>5658</p></td><td char="±" align="char"><p>381.96 ± 48.46</p></td><td align="left"><p>3.22 ± 0.85</p></td></tr></tbody></table></table-wrap></p>
          </sec>
          <sec id="Sec14">
            <title>GuacaMol benchmarks</title>
            <p id="Par35">We further investigated the effectiveness of the proposed method with the distribution-learning benchmarks in the GuacaMol framework [<xref ref-type="bibr" rid="CR41">41</xref>]. The benchmarks are based on a standardized subset of the ChEMBL database [<xref ref-type="bibr" rid="CR42">42</xref>]. As the training set for the proposed model, we used molecules with up to 50 heavy atoms from the original dataset. We trained the model for 20 epochs with the same experimental settings as before. Then, we evaluated <italic>Validity</italic>, <italic>Uniqueness</italic>, and <italic>Novelty</italic> of generated molecular graphs by the model. In addition, whether the model is able to reproduce the distribution of the training set was assessed with <italic>Kullback-Leibler Divergence (KLD)</italic> and <italic>Fréchet ChemNet Distance (FCD)</italic>. For baselines, four SMILES generation models (LSTM, VAE, AAE, and ORGAN) and one molecular graph generation model (GraphMCTS) were compared, as implemented in [<xref ref-type="bibr" rid="CR41">41</xref>].</p>
            <p id="Par36">The results for the distribution-learning benchmarks are shown in Table <xref rid="Tab3" ref-type="table">3</xref>. Compared with the baseline models, the proposed model exhibited comparable or higher scores on validity, uniqueness, and novelty metrics. However, the proposed model yielded relatively lower KLD and FCD scores like GraphMCTS, which indicates that the proposed model was inferior on reproducing the underlying property distributions of the training set. Overall, the molecular graph generation models were very useful in generating chemically valid and diverse molecular graphs, while they were inferior to the SMILES generation models in distribution-learning.<table-wrap id="Tab3"><label>Table 3</label><caption xml:lang="en"><p>Results of GuacaMol distribution-learning benchmarks</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" rowspan="2"><p>Metric</p></th><th align="left" colspan="4"><p>SMILES-based</p></th><th align="left" colspan="2"><p>Graph-based</p></th></tr><tr><th align="left"><p>LSTM</p></th><th align="left"><p>VAE</p></th><th align="left"><p>AAE</p></th><th align="left"><p>ORGAN</p></th><th align="left"><p>GraphMCTS</p></th><th align="left"><p>Proposed</p></th></tr></thead><tbody><tr><td align="left"><p><italic>Validity</italic></p></td><td align="left"><p>0.959</p></td><td char="." align="char"><p>0.870</p></td><td char="." align="char"><p>0.822</p></td><td char="." align="char"><p>0.379</p></td><td char="." align="char"><p>1.000</p></td><td char="." align="char"><p>0.830</p></td></tr><tr><td align="left"><p><italic>Uniqueness</italic></p></td><td align="left"><p>1.000</p></td><td char="." align="char"><p>0.999</p></td><td char="." align="char"><p>1.000</p></td><td char="." align="char"><p>0.841</p></td><td char="." align="char"><p>1.000</p></td><td char="." align="char"><p>0.944</p></td></tr><tr><td align="left"><p><italic>Novelty</italic></p></td><td align="left"><p>0.912</p></td><td char="." align="char"><p>0.974</p></td><td char="." align="char"><p>0.998</p></td><td char="." align="char"><p>0.687</p></td><td char="." align="char"><p>0.994</p></td><td char="." align="char"><p>1.000</p></td></tr><tr><td align="left"><p><italic>KLD</italic></p></td><td align="left"><p>0.991</p></td><td char="." align="char"><p>0.982</p></td><td char="." align="char"><p>0.886</p></td><td char="." align="char"><p>0.267</p></td><td char="." align="char"><p>0.522</p></td><td char="." align="char"><p>0.554</p></td></tr><tr><td align="left"><p><italic>FCD</italic></p></td><td align="left"><p>0.913</p></td><td char="." align="char"><p>0.863</p></td><td char="." align="char"><p>0.529</p></td><td char="." align="char"><p>0.000</p></td><td char="." align="char"><p>0.015</p></td><td char="." align="char"><p>0.016</p></td></tr></tbody></table></table-wrap></p>
          </sec>
        </sec>
        <sec id="Sec15" sec-type="conclusions">
          <title>Conclusion</title>
          <p id="Par37">While the non-autoregressive approach has the advantage of fast and computationally efficient generation of molecular graphs without any iterative procedure, the existing methods suffer from low performance. To overcome this limitation, we proposed an efficient learning method to build a graph VAE that generates molecular graphs in a non-autoregressive manner. In order to improve the generation performance, we introduced approximate graph matching, reinforcement learning, and auxiliary property prediction into the training of the model. Experimental validation using QM9 and ZINC datasets demonstrated the effectiveness of the proposed method. Compared with existing methods, the proposed method exhibited higher performance for molecular graph generation with a validity score of > 90% as well as improved diversity of the generated molecular graphs for both datasets. We also demonstrated that the proposed model can conditionally generate novel molecular graphs satisfying specified target conditions.</p>
          <p id="Par38">We believe that the proposed method can serve as an efficient tool for the discovery of new materials. Successful application of the method will allow automatic design of desired chemical structures with targeted conditions by learning implicit knowledge from data without explicit knowledge from human experts, thereby meriting further investigations. The generated molecular graphs can be examined further to obtain realistic chemical structures with desired properties.</p>
          <p id="Par39">One downside of the proposed method its high complexity with regard to space and time. Both the space and time complexity increase with the size of the graphs, owing to the use of graph neural networks. Thus, the proposed method would be impractical for learning and generating large molecular graphs, e.g., hundreds of heavy atoms in a molecule. In the future, research will be performed to reduce the complexity for generating larger molecular graphs efficiently.</p>
        </sec>
      </body>
      <back>
        <ack>
          <title>Acknowledgements</title>
          <p>The authors thank the anonymous reviewers for their valuable comments.</p>
        </ack>
        <sec sec-type="author-contribution">
          <title>Authors' contributions</title>
          <p>YK and SK designed and implemented the methodology with contributions from JY. WJS and DL performed the analysis. YSC and WJS supervised the research. YK and SK wrote the manuscript. All authors read and approved the final manuscript.</p>
        </sec>
        <sec>
          <title>Funding</title>
          <p>This work was supported by Samsung Advanced Institute of Technology, and the National Research Foundation of Korea (NRF) grant funded by the Korea government (MSIT; Ministry of Science and ICT) (Nos. NRF-2017R1C1B5075685 and NRF-2019R1A4A1024732).</p>
        </sec>
        <sec sec-type="data-availability">
          <title>Availability of data and materials</title>
          <p>The source code and datasets used in this study are available online at <ext-link xlink:href="http://github.com/seokhokang/graphvae_approx/" ext-link-type="uri">http://github.com/seokhokang/graphvae_approx/</ext-link>. The original QM9 and ZINC data are publicly accessible from <ext-link xlink:href="http://quantum-machine.org/datasets/" ext-link-type="uri">http://quantum-machine.org/datasets/</ext-link> and <ext-link xlink:href="http://zinc15.docking.org/" ext-link-type="uri">http://zinc15.docking.org/</ext-link>, respectively.</p>
        </sec>
        <sec sec-type="ethics-statement">
          <sec sec-type="COI-statement">
            <title>Competing interests</title>
            <p>The authors declare that they have no competing interests.</p>
          </sec>
        </sec>
        <ref-list id="Bib1">
          <title>References</title>
          <ref-list>
            <ref id="CR1">
              <label>1.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Varnek</surname>
                    <given-names>A</given-names>
                  </name>
                  <name>
                    <surname>Baskin</surname>
                    <given-names>I</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Machine learning methods for property prediction in chemoinformatics: quo vadis?</article-title>
                <source>J Chem Inf Model</source>
                <year>2012</year>
                <volume>52</volume>
                <issue>6</issue>
                <fpage>1413</fpage>
                <lpage>1437</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BC38XmvV2ntL4%3D</pub-id>
                <pub-id pub-id-type="doi">10.1021/ci200409x</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR2">
              <label>2.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Xu</surname>
                    <given-names>Y</given-names>
                  </name>
                  <name>
                    <surname>Yao</surname>
                    <given-names>H</given-names>
                  </name>
                  <name>
                    <surname>Lin</surname>
                    <given-names>K</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">An overview of neural networks for drug discovery and the inputs used</article-title>
                <source>Expert Opin Drug Discov</source>
                <year>2018</year>
                <volume>13</volume>
                <issue>12</issue>
                <fpage>1091</fpage>
                <lpage>1102</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BC1cXit1ehsLbM</pub-id>
                <pub-id pub-id-type="doi">10.1080/17460441.2018.1547278</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR3">
              <label>3.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Chen</surname>
                    <given-names>H</given-names>
                  </name>
                  <name>
                    <surname>Engkvist</surname>
                    <given-names>O</given-names>
                  </name>
                  <name>
                    <surname>Wang</surname>
                    <given-names>Y</given-names>
                  </name>
                  <name>
                    <surname>Olivecrona</surname>
                    <given-names>M</given-names>
                  </name>
                  <name>
                    <surname>Blaschke</surname>
                    <given-names>T</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">The rise of deep learning in drug discovery</article-title>
                <source>Drug Discov Today</source>
                <year>2018</year>
                <volume>23</volume>
                <issue>6</issue>
                <fpage>1241</fpage>
                <lpage>1250</lpage>
                <pub-id pub-id-type="doi">10.1016/j.drudis.2018.01.039</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR4">
              <label>4.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Goh</surname>
                    <given-names>GB</given-names>
                  </name>
                  <name>
                    <surname>Hodas</surname>
                    <given-names>NO</given-names>
                  </name>
                  <name>
                    <surname>Vishnu</surname>
                    <given-names>A</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Deep learning for computational chemistry</article-title>
                <source>J Comput Chem</source>
                <year>2017</year>
                <volume>38</volume>
                <fpage>1291</fpage>
                <lpage>1307</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BC2sXktVCitbw%3D</pub-id>
                <pub-id pub-id-type="doi">10.1002/jcc.24764</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR5">
              <label>5.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Huc</surname>
                    <given-names>I</given-names>
                  </name>
                  <name>
                    <surname>Lehn</surname>
                    <given-names>JM</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Virtual combinatorial libraries: dynamic generation of molecular and supramolecular diversity by self-assembly</article-title>
                <source>Proc Natl Acad Sci</source>
                <year>1997</year>
                <volume>94</volume>
                <issue>6</issue>
                <fpage>2106</fpage>
                <lpage>2110</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DyaK2sXhvF2ltrs%3D</pub-id>
                <pub-id pub-id-type="doi">10.1073/pnas.94.6.2106</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR6">
              <label>6.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Lehn</surname>
                    <given-names>JM</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Dynamic combinatorial chemistry and virtual combinatorial libraries</article-title>
                <source>Chem Eur J</source>
                <year>1999</year>
                <volume>5</volume>
                <issue>9</issue>
                <fpage>2455</fpage>
                <lpage>2463</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DyaK1MXmtVKlsbw%3D</pub-id>
                <pub-id pub-id-type="doi">10.1002/(SICI)1521-3765(19990903)5:9&lt;2455::AID-CHEM2455>3.0.CO;2-H</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR7">
              <label>7.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Schneider</surname>
                    <given-names>G</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Trends in virtual combinatorial library design</article-title>
                <source>Curr Med Chem</source>
                <year>2002</year>
                <volume>9</volume>
                <issue>23</issue>
                <fpage>2095</fpage>
                <lpage>2101</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BD38XoslKiurw%3D</pub-id>
                <pub-id pub-id-type="doi">10.2174/0929867023368755</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR8">
              <label>8.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Potyrailo</surname>
                    <given-names>R</given-names>
                  </name>
                  <name>
                    <surname>Rajan</surname>
                    <given-names>K</given-names>
                  </name>
                  <name>
                    <surname>Stoewe</surname>
                    <given-names>K</given-names>
                  </name>
                  <name>
                    <surname>Takeuchi</surname>
                    <given-names>I</given-names>
                  </name>
                  <name>
                    <surname>Chisholm</surname>
                    <given-names>B</given-names>
                  </name>
                  <name>
                    <surname>Lam</surname>
                    <given-names>H</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Combinatorial and high-throughput screening of materials libraries: review of state of the art</article-title>
                <source>ACS Comb Sci</source>
                <year>2011</year>
                <volume>13</volume>
                <issue>6</issue>
                <fpage>579</fpage>
                <lpage>633</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BC3MXhtFWjs7nJ</pub-id>
                <pub-id pub-id-type="doi">10.1021/co200007w</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR9">
              <label>9.</label>
              <mixed-citation publication-type="other">Schwalbe-Koda D, Gómez-Bombarelli R (2019) Generative models for automatic chemical design. arXiv preprint <ext-link xlink:href="http://arxiv.org/abs/190701632" ext-link-type="uri">arXiv:190701632</ext-link></mixed-citation>
            </ref>
            <ref id="CR10">
              <label>10.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Sanchez-Lengeling</surname>
                    <given-names>B</given-names>
                  </name>
                  <name>
                    <surname>Aspuru-Guzik</surname>
                    <given-names>A</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Inverse molecular design using machine learning: generative models for matter engineering</article-title>
                <source>Science</source>
                <year>2018</year>
                <volume>361</volume>
                <issue>6400</issue>
                <fpage>360</fpage>
                <lpage>365</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BC1cXhtlyitr3L</pub-id>
                <pub-id pub-id-type="doi">10.1126/science.aat2663</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR11">
              <label>11.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Sterling</surname>
                    <given-names>T</given-names>
                  </name>
                  <name>
                    <surname>Irwin</surname>
                    <given-names>JJ</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">ZINC 15-ligand discovery for everyone</article-title>
                <source>J Chem Inf Model</source>
                <year>2015</year>
                <volume>55</volume>
                <issue>11</issue>
                <fpage>2324</fpage>
                <lpage>2337</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BC2MXhs1OhurbF</pub-id>
                <pub-id pub-id-type="doi">10.1021/acs.jcim.5b00559</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR12">
              <label>12.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Kim</surname>
                    <given-names>S</given-names>
                  </name>
                  <name>
                    <surname>Thiessen</surname>
                    <given-names>PA</given-names>
                  </name>
                  <name>
                    <surname>Bolton</surname>
                    <given-names>EE</given-names>
                  </name>
                  <name>
                    <surname>Chen</surname>
                    <given-names>J</given-names>
                  </name>
                  <name>
                    <surname>Fu</surname>
                    <given-names>G</given-names>
                  </name>
                  <name>
                    <surname>Gindulyte</surname>
                    <given-names>A</given-names>
                  </name>
                  <etal />
                </person-group>
                <article-title xml:lang="en">PubChem substance and compound databases</article-title>
                <source>Nucleic Acids Res</source>
                <year>2016</year>
                <volume>44</volume>
                <issue>D1</issue>
                <fpage>D1202</fpage>
                <lpage>D1213</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BC2sXhtV2gu7bE</pub-id>
                <pub-id pub-id-type="doi">10.1093/nar/gkv951</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR13">
              <label>13.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Weininger</surname>
                    <given-names>D</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">SMILES, a chemical language and information system. 1. Introduction to methodology and encoding rules</article-title>
                <source>J Chem Inf Comput Sci</source>
                <year>1988</year>
                <volume>28</volume>
                <issue>1</issue>
                <fpage>31</fpage>
                <lpage>36</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DyaL1cXnsVeqsA%3D%3D</pub-id>
                <pub-id pub-id-type="doi">10.1021/ci00057a005</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR14">
              <label>14.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Popova</surname>
                    <given-names>M</given-names>
                  </name>
                  <name>
                    <surname>Isayev</surname>
                    <given-names>O</given-names>
                  </name>
                  <name>
                    <surname>Tropsha</surname>
                    <given-names>A</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Deep reinforcement learning for de-novo drug design</article-title>
                <source>Sci Adv</source>
                <year>2018</year>
                <volume>4</volume>
                <issue>7</issue>
                <fpage>eaap7885</fpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BC1MXhsF2jtbrL</pub-id>
                <pub-id pub-id-type="doi">10.1126/sciadv.aap7885</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR15">
              <label>15.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Olivecrona</surname>
                    <given-names>M</given-names>
                  </name>
                  <name>
                    <surname>Blaschke</surname>
                    <given-names>T</given-names>
                  </name>
                  <name>
                    <surname>Engkvist</surname>
                    <given-names>O</given-names>
                  </name>
                  <name>
                    <surname>Chen</surname>
                    <given-names>H</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Molecular de-novo design through deep reinforcement learning</article-title>
                <source>J Cheminformatics</source>
                <year>2017</year>
                <volume>9</volume>
                <issue>48</issue>
                <fpage>1</fpage>
                <lpage>14</lpage>
              </mixed-citation>
            </ref>
            <ref id="CR16">
              <label>16.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Segler</surname>
                    <given-names>MHS</given-names>
                  </name>
                  <name>
                    <surname>Kogej</surname>
                    <given-names>T</given-names>
                  </name>
                  <name>
                    <surname>Tyrchan</surname>
                    <given-names>C</given-names>
                  </name>
                  <name>
                    <surname>Waller</surname>
                    <given-names>MP</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Generating focused molecule libraries for drug discovery with recurrent neural networks</article-title>
                <source>ACS Cent Sci</source>
                <year>2018</year>
                <volume>4</volume>
                <fpage>120</fpage>
                <lpage>131</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BC2sXitVCjsLfP</pub-id>
                <pub-id pub-id-type="doi">10.1021/acscentsci.7b00512</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR17">
              <label>17.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Gupta</surname>
                    <given-names>A</given-names>
                  </name>
                  <name>
                    <surname>Müller</surname>
                    <given-names>AT</given-names>
                  </name>
                  <name>
                    <surname>Huisman</surname>
                    <given-names>BJH</given-names>
                  </name>
                  <name>
                    <surname>Fuchs</surname>
                    <given-names>JA</given-names>
                  </name>
                  <name>
                    <surname>Schneider</surname>
                    <given-names>P</given-names>
                  </name>
                  <name>
                    <surname>Schneider</surname>
                    <given-names>G</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Generative recurrent networks for de novo drug design</article-title>
                <source>Mol Inf</source>
                <year>2018</year>
                <volume>37</volume>
                <issue>1–2</issue>
                <fpage>1700111</fpage>
                <pub-id pub-id-type="doi">10.1002/minf.201700111</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR18">
              <label>18.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Gómez-Bombarelli</surname>
                    <given-names>R</given-names>
                  </name>
                  <name>
                    <surname>Wei</surname>
                    <given-names>JN</given-names>
                  </name>
                  <name>
                    <surname>Duvenaud</surname>
                    <given-names>D</given-names>
                  </name>
                  <name>
                    <surname>Hernández-Lobato</surname>
                    <given-names>JM</given-names>
                  </name>
                  <name>
                    <surname>Sánchez-Lengeling</surname>
                    <given-names>B</given-names>
                  </name>
                  <name>
                    <surname>Sheberla</surname>
                    <given-names>D</given-names>
                  </name>
                  <etal />
                </person-group>
                <article-title xml:lang="en">Automatic chemical design using a data-driven continuous representation of molecules</article-title>
                <source>ACS Cent Sci</source>
                <year>2018</year>
                <volume>4</volume>
                <issue>2</issue>
                <fpage>268</fpage>
                <lpage>276</lpage>
                <pub-id pub-id-type="doi">10.1021/acscentsci.7b00572</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR19">
              <label>19.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Kang</surname>
                    <given-names>S</given-names>
                  </name>
                  <name>
                    <surname>Cho</surname>
                    <given-names>K</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Conditional molecular design with deep generative models</article-title>
                <source>J Chem Inf Model</source>
                <year>2019</year>
                <volume>59</volume>
                <issue>1</issue>
                <fpage>43</fpage>
                <lpage>52</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BC1cXhtlantb3N</pub-id>
                <pub-id pub-id-type="doi">10.1021/acs.jcim.8b00263</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR20">
              <label>20.</label>
              <mixed-citation publication-type="other">Kusner MJ, Paige B, Hernández-Lobato JM (2017) Grammar variational autoencoder. In: Proceedings of international conference on machine learning, pp 1945–1954</mixed-citation>
            </ref>
            <ref id="CR21">
              <label>21.</label>
              <mixed-citation publication-type="other">Dai H, Tian Y, Dai B, Skiena S, Song L (2018) Syntax-directed variational autoencoder for structured data. In: Proceedings of international conference on learning representations</mixed-citation>
            </ref>
            <ref id="CR22">
              <label>22.</label>
              <mixed-citation publication-type="other">Guimaraes GL, Sanchez-Lengeling B, Farias PLC, Aspuru-Guzik A (2017) Objective-reinforced generative adversarial networks (ORGAN) for sequence generation models. arXiv preprint <ext-link xlink:href="http://arxiv.org/abs/170510843" ext-link-type="uri">arXiv:170510843</ext-link></mixed-citation>
            </ref>
            <ref id="CR23">
              <label>23.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Putin</surname>
                    <given-names>E</given-names>
                  </name>
                  <name>
                    <surname>Asadulaev</surname>
                    <given-names>A</given-names>
                  </name>
                  <name>
                    <surname>Ivanenkov</surname>
                    <given-names>Y</given-names>
                  </name>
                  <name>
                    <surname>Aladinskiy</surname>
                    <given-names>V</given-names>
                  </name>
                  <name>
                    <surname>Sanchez-Lengeling</surname>
                    <given-names>B</given-names>
                  </name>
                  <name>
                    <surname>Aspuru-Guzik</surname>
                    <given-names>A</given-names>
                  </name>
                  <etal />
                </person-group>
                <article-title xml:lang="en">Reinforced adversarial neural computer for de novo molecular design</article-title>
                <source>J Chem Inf Model</source>
                <year>2018</year>
                <volume>58</volume>
                <issue>6</issue>
                <fpage>1194</fpage>
                <lpage>1204</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BC1cXpsVChtrs%3D</pub-id>
                <pub-id pub-id-type="doi">10.1021/acs.jcim.7b00690</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR24">
              <label>24.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Lim</surname>
                    <given-names>J</given-names>
                  </name>
                  <name>
                    <surname>Ryu</surname>
                    <given-names>S</given-names>
                  </name>
                  <name>
                    <surname>Kim</surname>
                    <given-names>JW</given-names>
                  </name>
                  <name>
                    <surname>Kim</surname>
                    <given-names>WY</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Molecular generative model based on conditional variational autoencoder for de novo molecular design</article-title>
                <source>J Cheminformatics</source>
                <year>2018</year>
                <volume>10</volume>
                <issue>1</issue>
                <fpage>31</fpage>
                <pub-id pub-id-type="doi">10.1186/s13321-018-0286-7</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR25">
              <label>25.</label>
              <mixed-citation publication-type="other">Wu Z, Pan S, Chen F, Long G, Zhang C, Yu PS (2019) A comprehensive survey on graph neural networks. arXiv preprint <ext-link xlink:href="http://arxiv.org/abs/190100596" ext-link-type="uri">arXiv:190100596</ext-link></mixed-citation>
            </ref>
            <ref id="CR26">
              <label>26.</label>
              <mixed-citation publication-type="other">Battaglia PW, Hamrick JB, Bapst V, Sanchez-Gonzalez A, Zambaldi V, Malinowski M et al (2018) Relational inductive biases, deep learning, and graph networks. arXiv preprint <ext-link xlink:href="http://arxiv.org/abs/180601261" ext-link-type="uri">arXiv:180601261</ext-link></mixed-citation>
            </ref>
            <ref id="CR27">
              <label>27.</label>
              <mixed-citation publication-type="other">Gilmer J, Schoenholz SS, Riley PF, Vinyals O, Dahl GE (2017) Neural message passing for quantum chemistry. In: Proceedings of international conference on machine learning, pp 1263–1272</mixed-citation>
            </ref>
            <ref id="CR28">
              <label>28.</label>
              <mixed-citation publication-type="other">Simonovsky M, Komodakis N (2018) GraphVAE: towards generation of small graphs using variational autoencoders. In: Proceedings of international conference on artificial neural networks, pp 412–422</mixed-citation>
            </ref>
            <ref id="CR29">
              <label>29.</label>
              <mixed-citation publication-type="other">De Cao N, Kipf T (2018) MolGAN: an implicit generative model for small molecular graphs. arXiv preprint <ext-link xlink:href="http://arxiv.org/abs/180511973" ext-link-type="uri">arXiv:180511973</ext-link></mixed-citation>
            </ref>
            <ref id="CR30">
              <label>30.</label>
              <mixed-citation publication-type="other">Li Y, Vinyals O, Dyer C, Pascanu R, Battaglia P (2018) Learning deep generative models of graphs. arXiv preprint <ext-link xlink:href="http://arxiv.org/abs/180303324" ext-link-type="uri">arXiv:180303324</ext-link></mixed-citation>
            </ref>
            <ref id="CR31">
              <label>31.</label>
              <mixed-citation publication-type="other">You J, Ying R, Ren X, Hamilton W, Leskovec J (2018) GraphRNN: generating realistic graphs with deep auto-regressive models. In: Proceedings of international conference on machine learning, pp 5694–5703</mixed-citation>
            </ref>
            <ref id="CR32">
              <label>32.</label>
              <mixed-citation publication-type="other">Liu Q, Allamanis M, Brockschmidt M, Gaunt A (2018) Constrained graph variational autoencoders for molecule design. In: Advances in neural information processing systems, pp 7795–7804</mixed-citation>
            </ref>
            <ref id="CR33">
              <label>33.</label>
              <mixed-citation publication-type="other">You J, Liu B, Ying Z, Pande V, Leskovec J (2018) Graph convolutional policy network for goal-directed molecular graph generation. In: Advances in neural information processing systems, pp 6410–6421</mixed-citation>
            </ref>
            <ref id="CR34">
              <label>34.</label>
              <mixed-citation publication-type="other">Kingma DP, Welling M (2014) Auto-encoding variational Bayes. In: Proceedings of international conference on learning representations</mixed-citation>
            </ref>
            <ref id="CR35">
              <label>35.</label>
              <mixed-citation publication-type="other">Odena A, Olah C, Shlens J (2017) Conditional image synthesis with auxiliary classifier GANs. In: Proceedings of international conference on machine learning, pp 2642–2651</mixed-citation>
            </ref>
            <ref id="CR36">
              <label>36.</label>
              <mixed-citation publication-type="other">Bresson X, Laurent T (2019) A two-step graph convolutional decoder for molecule generation. arXiv preprint <ext-link xlink:href="http://arxiv.org/abs/190603412" ext-link-type="uri">arXiv:190603412</ext-link></mixed-citation>
            </ref>
            <ref id="CR37">
              <label>37.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Ruddigkeit</surname>
                    <given-names>L</given-names>
                  </name>
                  <name>
                    <surname>Van Deursen</surname>
                    <given-names>R</given-names>
                  </name>
                  <name>
                    <surname>Blum</surname>
                    <given-names>LC</given-names>
                  </name>
                  <name>
                    <surname>Reymond</surname>
                    <given-names>JL</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Enumeration of 166 billion organic small molecules in the chemical universe database GDB-17</article-title>
                <source>J Chem Inf Model</source>
                <year>2012</year>
                <volume>52</volume>
                <issue>11</issue>
                <fpage>2864</fpage>
                <lpage>2875</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BC38XhsFClsL3J</pub-id>
                <pub-id pub-id-type="doi">10.1021/ci300415d</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR38">
              <label>38.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Ramakrishnan</surname>
                    <given-names>R</given-names>
                  </name>
                  <name>
                    <surname>Dral</surname>
                    <given-names>PO</given-names>
                  </name>
                  <name>
                    <surname>Rupp</surname>
                    <given-names>M</given-names>
                  </name>
                  <name>
                    <surname>Von Lilienfeld</surname>
                    <given-names>OA</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Quantum chemistry structures and properties of 134 kilo molecules</article-title>
                <source>Sci Data</source>
                <year>2014</year>
                <volume>1</volume>
                <issue>140022</issue>
                <fpage>1</fpage>
                <lpage>7</lpage>
              </mixed-citation>
            </ref>
            <ref id="CR39">
              <label>39.</label>
              <mixed-citation publication-type="other">Landrum G (2019) RDKit: open-source cheminformatics. <ext-link xlink:href="http://www.rdkit.org" ext-link-type="uri">http://www.rdkit.org</ext-link>. Accessed 10 June 2019</mixed-citation>
            </ref>
            <ref id="CR40">
              <label>40.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Wildman</surname>
                    <given-names>SA</given-names>
                  </name>
                  <name>
                    <surname>Crippen</surname>
                    <given-names>GM</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Prediction of physicochemical parameters by atomic contributions</article-title>
                <source>J Chem Inf Comput Sci</source>
                <year>1999</year>
                <volume>39</volume>
                <issue>5</issue>
                <fpage>868</fpage>
                <lpage>873</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DyaK1MXlt1WjtbY%3D</pub-id>
                <pub-id pub-id-type="doi">10.1021/ci990307l</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR41">
              <label>41.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Brown</surname>
                    <given-names>N</given-names>
                  </name>
                  <name>
                    <surname>Fiscato</surname>
                    <given-names>M</given-names>
                  </name>
                  <name>
                    <surname>Segler</surname>
                    <given-names>MHS</given-names>
                  </name>
                  <name>
                    <surname>Vaucher</surname>
                    <given-names>AC</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">GuacaMol: benchmarking models for de novo molecular design</article-title>
                <source>J Chem Inf Model</source>
                <year>2019</year>
                <volume>59</volume>
                <issue>3</issue>
                <fpage>1096</fpage>
                <lpage>1108</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BC1MXltVWrsbY%3D</pub-id>
                <pub-id pub-id-type="doi">10.1021/acs.jcim.8b00839</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR42">
              <label>42.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Gaulton</surname>
                    <given-names>A</given-names>
                  </name>
                  <name>
                    <surname>Hersey</surname>
                    <given-names>A</given-names>
                  </name>
                  <name>
                    <surname>Nowotka</surname>
                    <given-names>M</given-names>
                  </name>
                  <name>
                    <surname>Bento</surname>
                    <given-names>AP</given-names>
                  </name>
                  <name>
                    <surname>Chambers</surname>
                    <given-names>J</given-names>
                  </name>
                  <name>
                    <surname>Mendez</surname>
                    <given-names>D</given-names>
                  </name>
                  <etal />
                </person-group>
                <article-title xml:lang="en">The ChEMBL Database in 2017</article-title>
                <source>Nucleic Acids Res.</source>
                <year>2016</year>
                <volume>45</volume>
                <issue>D1</issue>
                <fpage>D945</fpage>
                <lpage>D954</lpage>
                <pub-id pub-id-type="doi">10.1093/nar/gkw1074</pub-id>
              </mixed-citation>
            </ref>
          </ref-list>
        </ref-list>
        <notes notes-type="Misc">
          <title>Publisher's Note</title>
          <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
        </notes>
      </back>
    </article>
