<?xml version="1.0"?>
<!ENTITY % article SYSTEM "http://jats.nlm.nih.gov/archiving/1.2/JATS-archivearticle1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="1.2" article-type="research-article" xml:lang="en">
      <?properties open_access?>
      <front>
        <journal-meta>
          <journal-id journal-id-type="publisher-id">13321</journal-id>
          <journal-title-group>
            <journal-title>Journal of Cheminformatics</journal-title>
            <abbrev-journal-title abbrev-type="publisher">J Cheminform</abbrev-journal-title>
          </journal-title-group>
          <issn pub-type="epub">1758-2946</issn>
          <publisher>
            <publisher-name>Springer International Publishing</publisher-name>
            <publisher-loc>Cham</publisher-loc>
          </publisher>
        </journal-meta>
        <article-meta>
          <article-id pub-id-type="publisher-id">s13321-019-0374-3</article-id>
          <article-id pub-id-type="manuscript">374</article-id>
          <article-id pub-id-type="doi">10.1186/s13321-019-0374-3</article-id>
          <article-categories>
            <subj-group subj-group-type="heading">
              <subject>Research Article</subject>
            </subj-group>
          </article-categories>
          <title-group>
            <article-title xml:lang="en">Rapid prediction of NMR spectral properties with quantified uncertainty</article-title>
          </title-group>
          <contrib-group>
            <contrib contrib-type="author" corresp="yes" id="Au1">
              <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-6159-3450</contrib-id>
              <name>
                <surname>Jonas</surname>
                <given-names>Eric</given-names>
              </name>
              <address>
                <email>HIDDEN</email>
              </address>
              <xref ref-type="aff" rid="Aff1">1</xref>
              <xref ref-type="corresp" rid="IDs1332101903743_cor1">a</xref>
            </contrib>
            <contrib contrib-type="author" id="Au2">
              <name>
                <surname>Kuhn</surname>
                <given-names>Stefan</given-names>
              </name>
              <address>
                <email>HIDDEN</email>
              </address>
              <xref ref-type="aff" rid="Aff2">2</xref>
            </contrib>
            <aff id="Aff1">
              <label>1</label>
              <institution-wrap>
                <institution-id institution-id-type="ISNI">0000 0004 1936 7822</institution-id>
                <institution-id institution-id-type="GRID">grid.170205.1</institution-id>
                <institution content-type="org-division">Department of Computer Science</institution>
                <institution content-type="org-name">University of Chicago</institution>
              </institution-wrap>
              <addr-line content-type="city">Chicago</addr-line>
              <country country="US">USA</country>
            </aff>
            <aff id="Aff2">
              <label>2</label>
              <institution-wrap>
                <institution content-type="org-name">School of Computer Science and Informatics</institution>
              </institution-wrap>
              <addr-line content-type="city">Leicester</addr-line>
              <country country="GB">UK</country>
            </aff>
          </contrib-group>
          <author-notes>
            <corresp id="IDs1332101903743_cor1">
              <label>a</label>
              <email>HIDDEN</email>
            </corresp>
          </author-notes>
          <pub-date date-type="pub" publication-format="electronic">
            <day>6</day>
            <month>8</month>
            <year>2019</year>
          </pub-date>
          <pub-date date-type="collection" publication-format="electronic">
            <month>12</month>
            <year>2019</year>
          </pub-date>
          <volume>11</volume>
          <issue seq="50">1</issue>
          <elocation-id>50</elocation-id>
          <history>
            <date date-type="registration">
              <day>29</day>
              <month>7</month>
              <year>2019</year>
            </date>
            <date date-type="received">
              <day>3</day>
              <month>1</month>
              <year>2019</year>
            </date>
            <date date-type="accepted">
              <day>29</day>
              <month>7</month>
              <year>2019</year>
            </date>
            <date date-type="online">
              <day>6</day>
              <month>8</month>
              <year>2019</year>
            </date>
          </history>
          <permissions>
            <copyright-statement content-type="compact">© The Author(s) 2019</copyright-statement>
            <copyright-year>2019</copyright-year>
            <copyright-holder>The Author(s)</copyright-holder>
            <license license-type="open-access" xlink:href="http://creativecommons.org/licenses/by/4.0/">
              <license-p><bold>Open Access</bold>This article is distributed under the terms of the Creative Commons Attribution 4.0 International License (<ext-link xlink:href="http://creativecommons.org/licenses/by/4.0/" ext-link-type="uri">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted use, distribution, and reproduction in any medium, provided you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The Creative Commons Public Domain Dedication waiver (<ext-link xlink:href="http://creativecommons.org/publicdomain/zero/1.0/" ext-link-type="uri">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated.</license-p>
            </license>
          </permissions>
          <abstract xml:lang="en" id="Abs1">
            <title>Abstract</title>
            <p id="Par1">Accurate calculation of specific spectral properties for NMR is an important step for molecular structure elucidation. Here we report the development of a novel machine learning technique for accurately predicting chemical shifts of both <inline-formula id="IEq1"><alternatives><mml:math id="IEq1_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>1</mml:mn></mml:msup><mml:mi mathvariant="normal">H</mml:mi></mml:mrow></mml:math><tex-math id="IEq1_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^1\mathrm{H}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq1.gif" /></alternatives></inline-formula>   and <inline-formula id="IEq2"><alternatives><mml:math id="IEq2_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>13</mml:mn></mml:msup><mml:mi mathvariant="normal">C</mml:mi></mml:mrow></mml:math><tex-math id="IEq2_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^{13}\mathrm{C}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq2.gif" /></alternatives></inline-formula> nuclei which exceeds DFT-accessible accuracy for <inline-formula id="IEq3"><alternatives><mml:math id="IEq3_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>13</mml:mn></mml:msup><mml:mi mathvariant="normal">C</mml:mi></mml:mrow></mml:math><tex-math id="IEq3_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^{13}\mathrm{C}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq3.gif" /></alternatives></inline-formula> and <inline-formula id="IEq4"><alternatives><mml:math id="IEq4_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>1</mml:mn></mml:msup><mml:mi mathvariant="normal">H</mml:mi></mml:mrow></mml:math><tex-math id="IEq4_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^1\mathrm{H}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq4.gif" /></alternatives></inline-formula> for a subset of nuclei, while being orders of magnitude more performant. Our method produces estimates of uncertainty, allowing for robust and confident predictions, and suggests future avenues for improved performance.</p>
          </abstract>
          <kwd-group xml:lang="en">
            <title>Keywords</title>
            <kwd>NMR</kwd>
            <kwd>Machine learning</kwd>
            <kwd>DFT</kwd>
          </kwd-group>
          <funding-group>
            <award-group>
              <funding-source>
                <institution-wrap>
                  <institution>Office of Naval Research</institution>
                  <institution-id institution-id-type="doi" vocab="open-funder-registry">http://dx.doi.org/10.13039/100000006</institution-id>
                </institution-wrap>
              </funding-source>
              <award-id award-type="FundRef grant">N00014-17-1-2401</award-id>
              <principal-award-recipient>
                <name>
                  <surname>Jonas</surname>
                  <given-names>Eric</given-names>
                </name>
              </principal-award-recipient>
            </award-group>
            <award-group>
              <funding-source>
                <institution-wrap>
                  <institution>National Institutes of Health</institution>
                  <institution-id institution-id-type="doi" vocab="open-funder-registry">http://dx.doi.org/10.13039/100000002</institution-id>
                </institution-wrap>
              </funding-source>
              <award-id award-type="FundRef grant">S10OD023532</award-id>
            </award-group>
          </funding-group>
          <custom-meta-group>
            <custom-meta>
              <meta-name>publisher-imprint-name</meta-name>
              <meta-value>Springer</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>volume-issue-count</meta-name>
              <meta-value>1</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>issue-article-count</meta-name>
              <meta-value>0</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>issue-toc-levels</meta-name>
              <meta-value>0</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>issue-pricelist-year</meta-name>
              <meta-value>2019</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>issue-copyright-holder</meta-name>
              <meta-value>The Author(s)</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>issue-copyright-year</meta-name>
              <meta-value>2019</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-contains-esm</meta-name>
              <meta-value>Yes</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-numbering-style</meta-name>
              <meta-value>Unnumbered</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-registration-date-year</meta-name>
              <meta-value>2019</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-registration-date-month</meta-name>
              <meta-value>7</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-registration-date-day</meta-name>
              <meta-value>29</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-toc-levels</meta-name>
              <meta-value>0</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>toc-levels</meta-name>
              <meta-value>0</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>volume-type</meta-name>
              <meta-value>Regular</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-product</meta-name>
              <meta-value>ArchiveJournal</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>numbering-style</meta-name>
              <meta-value>Unnumbered</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-grants-type</meta-name>
              <meta-value>OpenChoice</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>metadata-grant</meta-name>
              <meta-value>OpenAccess</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>abstract-grant</meta-name>
              <meta-value>OpenAccess</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>bodypdf-grant</meta-name>
              <meta-value>OpenAccess</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>bodyhtml-grant</meta-name>
              <meta-value>OpenAccess</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>bibliography-grant</meta-name>
              <meta-value>OpenAccess</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>esm-grant</meta-name>
              <meta-value>OpenAccess</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>online-first</meta-name>
              <meta-value>false</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>pdf-file-reference</meta-name>
              <meta-value>BodyRef/PDF/13321_2019_Article_374.pdf</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>pdf-type</meta-name>
              <meta-value>Typeset</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>target-type</meta-name>
              <meta-value>OnlinePDF</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>issue-type</meta-name>
              <meta-value>Regular</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-type</meta-name>
              <meta-value>OriginalPaper</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-subject-primary</meta-name>
              <meta-value>Chemistry</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-subject-secondary</meta-name>
              <meta-value>Computer Applications in Chemistry</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-subject-secondary</meta-name>
              <meta-value>Documentation and Information in Chemistry</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-subject-secondary</meta-name>
              <meta-value>Theoretical and Computational Chemistry</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-subject-secondary</meta-name>
              <meta-value>Computational Biology/Bioinformatics</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-subject-collection</meta-name>
              <meta-value>Chemistry and Materials Science</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>open-access</meta-name>
              <meta-value>true</meta-value>
            </custom-meta>
          </custom-meta-group>
        </article-meta>
        <notes notes-type="ESMHint">
          <title>Electronic supplementary material</title>
          <p>The online version of this article (<ext-link xlink:href="10.1186/s13321-019-0374-3" ext-link-type="doi">https://doi.org/10.1186/s13321-019-0374-3</ext-link>) contains supplementary material, which is available to authorized users.</p>
        </notes>
      </front>
      <body>
        <sec id="Sec1">
          <title>Introduction</title>
          <p id="Par2">Nuclear magnetic resonance (NMR) spectroscopy is an established method in analytical chemistry. In contrast to other spectroscopic techniques like mass spectrometry (MS), it is non-destructive; in contrast to various optical spectroscopic techniques, it can often give sufficient information to completely elucidate the structure of an unknown molecule. Therefore NMR is an essential tool in many fields of chemistry and biology.</p>
          <p id="Par3">In NMR one major source of information is the specific resonance frequency, termed the chemical shift, at a given spin-active nucleus in a molecule (here we focus on <inline-formula id="IEq5"><alternatives><mml:math id="IEq5_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>1</mml:mn></mml:msup><mml:mi mathvariant="normal">H</mml:mi></mml:mrow></mml:math><tex-math id="IEq5_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^1\mathrm{H}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq5.gif" /></alternatives></inline-formula> and <inline-formula id="IEq6"><alternatives><mml:math id="IEq6_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>13</mml:mn></mml:msup><mml:mi mathvariant="normal">C</mml:mi></mml:mrow></mml:math><tex-math id="IEq6_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^{13}\mathrm{C}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq6.gif" /></alternatives></inline-formula>). The local molecular environment around a nucleus determines its chemical shift, leading to various “rules of thumb” that are taught to undergraduate organic chemists. The development of “pure-shift” NMR pulse sequences [<xref ref-type="bibr" rid="CR1">1</xref>], which can accurately measure chemical shift values with neither homo- nor heteronuclear coupling, makes it even easier to identify precise chemical shift values in crowded spectra.</p>
          <p id="Par4">The association of particular chemical shift values with certain molecular motifs becomes the knowledge of any working organic chemist, but early on efforts were made to computationally assess these properties. One of the earliest was HOSE codes [<xref ref-type="bibr" rid="CR2">2</xref>], which attempt to featurize (summarize) the neighborhood around each atom in concentric spheres, and then use a nearest-neighbor approach to predict the particular shift value. Simultaneously, advances in calculation of NMR properties from first principles (ab initio) made considerable progress with the introduction of Density Functional Theory; today’s DFT-based methods can be quite accurate [<xref ref-type="bibr" rid="CR3">3</xref>] and reasonably turnkey, if time-consuming, protocols have been developed for their application [<xref ref-type="bibr" rid="CR4">4</xref>].</p>
          <p id="Par5">Recently deep neural networks have made incredible progress in various machine learning disciplines, including vision and audition. In chemistry, recently-developed graph neural networks [<xref ref-type="bibr" rid="CR5">5</xref>] and their extensions [<xref ref-type="bibr" rid="CR6">6</xref>] have led to efforts to predict whole-molecule properties [<xref ref-type="bibr" rid="CR7">7</xref>] (such as energy of formation, logP, and others) based on large molecular datasets. In an effort to predict per-nucleus chemical shift values, we adopt convolutional graph networks to predict both per-atom properties and provide an estimate of their own uncertainty.</p>
        </sec>
        <sec id="Sec2" sec-type="methods">
          <title>Methods</title>
          <p id="Par6">A convolutional graphical neural network is a specific type of relational neural network [<xref ref-type="bibr" rid="CR6">6</xref>] which attempts to learn a set of local filters (convolutions) on the graph that predict properties for a given node. At each layer in our vertex-focused convolutional graph network, we associate with each vertex <inline-formula id="IEq7"><alternatives><mml:math id="IEq7_Math"><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><tex-math id="IEq7_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$v_i$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq7.gif" /></alternatives></inline-formula> a <italic>D</italic>-dimensional vector of features <inline-formula id="IEq8"><alternatives><mml:math id="IEq8_Math"><mml:mrow><mml:msubsup><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mi>D</mml:mi></mml:msup></mml:mrow></mml:math><tex-math id="IEq8_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l^{(n)}_i \in \mathbb {R}^D$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq8.gif" /></alternatives></inline-formula>. Each layer computes a new feature vector <inline-formula id="IEq9"><alternatives><mml:math id="IEq9_Math"><mml:msubsup><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:math><tex-math id="IEq9_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l_i^{(n+1)}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq9.gif" /></alternatives></inline-formula> for vertex <inline-formula id="IEq10"><alternatives><mml:math id="IEq10_Math"><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><tex-math id="IEq10_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$v_i$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq10.gif" /></alternatives></inline-formula> as a nonlinear function of the vertices it is connected to,<disp-formula id="Equ1"><label>1</label><alternatives><mml:math display="block" id="Equ1_Math"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>f</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:msub><mml:mi>v</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:mi mathvariant="script">N</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>w</mml:mi><mml:mi>d</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mi>T</mml:mi></mml:msup><mml:msubsup><mml:mi>l</mml:mi><mml:mi>j</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mfenced></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><tex-math id="Equ1_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} l_i^{(n+1)}[d] = f\left( \sum _{v_j \in \mathcal {N}(v_i)} (w_d^{(n)})^T l_j^{(n)}\right) \end{aligned}$$\end{document}</tex-math><graphic position="anchor" xlink:href="13321_2019_374_Article_Equ1.gif" /></alternatives></disp-formula>In this case, <italic>f</italic> is a per-vertex nonlinear function, and the neighborhood calculations are performed based on specific bond orders. We concatenate multiple layers of this type, and train the per-layer weight matrices <inline-formula id="IEq11"><alternatives><mml:math id="IEq11_Math"><mml:msup><mml:mi>W</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:math><tex-math id="IEq11_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$W^{(n)}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq11.gif" /></alternatives></inline-formula> via stochastic gradient descent. This gives us a principled way of learning a set of local, connectivity-constrained nonlinear operations on each graph.</p>
          <p id="Par7">We stack each layer’s features into a <italic>M</italic> by <italic>D</italic> matrix <inline-formula id="IEq16"><alternatives><mml:math id="IEq16_Math"><mml:mrow><mml:msup><mml:mi>L</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>M</mml:mi><mml:mo>×</mml:mo><mml:mi>D</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math><tex-math id="IEq16_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L^{(n)} \in \mathbb {R}^{M \times D}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq16.gif" /></alternatives></inline-formula> where <italic>M</italic> is the maximum number of possible vertices in a graph (in our case, 64). For a given molecule we create 4 adjacency matrices <inline-formula id="IEq17"><alternatives><mml:math id="IEq17_Math"><mml:mrow><mml:msub><mml:mi>G</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mn>1.5</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>G</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>G</mml:mi><mml:mn>3</mml:mn></mml:msub></mml:mrow></mml:math><tex-math id="IEq17_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$G_1, G_{1.5}, G_2, G_3$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq17.gif" /></alternatives></inline-formula> where entry <inline-formula id="IEq18"><alternatives><mml:math id="IEq18_Math"><mml:msub><mml:mi>g</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math><tex-math id="IEq18_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$g_{i,j}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq18.gif" /></alternatives></inline-formula> indicates a bond of the relevant order between vertices <inline-formula id="IEq19"><alternatives><mml:math id="IEq19_Math"><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><tex-math id="IEq19_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$v_i$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq19.gif" /></alternatives></inline-formula> and <inline-formula id="IEq20"><alternatives><mml:math id="IEq20_Math"><mml:msub><mml:mi>v</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:math><tex-math id="IEq20_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$v_j$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq20.gif" /></alternatives></inline-formula>. We then normalize each <italic>G</italic> matrix to <inline-formula id="IEq21"><alternatives><mml:math id="IEq21_Math"><mml:mrow><mml:mover accent="true"><mml:mi>G</mml:mi><mml:mo stretchy="true">~</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>r</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mi>T</mml:mi></mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>G</mml:mi><mml:mo>+</mml:mo><mml:mi>I</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>r</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><tex-math id="IEq21_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\widetilde{G} = (r^{-\frac{1}{2}})^T (G + I) (r^{-\frac{1}{2}})$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq21.gif" /></alternatives></inline-formula> where <italic>r</italic> is the vector of row-sums of <inline-formula id="IEq22"><alternatives><mml:math id="IEq22_Math"><mml:mrow><mml:mi>G</mml:mi><mml:mo>+</mml:mo><mml:mi>I</mml:mi></mml:mrow></mml:math><tex-math id="IEq22_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$G+I$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq22.gif" /></alternatives></inline-formula>. This is akin to Eq. 2 in [<xref ref-type="bibr" rid="CR5">5</xref>]. Then we compute<disp-formula id="Equ2"><label>2</label><alternatives><mml:math display="block" id="Equ2_Math"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi>L</mml:mi><mml:mo stretchy="true">~</mml:mo></mml:mover><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mi>ϕ</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mi>ψ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>G</mml:mi><mml:mo stretchy="true">~</mml:mo></mml:mover><mml:msup><mml:mi>L</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mi>W</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mfenced></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><tex-math id="Equ2_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} \widetilde{L}^{(n+1)} = \phi \left(\psi (\widetilde{G}L^{(n)} W^{(n)} )\right) \end{aligned}$$\end{document}</tex-math><graphic position="anchor" xlink:href="13321_2019_374_Article_Equ2.gif" /></alternatives></disp-formula>where <inline-formula id="IEq23"><alternatives><mml:math id="IEq23_Math"><mml:mi>ψ</mml:mi></mml:math><tex-math id="IEq23_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\psi$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq23.gif" /></alternatives></inline-formula> is <inline-formula id="IEq24"><alternatives><mml:math id="IEq24_Math"><mml:mo movablelimits="true">max</mml:mo></mml:math><tex-math id="IEq24_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\max$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq24.gif" /></alternatives></inline-formula> over bond orders, and <inline-formula id="IEq25"><alternatives><mml:math id="IEq25_Math"><mml:mi>ϕ</mml:mi></mml:math><tex-math id="IEq25_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\phi$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq25.gif" /></alternatives></inline-formula> is a per-vertex rectified linear unit. Thus each layer consists of a <inline-formula id="IEq26"><alternatives><mml:math id="IEq26_Math"><mml:mrow><mml:msup><mml:mi>W</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:math><tex-math id="IEq26_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$W^{(n)} \in \mathbb {R}^{D_{n+1} \times D_{n}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq26.gif" /></alternatives></inline-formula> matrix of parameters that takes in a <inline-formula id="IEq27"><alternatives><mml:math id="IEq27_Math"><mml:mrow><mml:msup><mml:mi>L</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>M</mml:mi><mml:mo>×</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:math><tex-math id="IEq27_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L^{(n)} \in \mathbb {R}^{M \times D_{n}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq27.gif" /></alternatives></inline-formula> matrix of per-vertex features and outputs a <inline-formula id="IEq28"><alternatives><mml:math id="IEq28_Math"><mml:mrow><mml:msup><mml:mi>L</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>M</mml:mi><mml:mo>×</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:math><tex-math id="IEq28_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L^{(n+1)} \in \mathbb {R}^{M \times D_{n+1}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq28.gif" /></alternatives></inline-formula> matrix of features. We use a residual structure, such that <inline-formula id="IEq29"><alternatives><mml:math id="IEq29_Math"><mml:mrow><mml:msup><mml:mi>L</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:msup><mml:mover accent="true"><mml:mi>L</mml:mi><mml:mo stretchy="true">~</mml:mo></mml:mover><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mi>L</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math><tex-math id="IEq29_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L^{(n+1)} = \widetilde{L}^{(n+1)} + L^{(n)}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq29.gif" /></alternatives></inline-formula>.</p>
          <p id="Par8">In our case, all layers have the same number of input and output features except for the first. We use 10 layers of 2048 features, and the first layer takes per-atom input features which are derived from each atom and its environment, and include those in Table <xref rid="Tab1" ref-type="table">1</xref>. Note some numerical features are encoded as binary vectors (so-called <italic>one-hot</italic> encoding) where the <italic>i</italic>th entry in the vector corresponds to a feature value of <italic>i</italic>. Thus the output of the graph portion of our network is a 2048-element feature per vertex.<table-wrap id="Tab1"><label>Table 1</label><caption xml:lang="en"><p>Per-atom input features computed from RDKit molecules</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"><p>Feature</p></th><th align="left"><p>Description</p></th><th align="left"><p>Number</p></th></tr></thead><tbody><tr><td align="left"><p>Atomic number</p></td><td align="left" /><td char="." align="char"><p>1</p></td></tr><tr><td align="left"><p>Atomic number</p></td><td align="left"><p>One-hot encoded {H, C, O, N, P, S, F, Cl}</p></td><td char="." align="char"><p>8</p></td></tr><tr><td align="left"><p>Valence</p></td><td align="left" /><td char="." align="char"><p>1</p></td></tr><tr><td align="left"><p>Valence</p></td><td align="left"><p>One-hot encoded 1–6</p></td><td char="." align="char"><p>6</p></td></tr><tr><td align="left"><p>Aromaticity</p></td><td align="left"><p>Does RDKit identify this atom as being part of an aromatic structure</p></td><td char="." align="char"><p>1</p></td></tr><tr><td align="left"><p>Hybridization state</p></td><td align="left"><p>One-hot encoded <italic>s</italic>, <italic>sp</italic>, <inline-formula id="IEq41"><alternatives><mml:math id="IEq41_Math"><mml:mrow><mml:mi>s</mml:mi><mml:msup><mml:mi>p</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math><tex-math id="IEq41_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$sp^2$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq41.gif" /></alternatives></inline-formula>, <inline-formula id="IEq42"><alternatives><mml:math id="IEq42_Math"><mml:mrow><mml:mi>s</mml:mi><mml:msup><mml:mi>p</mml:mi><mml:mn>3</mml:mn></mml:msup></mml:mrow></mml:math><tex-math id="IEq42_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$sp^3$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq42.gif" /></alternatives></inline-formula>, <inline-formula id="IEq43"><alternatives><mml:math id="IEq43_Math"><mml:mrow><mml:mi>s</mml:mi><mml:msup><mml:mi>p</mml:mi><mml:mn>3</mml:mn></mml:msup><mml:mi>d</mml:mi></mml:mrow></mml:math><tex-math id="IEq43_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$sp^3d$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq43.gif" /></alternatives></inline-formula>, <inline-formula id="IEq44"><alternatives><mml:math id="IEq44_Math"><mml:mrow><mml:mi>s</mml:mi><mml:msup><mml:mi>p</mml:mi><mml:mn>3</mml:mn></mml:msup><mml:msup><mml:mi>d</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math><tex-math id="IEq44_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$sp^3d^2$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq44.gif" /></alternatives></inline-formula></p></td><td char="." align="char"><p>6</p></td></tr><tr><td align="left"><p>Formal charge</p></td><td align="left"><p>Does this atom have a net charge, one-hot encoded {<inline-formula id="IEq45"><alternatives><mml:math id="IEq45_Math"><mml:mrow><mml:mo>-</mml:mo><mml:mspace width="0.166667em" /><mml:mn>1</mml:mn></mml:mrow></mml:math><tex-math id="IEq45_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$-\,1$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq45.gif" /></alternatives></inline-formula>, 0, <inline-formula id="IEq46"><alternatives><mml:math id="IEq46_Math"><mml:mrow><mml:mo>+</mml:mo><mml:mspace width="0.166667em" /><mml:mn>1</mml:mn></mml:mrow></mml:math><tex-math id="IEq46_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$+\,1$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq46.gif" /></alternatives></inline-formula>}</p></td><td char="." align="char"><p>3</p></td></tr><tr><td align="left"><p>Default valence</p></td><td align="left"><p>One-hot encoded 1–6</p></td><td char="." align="char"><p>6</p></td></tr><tr><td align="left"><p>Rings</p></td><td align="left"><p>Is this atom the member of a ring , one-hot encoded 3–7</p></td><td char="." align="char"><p>5</p></td></tr><tr><td align="left"><p>Total</p></td><td align="left" /><td char="." align="char"><p>37</p></td></tr></tbody></table></table-wrap></p>
          <p id="Par9">This feature is fed through two 128-dimensional linear units to calculate the uncertainty value, and a stacked collection of 3 fully-connected residual blocks before a final linear layer as output (see Table <xref rid="Tab2" ref-type="table">2</xref>). The network uses rectified nonlinearities (ReLUs) exclusively for nonlinear activations.
<table-wrap id="Tab2"><label>Table 2</label><caption xml:lang="en"><p>Post-graph-network linear layers for predicting per-atom <inline-formula id="IEq30"><alternatives><mml:math id="IEq30_Math"><mml:mi>μ</mml:mi></mml:math><tex-math id="IEq30_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mu$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq30.gif" /></alternatives></inline-formula> and <inline-formula id="IEq31"><alternatives><mml:math id="IEq31_Math"><mml:mi>σ</mml:mi></mml:math><tex-math id="IEq31_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sigma$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq31.gif" /></alternatives></inline-formula></p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" /><th align="left"><p><inline-formula id="IEq32"><alternatives><mml:math id="IEq32_Math"><mml:mi>μ</mml:mi></mml:math><tex-math id="IEq32_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mu$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq32.gif" /></alternatives></inline-formula></p></th><th align="left"><p><inline-formula id="IEq33"><alternatives><mml:math id="IEq33_Math"><mml:mi>σ</mml:mi></mml:math><tex-math id="IEq33_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sigma$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq33.gif" /></alternatives></inline-formula></p></th></tr></thead><tbody><tr><td align="left" rowspan="8"><p>Input</p></td><td align="left"><p>2048</p></td><td align="left"><p>2048</p></td></tr><tr><td align="left"><p>Linear/ReLU 2048<inline-formula id="IEq34"><alternatives><mml:math id="IEq34_Math"><mml:mo stretchy="false">→</mml:mo></mml:math><tex-math id="IEq34_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rightarrow$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq34.gif" /></alternatives></inline-formula>128</p></td><td align="left"><p>Linear/ReLU 2048<inline-formula id="IEq35"><alternatives><mml:math id="IEq35_Math"><mml:mo stretchy="false">→</mml:mo></mml:math><tex-math id="IEq35_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rightarrow$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq35.gif" /></alternatives></inline-formula>128</p></td></tr><tr><td align="left"><p>Linear/ReLU 128<inline-formula id="IEq36"><alternatives><mml:math id="IEq36_Math"><mml:mo stretchy="false">→</mml:mo></mml:math><tex-math id="IEq36_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rightarrow$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq36.gif" /></alternatives></inline-formula>128</p></td><td align="left"><p>Linear/ReLU 128 <inline-formula id="IEq37"><alternatives><mml:math id="IEq37_Math"><mml:mo stretchy="false">→</mml:mo></mml:math><tex-math id="IEq37_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rightarrow$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq37.gif" /></alternatives></inline-formula> 1</p></td></tr><tr><td align="left"><p>128-residual</p></td><td align="left"><p>output <inline-formula id="IEq38"><alternatives><mml:math id="IEq38_Math"><mml:mi>σ</mml:mi></mml:math><tex-math id="IEq38_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sigma$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq38.gif" /></alternatives></inline-formula></p></td></tr><tr><td align="left"><p>128-residual</p></td><td align="left" /></tr><tr><td align="left"><p>128-residual</p></td><td align="left" /></tr><tr><td align="left"><p>Linear/ReLU 128<inline-formula id="IEq39"><alternatives><mml:math id="IEq39_Math"><mml:mo stretchy="false">→</mml:mo></mml:math><tex-math id="IEq39_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rightarrow$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq39.gif" /></alternatives></inline-formula>128</p></td><td align="left" /></tr><tr><td align="left"><p>output <inline-formula id="IEq40"><alternatives><mml:math id="IEq40_Math"><mml:mi>μ</mml:mi></mml:math><tex-math id="IEq40_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mu$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq40.gif" /></alternatives></inline-formula></p></td><td align="left" /></tr></tbody></table></table-wrap></p>
          <p id="Par10">We train separate networks for <inline-formula id="IEq47"><alternatives><mml:math id="IEq47_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>13</mml:mn></mml:msup><mml:mi mathvariant="normal">C</mml:mi></mml:mrow></mml:math><tex-math id="IEq47_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^{13}\mathrm{C}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq47.gif" /></alternatives></inline-formula> and <inline-formula id="IEq48"><alternatives><mml:math id="IEq48_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>1</mml:mn></mml:msup><mml:mi mathvariant="normal">H</mml:mi></mml:mrow></mml:math><tex-math id="IEq48_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^1\mathrm{H}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq48.gif" /></alternatives></inline-formula> chemical shifts. Each network takes approximately 4 hours to train on a V100 GPU on an Amazon Web Services p3.2xlarge instance. All code is implemented in PyTorch 0.4.1.</p>
          <p id="Par11">A challenge with applying machine learning techniques (as opposed to more conventional statistical or probabilistic techniques) to scientific data is these methods focus on producing point estimates. In a sense, a neural network doesn’t know what it doesn’t know. This can make their application challenging as for many applications minimization of an error metric is less useful without some understanding of how bad that error might be. Taking inspiration from recent attempts to resolve these challenges, we augment our network to produce an estimate both of the mean of a chemical shift value and the variance.</p>
          <p id="Par12">There has recently been tremendous research interest in getting deep learning methods to provide measures of uncertainty with their predictions, including injecting noise into the network at prediction time [<xref ref-type="bibr" rid="CR8">8</xref>] and minimizing a variational objective [<xref ref-type="bibr" rid="CR9">9</xref>]. We adopt a simpler approach of having our network simply calculate the mean and an uncertainty value for each predicted shift value. We then minimize the scaled mean squared error of this model, giving a loss function of<disp-formula id="Equ3"><label>3</label><alternatives><mml:math display="block" id="Equ3_Math"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mfrac><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mrow><mml:mn>2</mml:mn><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:msub><mml:mi>σ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><tex-math id="Equ3_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} \frac{(y_i - \mu _i)^2}{2\sigma _i^2} + \sigma _i \end{aligned}$$\end{document}</tex-math><graphic position="anchor" xlink:href="13321_2019_374_Article_Equ3.gif" /></alternatives></disp-formula>where <inline-formula id="IEq49"><alternatives><mml:math id="IEq49_Math"><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><tex-math id="IEq49_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$y_i$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq49.gif" /></alternatives></inline-formula> is the predicted value, <inline-formula id="IEq50"><alternatives><mml:math id="IEq50_Math"><mml:msub><mml:mi>μ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><tex-math id="IEq50_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mu _i$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq50.gif" /></alternatives></inline-formula> is the true value, and <inline-formula id="IEq51"><alternatives><mml:math id="IEq51_Math"><mml:msub><mml:mi>σ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><tex-math id="IEq51_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sigma _i$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq51.gif" /></alternatives></inline-formula> is the uncertainty value. Inspection reveals this to be functionally similar to the negative log likelihood of a normal distribution with variance <inline-formula id="IEq52"><alternatives><mml:math id="IEq52_Math"><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:math><tex-math id="IEq52_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sigma _i^2$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq52.gif" /></alternatives></inline-formula>. We independently predict both <inline-formula id="IEq53"><alternatives><mml:math id="IEq53_Math"><mml:mi>μ</mml:mi></mml:math><tex-math id="IEq53_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mu$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq53.gif" /></alternatives></inline-formula> and <inline-formula id="IEq54"><alternatives><mml:math id="IEq54_Math"><mml:mi>σ</mml:mi></mml:math><tex-math id="IEq54_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sigma$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq54.gif" /></alternatives></inline-formula> for each vertex, and our loss function zeros out the loss at unobserved nuclei.</p>
          <p id="Par13">For input data we use the data available in nmrshiftdb2 [<xref ref-type="bibr" rid="CR10">10</xref>], a user-contributed database of 43,468 molecules and 52,731 spectra.<xref ref-type="fn" rid="Fn1">1</xref> We identified all molecules in nmrshiftdb2 with annotated <inline-formula id="IEq55"><alternatives><mml:math id="IEq55_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>13</mml:mn></mml:msup><mml:mi mathvariant="normal">C</mml:mi></mml:mrow></mml:math><tex-math id="IEq55_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^{13}\mathrm{C}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq55.gif" /></alternatives></inline-formula> or <inline-formula id="IEq56"><alternatives><mml:math id="IEq56_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>1</mml:mn></mml:msup><mml:mi mathvariant="normal">H</mml:mi></mml:mrow></mml:math><tex-math id="IEq56_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^1\mathrm{H}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq56.gif" /></alternatives></inline-formula> chemical shift values containing only the elements {H, C, O, N, P, S, F, Cl}, excluding elements with a very low occurrence in nmrshiftdb2. We excluded any molecules which failed to successfully pass the sanitize process in RDKit [<xref ref-type="bibr" rid="CR11">11</xref>] and had no more than 64 atoms. This left us with a total of 32,538 molecules with an average size of 29 atoms. Figure <xref rid="Fig1" ref-type="fig">1</xref> shows the distribution of molecule sizes. 11,616 <inline-formula id="IEq57"><alternatives><mml:math id="IEq57_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>13</mml:mn></mml:msup><mml:mi mathvariant="normal">C</mml:mi></mml:mrow></mml:math><tex-math id="IEq57_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^{13}\mathrm{C}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq57.gif" /></alternatives></inline-formula> nuclei had more than one measurement and 1013 <inline-formula id="IEq58"><alternatives><mml:math id="IEq58_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>1</mml:mn></mml:msup><mml:mi mathvariant="normal">H</mml:mi></mml:mrow></mml:math><tex-math id="IEq58_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^1\mathrm{H}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq58.gif" /></alternatives></inline-formula> nuclei had more than one measurement; if we assume the “true” value for a nucleus is the average of all its values, and then compute the mean absolute error we arrive at 0.51 ppm for <inline-formula id="IEq59"><alternatives><mml:math id="IEq59_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>13</mml:mn></mml:msup><mml:mi mathvariant="normal">C</mml:mi></mml:mrow></mml:math><tex-math id="IEq59_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^{13}\mathrm{C}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq59.gif" /></alternatives></inline-formula> and 0.09 ppm for <inline-formula id="IEq60"><alternatives><mml:math id="IEq60_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>1</mml:mn></mml:msup><mml:mi mathvariant="normal">H</mml:mi></mml:mrow></mml:math><tex-math id="IEq60_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^1\mathrm{H}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq60.gif" /></alternatives></inline-formula>, suggesting an intrinsic measurement variability on this order for this dataset.<fig id="Fig1"><label>Fig. 1</label><caption xml:lang="en"><p>Distribution of atom sizes in our identified data subset</p></caption><graphic specific-use="HTML" mime-subtype="PNG" xlink:href="MediaObjects/13321_2019_374_Fig1_HTML.png" /></fig></p>
          <p id="Par15">Multiple molecules in nmrshiftdb2 have multiple spectra, so we made sure that all measurements were in a given train/test split. We trained on 80% of the data and held out 20% for evaluation. We validated this train/test split via SMILES strings, ensuring that no molecule in the train set had the same SMILES string as one in the test set. The dataset used was Revision 1624 from the nmrshiftdb2 on sourceforge.net. They can be accessed via <ext-link xlink:href="https://sourceforge.net/p/nmrshiftdb2/code/1624/" ext-link-type="uri">https://sourceforge.net/p/nmrshiftdb2/code/1624/</ext-link>.</p>
        </sec>
        <sec id="Sec3" sec-type="results">
          <title>Results</title>
          <p id="Par16">We show the accuracy of our method for both <inline-formula id="IEq61"><alternatives><mml:math id="IEq61_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>13</mml:mn></mml:msup><mml:mi mathvariant="normal">C</mml:mi></mml:mrow></mml:math><tex-math id="IEq61_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^{13}\mathrm{C}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq61.gif" /></alternatives></inline-formula> and <inline-formula id="IEq62"><alternatives><mml:math id="IEq62_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>1</mml:mn></mml:msup><mml:mi mathvariant="normal">H</mml:mi></mml:mrow></mml:math><tex-math id="IEq62_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^1\mathrm{H}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq62.gif" /></alternatives></inline-formula> chemical shift prediction as a function of the true ppm in Fig. <xref rid="Fig2" ref-type="fig">2</xref>d and e as well as the range of prediction errors, at a level corresponding to predicting 95% of the nuclei in the dataset. Our accuracy closely tracks the fraction of chemical shifts observed in the initial data, across the entire dataset.
<fig id="Fig2"><label>Fig. 2</label><caption xml:lang="en"><p><bold>a</bold> A convolutional graph neural network computes per-vertex (atom) parameters by performing a weighted linear combination of neighboring vertices, and then passing the result through a nonlinearity. <bold>b</bold> Successive layers serve to aggregate information from more and more distant vertices (atoms), respecting the connectivity of the graph. The resulting per-vertex features are then passed through a series of linear layers to estimate a chemical shift value and a confidence level for each vertex (atom). <bold>c</bold> Mean absolute prediction error for <inline-formula id="IEq12"><alternatives><mml:math id="IEq12_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>13</mml:mn></mml:msup><mml:mi mathvariant="normal">C</mml:mi></mml:mrow></mml:math><tex-math id="IEq12_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^{13}\mathrm{C}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq12.gif" /></alternatives></inline-formula> and <inline-formula id="IEq13"><alternatives><mml:math id="IEq13_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>1</mml:mn></mml:msup><mml:mi mathvariant="normal">H</mml:mi></mml:mrow></mml:math><tex-math id="IEq13_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^1\mathrm{H}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq13.gif" /></alternatives></inline-formula> chemical shifts, comparing classical HOSE codes, ab initio calculations, and our graphical neural network. Error bars are bootstrap-estimated 95% confidence intervals for the mean. <bold>d</bold> GNN chemical shift errors for <inline-formula id="IEq14"><alternatives><mml:math id="IEq14_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>13</mml:mn></mml:msup><mml:mi mathvariant="normal">C</mml:mi></mml:mrow></mml:math><tex-math id="IEq14_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^{13}\mathrm{C}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq14.gif" /></alternatives></inline-formula> as a function of true shift (ppm), showing mean error, standard deviation of the error, and max error. Lower panel shows the fraction of the training data present at that chemical shift. <bold>e</bold> Same as (<bold>d</bold>) but for <inline-formula id="IEq15"><alternatives><mml:math id="IEq15_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>1</mml:mn></mml:msup><mml:mi mathvariant="normal">H</mml:mi></mml:mrow></mml:math><tex-math id="IEq15_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^1\mathrm{H}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq15.gif" /></alternatives></inline-formula></p></caption><graphic specific-use="HTML" mime-subtype="PNG" xlink:href="MediaObjects/13321_2019_374_Fig2_HTML.png" /></fig></p>
          <p id="Par17">Evaluation of uncertainty-preserving methods must take into account the fraction of data at a given uncertainty level when making predictions. Different methods will have differing levels of certainty for different fractions of the data. Depending on the use case, a method may be very confident (and accurate) on a small minority of the data, and substantially less confident (and accurate) on a larger portion of data. It can be challenging to compare this to a method which is uniformly confident and more accurate on average across all data. To resolve this, we compute the fraction of nuclei that the method would predict at a given confidence threshold, and then compute the mean error of that fraction. Figure <xref rid="Fig3" ref-type="fig">3</xref>a, b show the comparison between HOSE and GNNs for <inline-formula id="IEq66"><alternatives><mml:math id="IEq66_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>13</mml:mn></mml:msup><mml:mi mathvariant="normal">C</mml:mi></mml:mrow></mml:math><tex-math id="IEq66_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^{13}\mathrm{C}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq66.gif" /></alternatives></inline-formula> and <inline-formula id="IEq67"><alternatives><mml:math id="IEq67_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>1</mml:mn></mml:msup><mml:mi mathvariant="normal">H</mml:mi></mml:mrow></mml:math><tex-math id="IEq67_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^1\mathrm{H}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq67.gif" /></alternatives></inline-formula>, respectively. We see that GNNs tie or outperform HOSE codes for all thresholds, but HOSE’s performance on <inline-formula id="IEq68"><alternatives><mml:math id="IEq68_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>13</mml:mn></mml:msup><mml:mi mathvariant="normal">C</mml:mi></mml:mrow></mml:math><tex-math id="IEq68_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^{13}\mathrm{C}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq68.gif" /></alternatives></inline-formula>  is very competitive in the high-confidence regime. This makes sense, as HOSE codes are fundamentally a nearest-neighbor method, and can perform exceptionally well when there are very-similar molecules in the training data (Table <xref rid="Tab3" ref-type="table">3</xref>).<fig id="Fig3"><label>Fig. 3</label><caption xml:lang="en"><p>Method comparison. <bold>a</bold> Mean absolute error (ppm) for <inline-formula id="IEq63"><alternatives><mml:math id="IEq63_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>13</mml:mn></mml:msup><mml:mi mathvariant="normal">C</mml:mi></mml:mrow></mml:math><tex-math id="IEq63_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^{13}\mathrm{C}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq63.gif" /></alternatives></inline-formula>  nuclei predicted at a given confidence interval for our network and for HOSE codes. The x-axis is the fraction of nuclei we predict at that confidence interval. HOSE codes provide a discrete (sphere-number) measure of confidence. Comparison is across all selected NMRShiftDB molecules. <bold>b</bold> same as a. for <inline-formula id="IEq64"><alternatives><mml:math id="IEq64_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>1</mml:mn></mml:msup><mml:mi mathvariant="normal">H</mml:mi></mml:mrow></mml:math><tex-math id="IEq64_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^1\mathrm{H}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq64.gif" /></alternatives></inline-formula>. <bold>c</bold> Prediction errors broken down by bonding partner. Errors are worse for more electronegative bonding partners as expected. <bold>d</bold> Same as c for <inline-formula id="IEq65"><alternatives><mml:math id="IEq65_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>1</mml:mn></mml:msup><mml:mi mathvariant="normal">H</mml:mi></mml:mrow></mml:math><tex-math id="IEq65_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^1\mathrm{H}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq65.gif" /></alternatives></inline-formula>. Error bars are bootstrap-estimated 95% confidence intervals for the mean</p></caption><graphic specific-use="HTML" mime-subtype="PNG" xlink:href="MediaObjects/13321_2019_374_Fig3_HTML.png" /></fig><table-wrap id="Tab3"><label>Table 3</label><caption xml:lang="en"><p>Mean average error for predicted nuclei subset at various confidence thresholds</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" rowspan="2"><p>Frac data (%)</p></th><th align="left" colspan="2"><p><inline-formula id="IEq69"><alternatives><mml:math id="IEq69_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>13</mml:mn></mml:msup><mml:mi mathvariant="normal">C</mml:mi></mml:mrow></mml:math><tex-math id="IEq69_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^{13}\mathrm{C}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq69.gif" /></alternatives></inline-formula> MAE</p></th><th align="left" colspan="2"><p><inline-formula id="IEq70"><alternatives><mml:math id="IEq70_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>1</mml:mn></mml:msup><mml:mi mathvariant="normal">H</mml:mi></mml:mrow></mml:math><tex-math id="IEq70_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^1\mathrm{H}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq70.gif" /></alternatives></inline-formula> MAE</p></th></tr><tr><th align="left"><p>GNN</p></th><th align="left"><p>HOSE</p></th><th align="left"><p>GNN</p></th><th align="left"><p>HOSE</p></th></tr></thead><tbody><tr><td align="left"><p>100</p></td><td char="." align="char"><p>1.43</p></td><td char="." align="char"><p>2.85</p></td><td char="." align="char"><p>0.28</p></td><td char="." align="char"><p>0.33</p></td></tr><tr><td align="left"><p>95</p></td><td char="." align="char"><p>1.35</p></td><td char="." align="char"><p>1.65</p></td><td char="." align="char"><p>0.22</p></td><td char="." align="char"><p>0.22</p></td></tr><tr><td align="left"><p>80</p></td><td char="." align="char"><p>1.27</p></td><td char="." align="char"><p>1.65</p></td><td char="." align="char"><p>0.18</p></td><td char="." align="char"><p>0.22</p></td></tr><tr><td align="left"><p>50</p></td><td char="." align="char"><p>1.11</p></td><td char="." align="char"><p>1.13</p></td><td char="." align="char"><p>0.14</p></td><td char="." align="char"><p>0.17</p></td></tr><tr><td align="left"><p>25</p></td><td char="." align="char"><p>0.91</p></td><td char="." align="char"><p>0.88</p></td><td char="." align="char"><p>0.11</p></td><td align="left" /></tr><tr><td align="left"><p>10</p></td><td char="." align="char"><p>0.71</p></td><td align="left" /><td char="." align="char"><p>0.09</p></td><td align="left" /></tr></tbody></table><table-wrap-foot><p>For example, at the level of confidence were both methods are able to predict 80% of the nuclei, the GNN has a MAE of 1.27 ppm and HOSE codes have a MAE of 1.65 ppm for <inline-formula id="IEq71"><alternatives><mml:math id="IEq71_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>13</mml:mn></mml:msup><mml:mi mathvariant="normal">C</mml:mi></mml:mrow></mml:math><tex-math id="IEq71_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^{13}\mathrm{C}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq71.gif" /></alternatives></inline-formula></p></table-wrap-foot></table-wrap></p>
          <p id="Par18">To compare with DFT methods we identified a subset of 177 molecules in nmrshiftdb which had the greatest number of independent spectral measurements, and followed best practices for ab initio calculation chemical shift values (see Additional file <xref ref-type="supplementary-material" rid="MOESM1">1</xref>: Section 2.2). Table <xref rid="Tab4" ref-type="table">4</xref> shows the results for per-nucleus and per-molecule estimation for both <inline-formula id="IEq74"><alternatives><mml:math id="IEq74_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>13</mml:mn></mml:msup><mml:mi mathvariant="normal">C</mml:mi></mml:mrow></mml:math><tex-math id="IEq74_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^{13}\mathrm{C}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq74.gif" /></alternatives></inline-formula> and <inline-formula id="IEq75"><alternatives><mml:math id="IEq75_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>1</mml:mn></mml:msup><mml:mi mathvariant="normal">H</mml:mi></mml:mrow></mml:math><tex-math id="IEq75_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^1\mathrm{H}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq75.gif" /></alternatives></inline-formula> nuclei. DFT methods struggle to calculate chemical shifts for atoms bonded to halogens, as shown in Fig. <xref rid="Fig3" ref-type="fig">3</xref>c for <inline-formula id="IEq76"><alternatives><mml:math id="IEq76_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>13</mml:mn></mml:msup><mml:mi mathvariant="normal">C</mml:mi></mml:mrow></mml:math><tex-math id="IEq76_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^{13}\mathrm{C}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq76.gif" /></alternatives></inline-formula> and Fig. <xref rid="Fig3" ref-type="fig">3</xref>d for <inline-formula id="IEq77"><alternatives><mml:math id="IEq77_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>1</mml:mn></mml:msup><mml:mi mathvariant="normal">H</mml:mi></mml:mrow></mml:math><tex-math id="IEq77_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^1\mathrm{H}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq77.gif" /></alternatives></inline-formula>.<table-wrap id="Tab4"><label>Table 4</label><caption xml:lang="en"><p>Comparison of chemical shift prediction accuracy for 177-molecule subset across methods, for various metrics</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"><p>Nucleus</p></th><th align="left"><p>Method</p></th><th align="left"><p>mol MAE</p></th><th align="left"><p>mol RMSE</p></th><th align="left"><p>MAE</p></th></tr></thead><tbody><tr><td align="left" rowspan="3"><p><inline-formula id="IEq72"><alternatives><mml:math id="IEq72_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>13</mml:mn></mml:msup><mml:mi mathvariant="normal">C</mml:mi></mml:mrow></mml:math><tex-math id="IEq72_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^{13}\mathrm{C}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq72.gif" /></alternatives></inline-formula></p></td><td align="left"><p>GNN</p></td><td char="." align="char"><p>1.01</p></td><td char="." align="char"><p>1.20</p></td><td char="." align="char"><p>0.97</p></td></tr><tr><td align="left"><p>HOSE</p></td><td char="." align="char"><p>3.42</p></td><td char="." align="char"><p>4.24</p></td><td char="." align="char"><p>2.56</p></td></tr><tr><td align="left"><p>Ab Initio</p></td><td char="." align="char"><p>2.24</p></td><td char="." align="char"><p>2.73</p></td><td char="." align="char"><p>1.92</p></td></tr><tr><td align="left" rowspan="3"><p><inline-formula id="IEq73"><alternatives><mml:math id="IEq73_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>1</mml:mn></mml:msup><mml:mi mathvariant="normal">H</mml:mi></mml:mrow></mml:math><tex-math id="IEq73_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^1\mathrm{H}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq73.gif" /></alternatives></inline-formula></p></td><td align="left"><p>GNN</p></td><td char="." align="char"><p>0.30</p></td><td char="." align="char"><p>0.40</p></td><td char="." align="char"><p>0.29</p></td></tr><tr><td align="left"><p>HOSE</p></td><td char="." align="char"><p>0.45</p></td><td char="." align="char"><p>0.59</p></td><td char="." align="char"><p>0.42</p></td></tr><tr><td align="left"><p>Ab Initio</p></td><td char="." align="char"><p>0.39</p></td><td char="." align="char"><p>0.57</p></td><td char="." align="char"><p>0.37</p></td></tr></tbody></table><table-wrap-foot><p>“mol“ methods are first averaged per-mol (see Additional file <xref ref-type="supplementary-material" rid="MOESM1">1</xref>: Section 1). All predictions are made without uncertainty filtering for GNN and HOSE</p></table-wrap-foot></table-wrap></p>
          <p id="Par19">We evaluated runtime performance in Table <xref rid="Tab5" ref-type="table">5</xref> on per-molecule and per-predicted-nucleus runtimes. While our method is faster than computing HOSE codes this may be due to implementation differences, with our neural network running on a modern GPU and HOSE code invocation requiring a database-lookup. Both methods are orders of magnitude faster than performing ab initio calculations.<table-wrap id="Tab5"><label>Table 5</label><caption xml:lang="en"><p>Runtime comparison</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"><p>Method</p></th><th align="left"><p>Note</p></th><th align="left"><p>Per-mol</p></th><th align="left"><p>Per-nucleus</p></th></tr></thead><tbody><tr><td align="left"><p>GNN<sup>a</sup></p></td><td align="left" /><td align="left"><p>3.6 ms</p></td><td align="left"><p>56 μs</p></td></tr><tr><td align="left" rowspan="2"><p>HOSE<sup>b</sup></p></td><td align="left"><p><inline-formula id="IEq79"><alternatives><mml:math id="IEq79_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>13</mml:mn></mml:msup><mml:mi mathvariant="normal">C</mml:mi></mml:mrow></mml:math><tex-math id="IEq79_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^{13}\mathrm{C}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq79.gif" /></alternatives></inline-formula></p></td><td align="left"><p>29 ms</p></td><td align="left"><p>2 ms</p></td></tr><tr><td align="left"><p><inline-formula id="IEq80"><alternatives><mml:math id="IEq80_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>1</mml:mn></mml:msup><mml:mi mathvariant="normal">H</mml:mi></mml:mrow></mml:math><tex-math id="IEq80_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^1\mathrm{H}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq80.gif" /></alternatives></inline-formula></p></td><td align="left"><p>34 ms</p></td><td align="left"><p>4 ms</p></td></tr><tr><td align="left" rowspan="2"><p>DFT<sup>c</sup></p></td><td align="left"><p>geom. opt</p></td><td align="left"><p>556 s</p></td><td align="left"><p>36 s</p></td></tr><tr><td align="left"><p>GIAO</p></td><td align="left"><p>256 s</p></td><td align="left"><p>16 s</p></td></tr></tbody></table><table-wrap-foot><p><sup>a</sup> GNN computes a fixed number of nuclei (64) at all times</p><p><sup>b</sup> HOSE predictions, by virtue of being a nearest-neighborhood method, take longer on larger training datasets</p><p><sup>c</sup> DFT comparison is the mean of wall-clock runtime, but this should be interpreted cautiously given the tremendous variance in number of conformers per molecule and the <inline-formula id="IEq81"><alternatives><mml:math id="IEq81_Math"><mml:mrow><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>n</mml:mi><mml:mn>3</mml:mn></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><tex-math id="IEq81_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$O(n^3)$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq81.gif" /></alternatives></inline-formula> scaling</p></table-wrap-foot></table-wrap></p>
          <p id="Par20">Finally, we looked at some of the molecules in the test set where our method performed the worst. We can see in Fig. <xref rid="Fig4" ref-type="fig">4</xref> that many have exotic structures, are radicals, or have an unusual abundance of halogens. Upon closer examination, the final example molecule has its predicted shifts off by a consistent 5 ppm, suggesting a possible reference error. As the data in nmrshiftdb2 is user-contributed, we were unable to confirm this is in fact the source of the error, but this highlights a potential unexpected use of our method in rapid checking of user-submitted structures and peaks.<fig id="Fig4"><label>Fig. 4</label><caption xml:lang="en"><p>A subset of the molecules in our test set for which we had the highest RMSE error. Many have exotic structures, are radicals, or have an unusual abundance of halogens. Upon closer examination, the final example molecule has its predicted shifts off by a consistent 5 ppm, suggesting a possible reference error</p></caption><graphic specific-use="HTML" mime-subtype="PNG" xlink:href="MediaObjects/13321_2019_374_Fig4_HTML.png" /></fig></p>
        </sec>
        <sec id="Sec4" sec-type="discussion">
          <title>Discussion</title>
          <p id="Par21">While our approach shows the promise of graphical neural networks with uncertainty in predicting per-nucleus properties such as chemical shift, we note several caveats. First, our method ignores solvent and temperature effects, which are known to alter chemical shift values in experiments. The vast majority of user-contributed NMR spectra in NMRShiftDB are contributed without an indicated solvent or temperature, and this likely contributes significantly to noise in our training dataset. A promising avenue would be to combine high-throughput ab initio data with high-quality careful experimental data (transfer learning). Second, by focusing on purely connectivity (bond-order) information, we are ignoring stereochemical effects and geometry-specific effects. It may be the case that explicitly incorporating geometric properties into our model would improve prediction accuracy, but this is left for future work.</p>
          <p id="Par22">Finally, any comparison with ab initio techniques is going to be extremely sensitive to the level of theory and molecular dataset used for comparison. More accurate incorporation of conformational effects [<xref ref-type="bibr" rid="CR12">12</xref>] can yield considerably more-accurate calculated shift values, at the expense of considerable computation time. Also, any comparisons of method performance are going to be sensitive to the molecules included in the validation set.</p>
          <p id="Par23">We view our method as a useful step towards the fully ML-based prediction of nuclear magnetic resonance spectra for structure elucidation. Our method is integrated with the NMRShiftDB database, and all code and data are available under a BSD license. Additional properties, such as indirect dipolar coupling (J-coupling) coefficients and nuclear Overhauser-effect (NOE) couplings should be amenable to the methods we describe in this paper. Combined with recent work in other spectroscopic techniques, such as solid-state NMR chemical shifts [<xref ref-type="bibr" rid="CR13">13</xref>] and IR spectroscopy[<xref ref-type="bibr" rid="CR14">14</xref>], we can imagine a regime where the prediction of multiple spectroscopic parameters could be automated and nearly instantaneous for many chemical tasks.
</p>
        </sec>
        <sec id="Sec5" sec-type="conclusions">
          <title>Conclusion</title>
          <p id="Par24">We have demonstrated the use of deep neural networks for predicting single-atom properties of molecules, in particular NMR shifts. We achieved a precision of 1.2 ppm mol RMSE for <inline-formula id="IEq82"><alternatives><mml:math id="IEq82_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>13</mml:mn></mml:msup><mml:mi mathvariant="normal">C</mml:mi></mml:mrow></mml:math><tex-math id="IEq82_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^{13}\mathrm{C}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq82.gif" /></alternatives></inline-formula>  and 0.4 ppm mol RMSE for <inline-formula id="IEq83"><alternatives><mml:math id="IEq83_Math"><mml:mrow><mml:msup><mml:mrow /><mml:mn>1</mml:mn></mml:msup><mml:mi mathvariant="normal">H</mml:mi></mml:mrow></mml:math><tex-math id="IEq83_TeX">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym}
				\usepackage{amsfonts}
				\usepackage{amssymb}
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${^1\mathrm{H}}$$\end{document}</tex-math><inline-graphic xlink:href="13321_2019_374_Article_IEq83.gif" /></alternatives></inline-formula> shifts. This is significantly better than conventional HOSE code-based prediction, and can achieve the reliability of a DFT-based prediction for an identified subset of molecules. Finally, our method incorporates an uncertainty measurement for predictions, enabling confident predictions for subsequent structure elucidation tasks. We have integrated our approach with the online NMRShiftDB website, allowing users to upload candidate structures and receive rapid predictions for chemical shift values, and anticipate improving both accuracy and molecular coverage in the future.</p>
        </sec>
      </body>
      <back>
        <ack>
          <title>Acknowledgements</title>
          <p>We would like to thank Konrad Kording, Ren Ng, Ben Recht, Nick Boyd, Max Simchowitz and Yarden Katz for helpful discussions, and Kathleen Durkin for help with the ab initio calculations. Thanks to Nils Schlörer and the NMR team at Universität zu Köln for supporting nmrshiftdb2.</p>
        </ack>
        <sec sec-type="author-contribution">
          <title>Authors' contributions</title>
          <p>EJ and SK jointly designed the experiment and wrote the paper. EJ wrote the neural network code and conducted experiments. EJ conducted the ab initio calculations. SK conducted the HOSE code experiments. Both authors read and approved the final manuscript.</p>
        </sec>
        <sec>
          <title>Funding</title>
          <p>EJ is funded by ONR N00014-17-1-2401 and an Amazon Web Services research credits grant. SK is funded by De Montfort University. All ab initio calculations were performed at the Molecular Graphics and Computation facility at UC Berkeley supported by NIH S10OD023532.</p>
        </sec>
        <sec sec-type="data-availability">
          <title>Availability of data and materials</title>
          <p>The assigned NMR data in nmrshiftdb2 can be browsed at <ext-link xlink:href="https://www.nmrshiftdb.org" ext-link-type="uri">https://www.nmrshiftdb.org</ext-link> and are available from <ext-link xlink:href="https://sourceforge.net/p/nmrshiftdb2/code/HEAD/tree/trunk/snapshots/" ext-link-type="uri">https://sourceforge.net/p/nmrshiftdb2/code/HEAD/tree/trunk/snapshots/</ext-link> for download. The source code of the project along with data are available in the Additional file <xref ref-type="supplementary-material" rid="MOESM2">2</xref>.</p>
        </sec>
        <sec sec-type="ethics-statement">
          <sec id="FPar2" sec-type="COI-statement">
            <title>Competing interests</title>
            <p id="Par27">The authors declare that they have no competing interests.</p>
          </sec>
        </sec>
        <ref-list id="Bib1">
          <title>References</title>
          <ref-list>
            <ref id="CR1">
              <label>1.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Zangger</surname>
                    <given-names>K</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Pure shift NMR</article-title>
                <source>Prog Nucl Magn Reson Spectr</source>
                <year>2015</year>
                <volume>86–87</volume>
                <fpage>1</fpage>
                <lpage>20</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BC2MXjtValt7c%3D</pub-id>
                <pub-id pub-id-type="doi">10.1016/j.pnmrs.2015.02.002</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR2">
              <label>2.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Bremser</surname>
                    <given-names>W</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Hose – a novel substructure code</article-title>
                <source>Anal Chim Acta</source>
                <year>1978</year>
                <volume>103</volume>
                <issue>4</issue>
                <fpage>355</fpage>
                <lpage>365</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DyaE1MXhtVaktL4%3D</pub-id>
                <pub-id pub-id-type="doi">10.1016/S0003-2670(01)83100-7</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR3">
              <label>3.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Lodewyk</surname>
                    <given-names>MW</given-names>
                  </name>
                  <name>
                    <surname>Siebert</surname>
                    <given-names>MR</given-names>
                  </name>
                  <name>
                    <surname>Tantillo</surname>
                    <given-names>DJ</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Computational prediction of 1H and 13C chemical shifts: a useful tool for natural product, mechanistic, and synthetic organic chemistry</article-title>
                <source>Chem Rev</source>
                <year>2012</year>
                <volume>112</volume>
                <issue>3</issue>
                <fpage>1839</fpage>
                <lpage>1862</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BC3MXhsV2jur3O</pub-id>
                <pub-id pub-id-type="doi">10.1021/cr200106v</pub-id>
                <pub-id pub-id-type="pmid">22091891</pub-id>
                <comment>arXiv:1011.1669v3</comment>
              </mixed-citation>
            </ref>
            <ref id="CR4">
              <label>4.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Willoughby</surname>
                    <given-names>PH</given-names>
                  </name>
                  <name>
                    <surname>Jansma</surname>
                    <given-names>MJ</given-names>
                  </name>
                  <name>
                    <surname>Hoye</surname>
                    <given-names>TR</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">A guide to small-molecule structure assignment through computation of (1H and 13C) NMR chemical shifts</article-title>
                <source>Nat Protoc</source>
                <year>2014</year>
                <volume>9</volume>
                <issue>3</issue>
                <fpage>643</fpage>
                <lpage>60</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BC2cXmtVehu7w%3D</pub-id>
                <pub-id pub-id-type="doi">10.1038/nprot.2014.042</pub-id>
                <pub-id pub-id-type="pmid">24556787</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR5">
              <label>5.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Kipf</surname>
                    <given-names>TN</given-names>
                  </name>
                  <name>
                    <surname>Welling</surname>
                    <given-names>M</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Semi-supervised classification with graph convolutional networks</article-title>
                <source>arXiv</source>
                <year>2016</year>
                <pub-id pub-id-type="doi">10.1051/0004-6361/201527329</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR6">
              <label>6.</label>
              <mixed-citation publication-type="other">Battaglia PW, Hamrick JB, Bapst V, Sanchez-Gonzalez A, Zambaldi V, Malinowski M, Tacchetti A, Raposo D, Santoro A, Faulkner R, Gulcehre C, Song F, Ballard A, Gilmer J, Dahl G, Vaswani A, Allen K, Nash C, Langston V, Dyer C, Heess N, Wierstra D, Kohli P, Botvinick M, Vinyals O, Li Y, Pascanu R (2018) Relational inductive biases, deep learning, and graph networks, 1–38. <ext-link xlink:href="http://arxiv.org/abs/1806.01261" ext-link-type="uri">arXiv:1806.01261</ext-link></mixed-citation>
            </ref>
            <ref id="CR7">
              <label>7.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Wu</surname>
                    <given-names>Z</given-names>
                  </name>
                  <name>
                    <surname>Ramsundar</surname>
                    <given-names>B</given-names>
                  </name>
                  <name>
                    <surname>Feinberg</surname>
                    <given-names>EN</given-names>
                  </name>
                  <name>
                    <surname>Gomes</surname>
                    <given-names>J</given-names>
                  </name>
                  <name>
                    <surname>Geniesse</surname>
                    <given-names>C</given-names>
                  </name>
                  <name>
                    <surname>Pappu</surname>
                    <given-names>AS</given-names>
                  </name>
                  <name>
                    <surname>Leswing</surname>
                    <given-names>K</given-names>
                  </name>
                  <name>
                    <surname>Pande</surname>
                    <given-names>V</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">MoleculeNet: a benchmark for molecular machine learning</article-title>
                <source>Chem Sci</source>
                <year>2017</year>
                <volume>9</volume>
                <fpage>513</fpage>
                <lpage>530</lpage>
                <pub-id pub-id-type="doi">10.1039/C7SC02664A</pub-id>
                <pub-id pub-id-type="pmid">29629118</pub-id>
                <pub-id pub-id-type="pmcid">5868307</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR8">
              <label>8.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Wang</surname>
                    <given-names>Hao</given-names>
                  </name>
                  <name>
                    <surname>Yeung</surname>
                    <given-names>Dit-Yan</given-names>
                  </name>
                </person-group>
                <article-title>Towards Bayesian Deep Learning: A Framework and Some Existing Methods</article-title>
                <source>IEEE Transactions on Knowledge and Data Engineering</source>
                <year>2016</year>
                <volume>28</volume>
                <issue>12</issue>
                <fpage>3395</fpage>
                <lpage>3408</lpage>
                <pub-id pub-id-type="doi">10.1109/TKDE.2016.2606428</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR9">
              <label>9.</label>
              <mixed-citation publication-type="other">Li Y, Gal Y (2017) Dropout Inference in Bayesian neural networks with alpha-divergences. <ext-link xlink:href="http://arxiv.org/abs/1703.02914" ext-link-type="uri">arXiv:1703.02914</ext-link></mixed-citation>
            </ref>
            <ref id="CR10">
              <label>10.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Kuhn</surname>
                    <given-names>S</given-names>
                  </name>
                  <name>
                    <surname>Schlorer</surname>
                    <given-names>NE</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Facilitating quality control for spectra assignments of small organic molecules: nmrshiftdb2-a free in-house NMR database with integrated LIMS for academic service laboratories</article-title>
                <source>Magn Reson Chem</source>
                <year>2015</year>
                <volume>53</volume>
                <issue>8</issue>
                <fpage>582</fpage>
                <lpage>589</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BC2MXovVCgtrk%3D</pub-id>
                <pub-id pub-id-type="doi">10.1002/mrc.4263</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR11">
              <label>11.</label>
              <mixed-citation publication-type="other">Landrum G (2006) RDKit: Open-source cheminformatics. <ext-link xlink:href="http://www.rdkit.org" ext-link-type="uri">http://www.rdkit.org</ext-link></mixed-citation>
            </ref>
            <ref id="CR12">
              <label>12.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Kwan</surname>
                    <given-names>EE</given-names>
                  </name>
                  <name>
                    <surname>Liu</surname>
                    <given-names>RY</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Enhancing NMR prediction for organic compounds using molecular dynamics</article-title>
                <source>J Chem Theor Comput</source>
                <year>2015</year>
                <volume>11</volume>
                <issue>11</issue>
                <fpage>5083</fpage>
                <lpage>5089</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BC2MXhs1Wqs7nF</pub-id>
                <pub-id pub-id-type="doi">10.1021/acs.jctc.5b00856</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR13">
              <label>13.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Paruzzo</surname>
                    <given-names>FM</given-names>
                  </name>
                  <name>
                    <surname>Hofstetter</surname>
                    <given-names>A</given-names>
                  </name>
                  <name>
                    <surname>Musil</surname>
                    <given-names>F</given-names>
                  </name>
                  <name>
                    <surname>De</surname>
                    <given-names>S</given-names>
                  </name>
                  <name>
                    <surname>Ceriotti</surname>
                    <given-names>M</given-names>
                  </name>
                  <name>
                    <surname>Emsley</surname>
                    <given-names>L</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Chemical shifts in molecular solids by machine learning</article-title>
                <source>Nat Commun</source>
                <year>2018</year>
                <volume>9</volume>
                <issue>1</issue>
                <fpage>4501</fpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BC1cXitVOitLnM</pub-id>
                <pub-id pub-id-type="doi">10.1038/s41467-018-06972-x</pub-id>
                <pub-id pub-id-type="pmid">30374021</pub-id>
                <pub-id pub-id-type="pmcid">6206069</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR14">
              <label>14.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Gastegger</surname>
                    <given-names>M</given-names>
                  </name>
                  <name>
                    <surname>Behler</surname>
                    <given-names>J</given-names>
                  </name>
                  <name>
                    <surname>Marquetand</surname>
                    <given-names>P</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Machine learning molecular dynamics for the simulation of infrared spectra</article-title>
                <source>Chem Sci</source>
                <year>2017</year>
                <volume>8</volume>
                <issue>10</issue>
                <fpage>6924</fpage>
                <lpage>6935</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BC2sXhtlSrtL7J</pub-id>
                <pub-id pub-id-type="doi">10.1039/c7sc02267k</pub-id>
                <pub-id pub-id-type="pmid">29147518</pub-id>
                <pub-id pub-id-type="pmcid">5636952</pub-id>
              </mixed-citation>
            </ref>
          </ref-list>
        </ref-list>
        <app-group>
          <app id="App1">
            <sec id="Sec37">
              <title>Additional files</title>
              <p>
                <supplementary-material content-type="local-data" id="MOESM1" xlink:title="Additional files">
                  <media mimetype="application" mime-subtype="pdf" xlink:href="MediaObjects/13321_2019_374_MOESM1_ESM.pdf" position="anchor">
                    <caption xml:lang="en">
                      <p><ext-link xlink:href="https://doi.org/10.1186/s13321-019-0374-3" ext-link-type="uri">Additional file 1: Table S1.</ext-link> List of active ingredients in Radix <italic>Salviae Miltiorrhizae</italic> (RSM).</p>
                    </caption>
                  </media>
                </supplementary-material>
                <supplementary-material content-type="local-data" id="MOESM2" xlink:title="Additional files">
                  <media mimetype="application" mime-subtype="x-zip-compressed" xlink:href="MediaObjects/13321_2019_374_MOESM2_ESM.gz" position="anchor">
                    <caption xml:lang="en">
                      <p><ext-link xlink:href="https://doi.org/10.1186/s13321-019-0374-3" ext-link-type="uri">Additional file 2: Table S2.</ext-link> List of the chemical compounds and putative targets of RSM following screening.</p>
                    </caption>
                  </media>
                </supplementary-material>
              </p>
            </sec>
          </app>
        </app-group>
        <fn-group>
          <fn id="Fn1">
            <label>1</label>
            <p id="Par14">As of 15 November 2018.</p>
          </fn>
        </fn-group>
      </back>
    </article>
