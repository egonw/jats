<?xml version="1.0"?>
<!ENTITY % article SYSTEM "http://jats.nlm.nih.gov/archiving/1.2/JATS-archivearticle1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="1.2" article-type="research-article" xml:lang="en">
      <front>
        <journal-meta>
          <journal-id journal-id-type="publisher-id">13321</journal-id>
          <journal-title-group>
            <journal-title>Journal of Cheminformatics</journal-title>
            <abbrev-journal-title abbrev-type="publisher">J Cheminform</abbrev-journal-title>
          </journal-title-group>
          <issn pub-type="epub">1758-2946</issn>
          <publisher>
            <publisher-name>Springer International Publishing</publisher-name>
            <publisher-loc>Cham</publisher-loc>
          </publisher>
        </journal-meta>
        <article-meta>
          <article-id pub-id-type="publisher-id">BMC1758-2946-4-39</article-id>
          <article-id pub-id-type="manuscript">366</article-id>
          <article-id pub-id-type="doi">10.1186/1758-2946-4-39</article-id>
          <article-categories>
            <subj-group subj-group-type="heading">
              <subject>Research Article</subject>
            </subj-group>
            <subj-group subj-group-type="article-collection" specific-use="Regular">
              <subject>The IUPAC International Chemical Identifier (InChI) and its influence on the domain of chemical information</subject>
            </subj-group>
          </article-categories>
          <title-group>
            <article-title xml:lang="en">InChIKey collision resistance: an experimental testing</article-title>
          </title-group>
          <contrib-group>
            <contrib contrib-type="author" corresp="yes">
              <name>
                <surname>Pletnev</surname>
                <given-names>Igor</given-names>
              </name>
              <address>
                <email>HIDDEN</email>
              </address>
              <xref ref-type="aff" rid="Aff1">1</xref>
              <xref ref-type="aff" rid="Aff2">2</xref>
              <xref ref-type="corresp" rid="IDBMC17582946439_cor1">a</xref>
            </contrib>
            <contrib contrib-type="author">
              <name>
                <surname>Erin</surname>
                <given-names>Andrey</given-names>
              </name>
              <address>
                <email>HIDDEN</email>
              </address>
              <xref ref-type="aff" rid="Aff3">3</xref>
            </contrib>
            <contrib contrib-type="author">
              <name>
                <surname>McNaught</surname>
                <given-names>Alan</given-names>
              </name>
              <address>
                <email>HIDDEN</email>
              </address>
              <xref ref-type="aff" rid="Aff2">2</xref>
            </contrib>
            <contrib contrib-type="author">
              <name>
                <surname>Blinov</surname>
                <given-names>Kirill</given-names>
              </name>
              <address>
                <email>HIDDEN</email>
              </address>
              <xref ref-type="aff" rid="Aff3">3</xref>
            </contrib>
            <contrib contrib-type="author">
              <name>
                <surname>Tchekhovskoi</surname>
                <given-names>Dmitrii</given-names>
              </name>
              <address>
                <email>HIDDEN</email>
              </address>
              <xref ref-type="aff" rid="Aff4">4</xref>
            </contrib>
            <contrib contrib-type="author">
              <name>
                <surname>Heller</surname>
                <given-names>Steve</given-names>
              </name>
              <address>
                <email>HIDDEN</email>
              </address>
              <xref ref-type="aff" rid="Aff4">4</xref>
            </contrib>
            <aff id="Aff1">
              <label>1</label>
              <institution-wrap>
                <institution-id institution-id-type="GRID">grid.14476.30</institution-id>
                <institution-id institution-id-type="ISNI">0000000123429668</institution-id>
                <institution content-type="org-division">Department of Chemistry</institution>
                <institution content-type="org-name">Lomonosov Moscow State University</institution>
              </institution-wrap>
              <addr-line content-type="postcode">119991</addr-line>
              <addr-line content-type="city">Moscow</addr-line>
              <country country="RU">Russia</country>
            </aff>
            <aff id="Aff2">
              <label>2</label>
              <institution-wrap>
                <institution content-type="org-name">InChI Trust</institution>
              </institution-wrap>
              <addr-line content-type="street">c/o FIZ CHEMIE Franklinstrasse 11</addr-line>
              <addr-line content-type="postcode">10587</addr-line>
              <addr-line content-type="city">Berlin</addr-line>
              <country country="DE">Germany</country>
            </aff>
            <aff id="Aff3">
              <label>3</label>
              <institution-wrap>
                <institution-id institution-id-type="GRID">grid.453237.4</institution-id>
                <institution-id institution-id-type="ISNI">0000000098008254</institution-id>
                <institution content-type="org-name">Advanced Chemistry Development, Inc. (ACD/Labs)</institution>
              </institution-wrap>
              <addr-line content-type="street">8 King Street East, Suite 107</addr-line>
              <addr-line content-type="postcode">M5C 1B5</addr-line>
              <addr-line content-type="city">Toronto</addr-line>
              <country country="CA">Canada</country>
            </aff>
            <aff id="Aff4">
              <label>4</label>
              <institution-wrap>
                <institution-id institution-id-type="GRID">grid.94225.38</institution-id>
                <institution-id institution-id-type="ISNI">000000012158463X</institution-id>
                <institution content-type="org-division">Biomolecular Measurement Division</institution>
                <institution content-type="org-name">National Institute of Standards and Technology</institution>
              </institution-wrap>
              <addr-line content-type="postcode">20899-8362</addr-line>
              <addr-line content-type="city">Gaithersburg</addr-line>
              <addr-line content-type="state">MD</addr-line>
              <country country="US">USA</country>
            </aff>
          </contrib-group>
          <author-notes>
            <corresp id="IDBMC17582946439_cor1">
              <label>a</label>
              <email>HIDDEN</email>
            </corresp>
          </author-notes>
          <pub-date date-type="pub" publication-format="electronic">
            <day>20</day>
            <month>12</month>
            <year>2012</year>
          </pub-date>
          <pub-date date-type="collection" publication-format="electronic">
            <month>12</month>
            <year>2012</year>
          </pub-date>
          <volume>4</volume>
          <issue seq="36">1</issue>
          <elocation-id>39</elocation-id>
          <history>
            <date date-type="registration">
              <day>19</day>
              <month>10</month>
              <year>2012</year>
            </date>
            <date date-type="received">
              <day>19</day>
              <month>10</month>
              <year>2012</year>
            </date>
            <date date-type="accepted">
              <day>11</day>
              <month>12</month>
              <year>2012</year>
            </date>
            <date date-type="online">
              <day>20</day>
              <month>12</month>
              <year>2012</year>
            </date>
          </history>
          <permissions>
            <copyright-statement content-type="compact">© Pletnev et al.; licensee Chemistry Central Ltd. 2012</copyright-statement>
            <copyright-statement content-type="comment">This article is published under license to BioMed Central Ltd. This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link xlink:href="http://creativecommons.org/licenses/by/2.0" ext-link-type="uri">http://creativecommons.org/licenses/by/2.0</ext-link>), which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</copyright-statement>
            <copyright-year>2012</copyright-year>
            <copyright-holder>Pletnev et al.; licensee Chemistry Central Ltd.</copyright-holder>
            <license license-type="open-access" xlink:href="https://creativecommons.org/licenses/by/2.0">
              <license-p><bold>Open Access</bold>This article is distributed under the terms of the Creative Commons Attribution 2.0 International License (<ext-link xlink:href="https://creativecommons.org/licenses/by/2.0" ext-link-type="uri">https://creativecommons.org/licenses/by/2.0</ext-link>), which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
            </license>
          </permissions>
          <abstract xml:lang="en" id="Abs1">
            <title>Abstract</title>
            <p>InChIKey is a 27-character compacted (hashed) version of InChI which is intended for Internet and database searching/indexing and is based on an SHA-256 hash of the InChI character string. The first block of InChIKey encodes molecular skeleton while the second block represents various kinds of isomerism (stereo, tautomeric, etc.). InChIKey is designed to be a nearly unique substitute for the parent InChI. However, a single InChIKey may occasionally map to two or more InChI strings (collision). The appearance of collision itself does not compromise the signature as collision-free hashing is impossible; the only viable approach is to set and keep a reasonable level of collision resistance which is sufficient for typical applications.</p>
            <p>We tested, in computational experiments, how well the real-life InChIKey collision resistance corresponds to the theoretical estimates expected by design. For this purpose, we analyzed the statistical characteristics of InChIKey for datasets of variable size in comparison to the theoretical statistical frequencies. For the relatively short second block, an exhaustive direct testing was performed. We computed and compared to theory the numbers of collisions for the stereoisomers of Spongistatin I (using the whole set of 67,108,864 isomers and its subsets). For the longer first block, we generated, using custom-made software, InChIKeys for more than 3 × 10<sup>10</sup> chemical structures. The statistical behavior of this block was tested by comparison of experimental and theoretical frequencies for the various four-letter sequences which may appear in the first block body.</p>
            <p>From the results of our computational experiments we conclude that the observed characteristics of InChIKey collision resistance are in good agreement with theoretical expectations.</p>
          </abstract>
          <kwd-group xml:lang="en">
            <title>Keywords</title>
            <kwd>Hash Function</kwd>
            <kwd>Letter Sequence</kwd>
            <kwd>Molecular Skeleton</kwd>
            <kwd>Uniform Random Distribution</kwd>
            <kwd>Collision Resistance</kwd>
          </kwd-group>
          <custom-meta-group>
            <custom-meta>
              <meta-name>publisher-imprint-name</meta-name>
              <meta-value>Chemistry Central</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>volume-issue-count</meta-name>
              <meta-value>1</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>issue-article-count</meta-name>
              <meta-value>39</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>issue-toc-levels</meta-name>
              <meta-value>0</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>issue-copyright-holder</meta-name>
              <meta-value>The Author(s)</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>issue-copyright-year</meta-name>
              <meta-value>2012</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-contains-esm</meta-name>
              <meta-value>Yes</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-numbering-style</meta-name>
              <meta-value>Unnumbered</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-registration-date-year</meta-name>
              <meta-value>2012</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-registration-date-month</meta-name>
              <meta-value>10</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-registration-date-day</meta-name>
              <meta-value>19</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-toc-levels</meta-name>
              <meta-value>0</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>toc-levels</meta-name>
              <meta-value>0</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>volume-type</meta-name>
              <meta-value>Regular</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-product</meta-name>
              <meta-value>ArchiveJournal</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>numbering-style</meta-name>
              <meta-value>Unnumbered</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-collection-editor</meta-name>
              <meta-value>Dr Antony Williams</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-grants-type</meta-name>
              <meta-value>OpenChoice</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>metadata-grant</meta-name>
              <meta-value>OpenAccess</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>abstract-grant</meta-name>
              <meta-value>OpenAccess</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>bodypdf-grant</meta-name>
              <meta-value>OpenAccess</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>bodyhtml-grant</meta-name>
              <meta-value>OpenAccess</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>bibliography-grant</meta-name>
              <meta-value>OpenAccess</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>esm-grant</meta-name>
              <meta-value>OpenAccess</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>online-first</meta-name>
              <meta-value>false</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>pdf-file-reference</meta-name>
              <meta-value>BodyRef/PDF/13321_2012_Article_366.pdf</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>pdf-type</meta-name>
              <meta-value>Typeset</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>target-type</meta-name>
              <meta-value>OnlinePDF</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>issue-type</meta-name>
              <meta-value>Regular</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-type</meta-name>
              <meta-value>OriginalPaper</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-subject-primary</meta-name>
              <meta-value>Chemistry</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-subject-secondary</meta-name>
              <meta-value>Computer Applications in Chemistry</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-subject-secondary</meta-name>
              <meta-value>Documentation and Information in Chemistry</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-subject-secondary</meta-name>
              <meta-value>Theoretical and Computational Chemistry</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-subject-secondary</meta-name>
              <meta-value>Computational Biology/Bioinformatics</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-subject-collection</meta-name>
              <meta-value>Chemistry and Materials Science</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>open-access</meta-name>
              <meta-value>true</meta-value>
            </custom-meta>
          </custom-meta-group>
        </article-meta>
        <notes notes-type="ESMHint">
          <title>Electronic supplementary material</title>
          <p>The online version of this article (doi:<ext-link xlink:href="10.1186/1758-2946-4-39" ext-link-type="doi">10.1186/1758-2946-4-39</ext-link>) contains supplementary material, which is available to authorized users.</p>
        </notes>
      </front>
      <body>
        <sec id="Sec1">
          <title>Background</title>
          <p>The International Chemical Identifier, InChI, is a unique representation of a chemical substance. InChI is developed under the auspices of IUPAC; it is free, and the source code of the InChI software is open. An InChI string is a sequence of characters derived from a structural representation of a substance, as its digital signature. The same string is always generated for any particular compound.</p>
          <p>InChIKey is a 27-character compacted version of InChI which is intended for Internet and database searching/indexing and is based on an SHA-256 hash of the InChI character string.</p>
          <p>It was introduced in 2007 with InChI Software release 1.02-beta. In 2009, the Standard InChIKey appeared with v. 1.02-standard release as an InChIKey computed from the Standard InChI; it is specifically designed for interoperability in exchange of chemical information. Since v. 1.03, InChI software has merged functionality allowing one to produce both Standard and Non-standard InChIKey (the current version of InChI Software is 1.04 , 2011 [<xref ref-type="bibr" rid="CR1">1</xref>]). Note that the current format of InChIKey is different from that of the beta version (2007); the format of the Standard InChIKey is the same as that of v. 1.02-standard (2009).</p>
          <p>An InChIKey string includes two hash blocks, three flag characters (which indicate whether the key is Standard; which version of InChI is used; and what is the protonation state of the molecule) and two separators (dashes).</p>
          <p>The first hash block represents a molecular skeleton while the second block represents various additional kinds of isomerism (stereo, isotopic substitution, and, in the case of a Non-standard key, tautomerism). The first block is 14 characters long and the second block is 8 characters long; the characters are capital English letters.</p>
          <p>The two blocks are character-encoded versions of bit strings which are hashes of the two substrings derived from a parent InChI. The hash function used for producing an InChIKey is the truncated cryptographic SHA-2 256-bit hash function [<xref ref-type="bibr" rid="CR2">2</xref>]. The 65 and 37 bits of the full 256-bit SHA-2 signatures are retained for the first and the second block, respectively. Use of this cryptographic hash function (producing - hopefully - strongly randomized output) increases the chances that collision resistance will be as close to the theoretical limit as possible (see below).</p>
          <p>InChIKey is designed to be a nearly unique representation of the parent InChI. However, a single InChIKey may occasionally map to two or more InChI strings (collision). It is noteworthy that the appearance of collision itself does not compromise the hashed representation as collision-free hashing is impossible in principle. The only viable approach is to set and keep a level of collision resistance regarded as reasonably sufficient for typical applications.</p>
          <p>The practical goal of InChIKey design was to ensure a negligibly small probability of collisions for datasets of size characteristic of the largest available real-world molecular databases, ≈(50–100) × 10<sup>6</sup> molecular skeletons, by guesstimate; for stereoisomers/isotopomers/tautomers, the practical goal was to avoid collisions up to several thousand isomers for a given molecular skeleton (plus of course some reservation for both blocks). Naturally, another design goal was to keep InChIKey reasonably short. All in all, this determined the choice of the length of hashes used in the first and the second blocks as 65 and 37 bits, respectively.</p>
          <p>The estimated level of collision resistance was published when InChIKey was introduced in 2007. Despite the minor change in InChIKey layout upon transition from InChI Software v. 1.02-beta to v. 1.03 and further, this level remained the same and the same estimate was quoted with each new release [<xref ref-type="bibr" rid="CR3">3</xref>]: “Note that due to the very essence of hash functions, collisions (the same InChIKey for different InChIs/structures) are unavoidable in very large collections. A theoretical – optimistic – estimate of collision resistance (i.e., the minimal size of a database at which a single collision is expected, that is, an event of the two hashes of two different InChI strings being the same) is 6.1 × 10<sup>9</sup> molecular skeletons × 3.7 × 10<sup>5</sup> stereo/isotopomers per skeleton ≈ 2.2 × 10<sup>15</sup>. To exemplify: the probability of a single first block collision in a database of 1 billion compounds is 1.3%. In other words, a single first block collision is expected in 1 out of 100/1.3 = 75 databases of 10<sup>9</sup> compounds each. For 10<sup>8</sup> (100 million) compounds in a database this probability is 0.014%.”</p>
          <p>The section ‘Theoretical estimates’ below explains how the estimates of collision resistance for InChIKey first block (<italic>6.1 × 10</italic><sup><italic>9</italic></sup><italic>molecular skeletons</italic>) and second block (<italic>3.7 × 10</italic><sup><italic>5</italic></sup><italic>stereo/isotopomers per skeleton</italic>) are obtained using probability theory.</p>
          <p>The tests which preceded the release of InChIKey in 2007 demonstrated the absence of collisions for several multi-million-record databases, up to a total size of ≈ 77 × 10<sup>6</sup> molecules.</p>
          <p>Nevertheless, it was and is evident that the potential size of chemical space greatly exceeds the capacity of InChIKey so collisions are unavoidable in large enough collections. And, of course, collisions are even more likely in computer-generated molecular libraries which may be made nearly as large as desired.</p>
          <p>To illustrate this, it is probably enough to say that the number of constitutional isomers (<italic>i.e.</italic>, molecular skeletons) for the alkanes C<sub>30</sub>H<sub>62</sub> is ≈ 4 × 10<sup>9</sup> while for C<sub>50</sub>H<sub>102</sub> it is ≈ 1 × 10<sup>18</sup>[<xref ref-type="bibr" rid="CR4">4</xref>]. That is, the limits of InChIKey’s first block collision resistance should be nearly reached upon enumerating isomers of triacontane, while pentacontane lies far beyond these limits.</p>
          <p>In 2009, collisions were reported for the second block of InChIKey [<xref ref-type="bibr" rid="CR5">5</xref>]. The collisions were obtained for stereoisomers of Spongistatin I, a complex molecule containing 26 stereogenic elements (see below for more details on Spongistatin I).</p>
          <p>In 2011, there appeared a report on a collision for the first block of InChIKey [<xref ref-type="bibr" rid="CR6">6</xref>]. The two collided molecules are an alcohol and a ketone containing long branched alkyl radicals, C<sub>50</sub> and C<sub>56</sub>, respectively.</p>
          <p>In both reported cases, no details were published on how the collisions were obtained -- in particular, whether they occurred by chance or resulted from dedicated computational effort -- or on whether the collided structures exist in real-world chemistry.</p>
          <p>Though collisions are indeed expected for molecules of such complexity as cited above, these reports prompted us<sup>a</sup> to investigate, in more detail, how InChIKey’s collision resistance fits the theoretical probabilistic estimate. We computed related values in computational experiments, for the first and the second block of InChIKey separately, and compared them to theory.</p>
          <p>The conclusion is that the observed values are in good agreement with theoretical ones (see below); that is, InChIKey behavior fits expectations.</p>
          <sec id="Sec2">
            <title>Hashing: probability theory and estimate of collision resistance</title>
            <p>Collision occurs when two different values have the same hash code. As any hash function maps input values to more compact space, collisions are unavoidable and the only valid question is how often they appear, not if they appear at all.</p>
            <p>Evidently, the best collision resistance would be achieved if hash values were ideally random and followed uniform distribution (that is, if producing any hash value for arbitrary input was equally probable). Of course, this ideal is impossible as pure true randomness can not be obtained using a deterministic hash function. Anyway, the best-case estimates of collision frequency may be drawn by analyzing uniformly distributed random variables.</p>
            <p>Estimation of a theoretically expected number of collisions -- at given hash length and given dataset size -- is closely related to a well-known problem from probability theory, the <italic>birthday paradox</italic>[<xref ref-type="bibr" rid="CR7">7</xref>]. This paradox is that the probability of finding two people with the same birthday in, say, a room at a party is counter-intuitively high. Thus, with probability > ½, 23 people are enough to find a same-birthday pair of persons (i.e., a birthday collision). If there are 28 people, the expected value for the number of same-birthday pairs is nearly 1.</p>
            <p>Note that the mapping person - > birthday is fully analogous to hashing a dataset of <italic>k</italic> inputs – individual persons – to <italic>k</italic> outputs which belong to the fixed interval of <italic>p</italic> possible values, <italic>p</italic> = 365; that is, we reduce the potentially huge variety of individuals to a fixed 365-entry set of birthdays.</p>
            <p>In fact, the <italic>birthday paradox</italic> is not a paradox at all, as the facts fully conform to the rules of probability theory [<xref ref-type="bibr" rid="CR7">7</xref>, <xref ref-type="bibr" rid="CR8">8</xref>]. Assuming that output values of hash functions are distributed in a perfectly uniform manner, one may estimate the probability of having collisions for a given number of input entries in a dataset, <italic>k</italic> (in our example, <italic>k</italic> is the number of people in the room). According to [<xref ref-type="bibr" rid="CR8">8</xref>], the probability that all output (hashed) values are distinct is at most ½ when<disp-formula id="Equ1"><label>1</label><alternatives><mml:math id="Equ1_Math"><mml:mrow><mml:mi mathvariant="normal">k</mml:mi><mml:mo>≥</mml:mo><mml:mfenced close="]" open="["><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mi mathvariant="normal">sqrt</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mn>8</mml:mn><mml:mi mathvariant="normal">ln</mml:mi><mml:mn>2</mml:mn></mml:mrow></mml:mfenced><mml:mi mathvariant="normal">p</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo stretchy="true">/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math><graphic specific-use="web" mime-subtype="GIF" xlink:href="MediaObjects/13321_2012_Article_366_Equ1_HTML.gif" /></alternatives></disp-formula></p>
            <p>(the probability further decreases when <italic>k</italic> increases).</p>
            <p>For <italic>p</italic> = 365 days in year, this translates to the number of peoples <italic>k</italic> ≥ 23.</p>
            <p>Going with the formula (1) from birthdays to InChIKeys, one may easily calculate that for a 37-bit hash, <italic>p</italic> = 2<sup>37</sup>, half a chance of the presence of collisions is reached for a dataset containing ca. 4.37×10<sup>5</sup> entries. For a 65-bit hash, <italic>p</italic> = 2<sup>65</sup>, it is reached for a dataset of ca. 7.15×10<sup>9</sup> entries (the exact values are 436499 and 7151589655, respectively.).</p>
            <p>Alternatively, we may use a slightly different formulation and – instead of probabilities - estimate the expected number of collisions for datasets of any given size (this expected value may be conveniently compared further to experimentally observed average).</p>
            <p>Following [<xref ref-type="bibr" rid="CR8">8</xref>], consider an indicator random variable <italic>X</italic><sub><italic>ij</italic></sub> which is 1 if persons <italic>i</italic> and <italic>j</italic> (of total <italic>k</italic>) have the same birthday and 0 otherwise. If birthdays are uniformly distributed among <italic>p</italic> = 365 possibilities, for any pair the probability of same birthday is 1/<italic>p</italic> = 1/365; the expected value (mathematical expectation) of <italic>X</italic><sub><italic>ij</italic></sub> is, by definition, D(<italic>X</italic><sub><italic>ij</italic></sub>) = 1*(1/<italic>p</italic>) + 0*(1-1/<italic>p</italic>) = 1/<italic>p</italic>.</p>
            <p>Consider <italic>X</italic> = ∑<italic>X</italic><sub><italic>ij</italic></sub> over all pairs <italic>i</italic>,<italic>j</italic>. Its expected value D(<italic>X</italic>) is also an expected value for the number of same-birthday pairs, or collisions<sup>b</sup>. Evidently, D(<italic>X</italic>) is the sum of D(<italic>X</italic><sub><italic>ij</italic></sub>) over all pairs <italic>i</italic>,<italic>j</italic>, that is<disp-formula id="Equ2"><label>2</label><alternatives><mml:math id="Equ2_Math"><mml:mrow><mml:mi mathvariant="normal">D</mml:mi><mml:mfenced close=")" open="("><mml:mi>X</mml:mi></mml:mfenced><mml:mo>=</mml:mo><mml:mi>K</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfenced><mml:mo stretchy="true">/</mml:mo><mml:mn>2</mml:mn><mml:mo>×</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mn>1</mml:mn><mml:mo stretchy="true">/</mml:mo><mml:mi>p</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mi>k</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfenced><mml:mo stretchy="true">/</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mn>2</mml:mn><mml:mi>p</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic specific-use="web" mime-subtype="GIF" xlink:href="MediaObjects/13321_2012_Article_366_Equ2_HTML.gif" /></alternatives></disp-formula></p>
            <p>If <italic>k</italic> = 23 (persons), and <italic>p</italic> =365 (days), the expected number of birthday collisions D(<italic>X</italic>) is 0.69. At <italic>k</italic> = 28 persons, D(<italic>X</italic>) is 1.04.</p>
            <p>Now we go from birthdays to InChIKeys with the formula (2). For the first block, the hash length is 65-bit so <italic>p</italic> = 2<sup>65</sup>. Then the expected number of collisions for the dataset of <italic>k</italic> = 1 × 10<sup>9</sup> entries (InChIs) D(<italic>X</italic>) = 0.0136, while for <italic>k</italic> = 1 × 10<sup>10</sup> entries (InChIs) it is 1.3553.</p>
            <p>The expected value of ½ for collision number, D<sub>1</sub> = 0.5 (subscript 1 signifies first block), is reached at <italic>k</italic><sub><italic>1</italic></sub><sup>0.5</sup> ≅ 6.1 × 10<sup>9</sup> input entries (i.e. InChIs with different first block).</p>
            <p>For the second block, the hash length is 37-bit, <italic>p</italic> = 2<sup>37</sup>. The expected number of collisions for a dataset of <italic>k</italic> = 1 × 10<sup>5</sup> entries (InChIs) is 0.0320, while for <italic>k</italic> = 1 × 10<sup>6</sup> entries (InChIs) it is 3.6380. The expected value of ½ for collision number, D<sub>2</sub> = 0.5, is reached at <italic>k</italic><sub><italic>1</italic></sub><sup>0.5</sup> ≅ 3.7 × 10<sup>5</sup> input entries (i.e. InChIs with different second block).<sup>c</sup></p>
            <p>Exactly these values of <italic>k</italic><sup>0.5</sup>, 6.1 × 10<sup>9</sup> and 3.7 × 10<sup>5</sup>, are quoted in InChI documentation as InChIKey collision resistance for the first and the second blocks, respectively.</p>
          </sec>
          <sec id="Sec3">
            <title>InChIKey collision resistance: testing the second block</title>
            <p>To check practical collision resistance of the relatively short 37-bit second block of InChIKey, we used the simple protocol of exhaustive direct testing. First, we generated all stereoisomers of a complex molecule which has so many stereogenic elements that expectation of second block collisions is high. Then we generated respective InChIs and InChIKeys and selected InChIKey subsets of various size <italic>k</italic>, up to the size of the whole set. Then, for each subset, computed the number of collisions <italic>N</italic><sub>2</sub> (subscript 2 stands for the second block; of course, the first block is the same for all isomers) and compared it to the theoretically expected value D<sub>2</sub>(<italic>k</italic>). Of course, for each given size <italic>k</italic> of subset, <italic>m</italic> multiple random samplings were performed and respective collision numbers were averaged.</p>
            <p>To generate stereoisomers (as individual MOL files), we used a custom-written Python script. InChI and InChIKey were generated from these MOL files with inchi-1 executable v. 1.04, 64-bit version for Linux [<xref ref-type="bibr" rid="CR1">1</xref>]. Random permutations of InChIKey subsets of various sizes were produced with the Unix <italic>shuf</italic> utility.</p>
            <p>An obvious choice of test molecule was Spongistatin I for which collisions in the InChIKey second block had been previously reported [<xref ref-type="bibr" rid="CR5">5</xref>].</p>
            <p>Spongistatin I is a complex molecule comprising 24 tetrahedral stereocenters and 2 stereogenic double bonds, Figure <xref rid="Fig1" ref-type="fig">1</xref> (for a review of related chemistry, see [<xref ref-type="bibr" rid="CR9">9</xref>]). The full set of its stereoisomers comprises 2<sup>26</sup> = 67,108,864 structures (evidently, many of them are purely theoretical owing to significant steric strain).<fig id="Fig1"><label>Figure 1</label><caption xml:lang="en"><p><bold>Molecular skeleton of Spongistatin I.</bold></p></caption><graphic specific-use="web" mime-subtype="JPEG" xlink:href="MediaObjects/13321_2012_Article_366_Fig1_HTML.jpg" /></fig></p>
            <p>The representative observed numbers of collisions are listed in Table <xref rid="Tab1" ref-type="table">1</xref> alongside with those theoretically expected for a 37-bit hash. Also, more data points are presented in Figure <xref rid="Fig2" ref-type="fig">2a</xref> (all results, logarithmic scale for dataset size) and 2b (the most practically important case of subsets with collision number less than or close to 1).<table-wrap id="Tab1"><label>Table 1</label><caption xml:lang="en"><p><bold>Comparison of observed and theoretically expected average numbers of InChIKey second block collisions for stereoisomers of Spongistatin I</bold></p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"><p>Number of isomers,<italic>k</italic></p></th><th align="left"><p>Expected value of the number of collisions for a 37-bit hash, D<sub>2</sub></p></th><th align="left"><p>Observed average number of collisions,<italic>N</italic><sub>2</sub></p></th><th align="left"><p>Number of random samplings,<italic>m</italic></p></th></tr></thead><tbody><tr><td align="left"><p>10000</p></td><td align="left"><p>0.0004</p></td><td align="left"><p>0.0004</p></td><td align="left"><p>10000</p></td></tr><tr><td align="left"><p>50000</p></td><td align="left"><p>0.0091</p></td><td align="left"><p>0.0125</p></td><td align="left"><p>10000</p></td></tr><tr><td align="left"><p>100000</p></td><td align="left"><p>0.0364</p></td><td align="left"><p>0.0364</p></td><td align="left"><p>10000</p></td></tr><tr><td align="left"><p>250000</p></td><td align="left"><p>0.2274</p></td><td align="left"><p>0.2264</p></td><td align="left"><p>10000</p></td></tr><tr><td align="left"><p><bold>370000</bold></p></td><td align="left"><p><bold>0.4980</bold></p></td><td align="left"><p><bold>0.5011</bold></p></td><td align="left"><p><bold>10000</bold></p></td></tr><tr><td align="left"><p>500000</p></td><td align="left"><p>0.9095</p></td><td align="left"><p>0.9091</p></td><td align="left"><p>10000</p></td></tr><tr><td align="left"><p>1000000</p></td><td align="left"><p>3.6380</p></td><td align="left"><p>3.6390</p></td><td align="left"><p>10000</p></td></tr><tr><td align="left"><p>2000000</p></td><td align="left"><p>14.5519</p></td><td align="left"><p>14.6810</p></td><td align="left"><p>1000</p></td></tr><tr><td align="left"><p>4000000</p></td><td align="left"><p>58.2076</p></td><td align="left"><p>58.6810</p></td><td align="left"><p>1000</p></td></tr><tr><td align="left"><p>8000000</p></td><td align="left"><p>232.8306</p></td><td align="left"><p>234.9040</p></td><td align="left"><p>1000</p></td></tr><tr><td align="left"><p>16000000</p></td><td align="left"><p>931.3225</p></td><td align="left"><p>941.2460</p></td><td align="left"><p>1000</p></td></tr><tr><td align="left"><p>32000000</p></td><td align="left"><p>3725.2902</p></td><td align="left"><p>3766.7530</p></td><td align="left"><p>1000</p></td></tr><tr><td align="left"><p><bold>67108864</bold></p></td><td align="left"><p><bold>16383.9998</bold></p></td><td align="left"><p><bold>16565.0000</bold></p></td><td align="left"><p><bold>1</bold></p></td></tr></tbody></table></table-wrap><fig id="Fig2"><label>Figure 2</label><caption xml:lang="en"><p><bold>The observed (circles) and theoretically expected (curve) average number of InChIKey second block collisions vs. the number of considered stereoisomers of Spongistatin I.</bold><bold>a</bold>) The whole data range; abscissa values: log(number of isomers); <bold>b</bold>) low-collision region; abscissa values: number of isomers.</p></caption><graphic specific-use="web" mime-subtype="JPEG" xlink:href="MediaObjects/13321_2012_Article_366_Fig2_HTML.jpg" /></fig></p>
            <p>As is seen, the observed and theoretical values do agree well.</p>
            <p>In particular, the average number of collisions for the 10 000 randomly sampled datasets containing 370 000 entries each is 0.501 (Table <xref rid="Tab1" ref-type="table">1</xref>) which is close to the theoretical value of 0.498.</p>
            <p>Note that a collision number of ≈ 0.5 does not mean that half of the individual datasets have no collisions while the other half show exactly one collision. The distribution is more complex: in the particular random sampling of 10 000 datasets, 6 050 demonstrated no collisions, 3 056 gave a single collision each, 740 gave 2 collisions each, 142 gave 3, 11 gave 4, and 1 gave 5 collisions.</p>
            <p>Figure <xref rid="Fig3" ref-type="fig">3</xref> shows how the average number of collisions observed for randomly sampled 370000-entry datasets changes with increase in number of samplings; it finally reaches a plateau close to 0.5 (this graph confirms the robustness of the observed average).<fig id="Fig3"><label>Figure 3</label><caption xml:lang="en"><p><bold>The dependence of observed average number of InChIKey second block collisions for 370 000-entry datasets vs. the number of samplings m.</bold></p></caption><graphic specific-use="web" mime-subtype="JPEG" xlink:href="MediaObjects/13321_2012_Article_366_Fig3_HTML.jpg" /></fig></p>
          </sec>
          <sec id="Sec4">
            <title>InChIKey statistical behavior: testing the first block</title>
            <p>The first block of InChI key is much longer than the second one so testing this block requires some additional effort/tricks.</p>
            <p>The first evident problem concerns the source of the very large number of chemical structures which are necessary to generate the wide variety of [the first block of] InChIKeys. No existing database in public access contains more than a hundred million structures, which is evidently not enough for reliable tests of collision resistance of the first block. Thus, we chose to generate the necessary structures algorithmically.</p>
            <p>For this purpose, we employed a specialized version of a structure generator [<xref ref-type="bibr" rid="CR10">10</xref>] which is a part of the ACD/Structure Elucidator software [<xref ref-type="bibr" rid="CR11">11</xref>–<xref ref-type="bibr" rid="CR13">13</xref>] and is capable of generating all constitutional isomers corresponding to a given molecular formula. Feeding this software with various molecular formulae allowed us to gather as many non-equivalent structures as necessary (for an example of molecular formulae used with counts of generated structures, and a structure generation software screenshot, see Additional file <xref ref-type="supplementary-material" rid="MOESM1">1</xref>: Table S1 and Additional file <xref ref-type="supplementary-material" rid="MOESM1">1</xref>: Figure S1).</p>
            <p>The InChIKeys were generated using InChI Software 1.04 [<xref ref-type="bibr" rid="CR1">1</xref>]. The structure generator does not produce duplicated structures but does not recognize possible tautomers which can produce the same InChIKeys. Generation of tautomers was avoided by appropriate selection of molecular formula. The generated InChIKeys were stored to file for further analysis with PowerGREP software [<xref ref-type="bibr" rid="CR14">14</xref>].</p>
            <p>The other problem is related to difficulties in the handling huge amounts of data obtained in computational experiments. According to the theory given above, the requirement for a direct observation number of, say, 100 collisions for the first block is achieved for a set of about 1 × 10<sup>11</sup> InChIKeys which would require 3 terabytes just to store the keys. Generation and searching for non-unique keys in such a huge dataset is a challenging task even for powerful computers. In addition, the possible equivalence of Standard InChIKeys for different InChIs which arise from tautomerism makes necessary the storage of additional identifiers (e.g., original InChI alongside InChIKey) and significantly increases the amount of necessary storage space.</p>
            <p>Thus, direct testing of collision resistance for the 65-bit/14-letter first block (identical to that performed for the shorter second block) is an extremely resource-demanding task that we could not afford during this work.</p>
            <p>The tests described below are indirect. Instead of checking how close is the behavior of the whole 14-letter string to uniform random distribution, we tested the randomness and uniformity of appearance for various short sub-blocks of the first block. If this hypothesis is confirmed, it is a strong though indirect proof that the statistical properties of the whole first block (and thence its collision resistance) match the theoretical expectations.</p>
            <p>A specific precaution is necessary due to the fact that the number of unique values for the 65-bit first block <italic>p</italic> is 3.69 × 10<sup>19</sup> (2<sup>65</sup>) while the number of unique 14-letter strings is 6.45 × 10<sup>19</sup> (26<sup>14</sup>). This means that some sequences of 14 letters may not constitute a valid first block of InChIKey. That is, theoretically expected frequencies of appearance of specific letters and letter sequences should be calculated accounting for the internal layout of the InChIKey string.</p>
            <p>To illustrate, let us consider the experimental letter frequencies inside the first block of InChIKey which we obtained using a set of about 1 × 10<sup>6</sup> InChIKeys. As shown in Figure <xref rid="Fig4" ref-type="fig">4</xref>, the frequencies for various letters do differ. In particular, ‘E’ and ‘T’ are relatively rare; also, the letters ‘U’ to ‘Z’ appear 10% less frequently than most of the others.<fig id="Fig4"><label>Figure 4</label><caption xml:lang="en"><p><bold>Normalized frequencies of various letters within the first block of InChIKey.</bold> Measured using InChIKeys for 1 097 996 constitutional isomers of C<sub>8</sub>H<sub>8</sub>Cl<sub>3</sub>F<sub>5</sub>; the values are normalized to the frequency of ‘A’.</p></caption><graphic specific-use="web" mime-subtype="JPEG" xlink:href="MediaObjects/13321_2012_Article_366_Fig4_HTML.jpg" /></fig></p>
            <p>An investigation of letter frequencies for specific position inside the first block reveals the detailed pattern(s); see Table <xref rid="Tab2" ref-type="table">2</xref> which lists the selected data (for a non-truncated version of the table see Additional file <xref ref-type="supplementary-material" rid="MOESM1">1</xref>: Table S2). Shown in bold are the values which significantly deviate from a typical one.<table-wrap id="Tab2"><label>Table 2</label><caption xml:lang="en"><p><bold>Selected normalized letter frequencies for various positions (1 to 14) in the InChIKey first block</bold></p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"><p>Position</p></th><th align="center"><p>1</p></th><th align="center"><p>2</p></th><th align="center"><p>3</p></th><th align="center"><p>4</p></th><th align="center"><p>5</p></th><th align="center"><p>6</p></th><th align="center"><p>7</p></th><th align="center"><p>…</p></th><th align="center"><p>12</p></th><th align="center"><p>13</p></th><th align="center"><p>14</p></th></tr></thead><tbody><tr><td align="left"><p><bold>A</bold></p></td><td align="center"><p>1.0000</p></td><td align="center"><p>0.9221</p></td><td align="center"><p>0.9130</p></td><td align="center"><p>0.9917</p></td><td align="center"><p>0.9213</p></td><td align="center"><p>0.9227</p></td><td align="center"><p>1.0039</p></td><td /><td align="center"><p>0.9250</p></td><td align="center"><p>1.2273</p></td><td align="center"><p>0.9390</p></td></tr><tr><td align="left"><p><bold>…</bold></p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td></tr><tr><td align="left"><p><bold>D</bold></p></td><td align="center"><p>0.9898</p></td><td align="center"><p>0.9223</p></td><td align="center"><p>0.9182</p></td><td align="center"><p>1.0038</p></td><td align="center"><p>0.9138</p></td><td align="center"><p>0.9260</p></td><td align="center"><p>0.9938</p></td><td align="center"><p>…</p></td><td align="center"><p>0.9291</p></td><td align="center"><p>1.2321</p></td><td align="center"><p>0.9380</p></td></tr><tr><td align="left"><p><bold>E</bold></p></td><td align="center"><p><bold>0.0000</bold></p></td><td align="center"><p>0.9164</p></td><td align="center"><p>0.9331</p></td><td align="center"><p><bold>0.0000</bold></p></td><td align="center"><p>0.9208</p></td><td align="center"><p>0.9256</p></td><td align="center"><p><bold>0.0000</bold></p></td><td align="center"><p>…</p></td><td align="center"><p>0.9216</p></td><td align="center"><p>1.2249</p></td><td align="center"><p>0.9436</p></td></tr><tr><td align="left"><p><bold>F</bold></p></td><td align="center"><p>0.9986</p></td><td align="center"><p>0.9145</p></td><td align="center"><p>0.9200</p></td><td align="center"><p>0.9964</p></td><td align="center"><p>0.9183</p></td><td align="center"><p>0.9283</p></td><td align="center"><p>0.9957</p></td><td align="center"><p>…</p></td><td align="center"><p>0.9171</p></td><td align="center"><p>1.2313</p></td><td align="center"><p>0.9430</p></td></tr><tr><td align="left"><p><bold>…</bold></p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td></tr><tr><td align="left"><p><bold>R</bold></p></td><td align="center"><p>0.9965</p></td><td align="center"><p>0.9109</p></td><td align="center"><p>0.9279</p></td><td align="center"><p>1.0015</p></td><td align="center"><p>0.9207</p></td><td align="center"><p>0.9269</p></td><td align="center"><p>0.9916</p></td><td align="center"><p>…</p></td><td align="center"><p>0.9213</p></td><td align="center"><p>1.2152</p></td><td align="center"><p>0.9420</p></td></tr><tr><td align="left"><p><bold>S</bold></p></td><td align="center"><p>0.9940</p></td><td align="center"><p>0.9186</p></td><td align="center"><p>0.9294</p></td><td align="center"><p>0.9956</p></td><td align="center"><p>0.9184</p></td><td align="center"><p>0.9259</p></td><td align="center"><p>0.9957</p></td><td align="center"><p>…</p></td><td align="center"><p>0.9226</p></td><td align="center"><p>1.2236</p></td><td align="center"><p>0.8924</p></td></tr><tr><td align="left"><p><bold>T</bold></p></td><td align="center"><p><bold>0.2395</bold></p></td><td align="center"><p>0.9237</p></td><td align="center"><p>0.9303</p></td><td align="center"><p><bold>0.2351</bold></p></td><td align="center"><p>0.9227</p></td><td align="center"><p>0.9291</p></td><td align="center"><p><bold>0.2297</bold></p></td><td align="center"><p>…</p></td><td align="center"><p>0.9268</p></td><td align="center"><p><bold>0.8413</bold></p></td><td align="center"><p>0.9037</p></td></tr><tr><td align="left"><p><bold>U</bold></p></td><td align="center"><p>0.9992</p></td><td align="center"><p>0.9573</p></td><td align="center"><p>0.9341</p></td><td align="center"><p>0.9934</p></td><td align="center"><p>0.9543</p></td><td align="center"><p>0.9303</p></td><td align="center"><p>0.9906</p></td><td align="center"><p>…</p></td><td align="center"><p>0.9251</p></td><td align="center"><p><bold>0.0000</bold></p></td><td align="center"><p>0.8902</p></td></tr><tr><td align="left"><p><bold>…</bold></p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td><td /><td align="center"><p>…</p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td><td align="center"><p>…</p></td></tr><tr><td align="left"><p><bold>Z</bold></p></td><td align="center"><p>0.9986</p></td><td align="center"><p>0.9627</p></td><td align="center"><p>0.9293</p></td><td align="center"><p>0.9969</p></td><td align="center"><p>0.9569</p></td><td align="center"><p>0.9288</p></td><td align="center"><p>0.9873</p></td><td align="center"><p>…</p></td><td align="center"><p>0.9316</p></td><td align="center"><p><bold>0.0000</bold></p></td><td align="center"><p>0.8857</p></td></tr></tbody></table><table-wrap-foot><p>Measured using InChIKeys for 998753 isomers of C<sub>9</sub>H<sub>8</sub>O<sub>1</sub>; the values are normalized to the frequency of ‘A’.</p></table-wrap-foot></table-wrap></p>
            <p>One may see from these data that the whole 14-letter string of the first block is composed of four 3-letter substrings (triplets, each has the same internal distribution of letters) followed by a 2-letter substring (doublet).</p>
            <p>It is possible to determine which letter sequences may occur within the triplets and the doublet. An each triplet may be a sequence “AAA” through “ZZZ” -- except for “EAA” to “EZZ” and for “TAA” to “TTV” (the listing follows lexicographical order changing the rightmost letters first, e.g., “AAA”, “AAB”, “AAC”, … ). This amounts to a total of 16384 possible letter sequences. The valid sequences for a doublet are “AA” to “TR”; the total is 512. The grand total for the first block is thus 3.69 × 10<sup>19</sup> (16384<sup>4</sup> × 512) possible 14-letter sequences which fits the number of unique values for a 65-bit hash, <italic>p</italic> = 2<sup>65</sup>.</p>
            <p>Note that the 3-letter sequences which start from ‘E’ (and most of those which start from ‘T’) may not occur within the triplets. Also, no 2-letter sequences which start with letters from ‘U’ to ‘Z’ may occur within the doublets. These rules explains the low frequency of letters “E’,’T’, ‘U’-‘Z’ observed in InChIKeys, in general (Figure <xref rid="Fig4" ref-type="fig">4</xref>) and in specific positions (Table <xref rid="Tab2" ref-type="table">2</xref>).</p>
            <p>This specific layout of the first block directly reflects the encoding schema chosen in current InChI Software to represent a 65-bit binary hash with 26 Latin letters. The same schema is used for the second block (it is composed of 2 triplets and a terminal doublet). Of course, the layout might have been revealed through digging into source code; however, the “black-box” analysis shown above parallels the whole “experimentalist” design of this study; also the letter frequencies obtained indirectly support the random character of InChIKey strings.</p>
            <p>Now when the layout is established, one may easily calculate the theoretical probability of appearance of any <italic>s</italic>-letter sequence at any position of the first block of InChIKey. Comparing them with those obtained in the computational experiment may confirm or disprove the uniform random character of InChIKey.</p>
            <p>By balancing the length of investigated letter sequences against computational feasibility, we chose investigation of 4-letter sequences (technically, all the generated InChIKeys were checked for the presence of predefined 4-letter sequences and only those passing the check were stored for further analysis).</p>
            <p>We calculated the probabilities associated with all the possible 4-letter sequences. Assumption of a uniform random distribution means that all valid letter sequences for triplets and doublet are equally likely and that the content of any triplets/doublet is independent of the others. That is, for example, the probability <italic>P</italic> of the presence of the letter segment “ABCD” at the first position of the first block of InChIKey, can be calculated as follows:<disp-formula id="Equ3"><label>3</label><alternatives><mml:math id="Equ3_Math"><mml:mrow><mml:mi>P</mml:mi><mml:mo>=</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mi>P</mml:mi><mml:mi mathvariant="normal">of</mml:mi><mml:mo>“</mml:mo><mml:mi mathvariant="normal">ABC</mml:mi><mml:mo>”</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="normal">in</mml:mi><mml:mspace width="0.25em" /><mml:mn>1</mml:mn></mml:mrow><mml:mi mathvariant="normal">st</mml:mi></mml:msup><mml:mi mathvariant="normal">triplet</mml:mi></mml:mrow></mml:mfenced><mml:mo>×</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mi>P</mml:mi><mml:mi mathvariant="normal">of</mml:mi><mml:mo>‘</mml:mo><mml:mi mathvariant="normal">D</mml:mi><mml:mo>’</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="normal">at</mml:mi><mml:mspace width="0.25em" /><mml:mi mathvariant="normal">the</mml:mi><mml:mspace width="0.25em" /><mml:mi mathvariant="normal">first</mml:mi><mml:mspace width="0.25em" /><mml:mi mathvariant="normal">position</mml:mi><mml:mspace width="0.25em" /><mml:mi mathvariant="normal">of</mml:mi><mml:mspace width="0.25em" /><mml:mn>2</mml:mn></mml:mrow><mml:mi mathvariant="normal">nd</mml:mi></mml:msup><mml:mi mathvariant="normal">triplet</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mn>1</mml:mn><mml:mo stretchy="true">/</mml:mo><mml:mn>16384</mml:mn></mml:mrow></mml:mfenced><mml:mo>×</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mn>26</mml:mn><mml:mo stretchy="true">/</mml:mo><mml:mn>512</mml:mn></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mn>2.5183</mml:mn><mml:mo>×</mml:mo><mml:mn>1</mml:mn><mml:msup><mml:mn>0</mml:mn><mml:mrow><mml:mo>-</mml:mo><mml:mn>6</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math><graphic specific-use="web" mime-subtype="GIF" xlink:href="MediaObjects/13321_2012_Article_366_Equ3_HTML.gif" /></alternatives></disp-formula></p>
            <p>Calculating and summing the probabilities for all 11 possible positions of the 4-letter substring inside the first block one may find the final probabilities for the specific letter sequences to appear in the first block (accounting for the above described layout which limits appearance of some letters in some positions).</p>
            <p>It is easy to convert these probabilities to theoretically expected numbers of occurrence of different letter sequences. Table <xref rid="Tab3" ref-type="table">3</xref> provides the related data for 16 4-letter sequences of four kinds which differ in starting letter and thus in associated probability. The theoretical values are accompanied by experimentally obtained ones.<table-wrap id="Tab3"><label>Table 3</label><caption xml:lang="en"><p>The occurrence of various 4-letter sequences in the set of first blocks for 1.2002 × 10<sup>9</sup> InChIKeys</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"><p>Sequence</p></th><th align="center"><p>Experiment</p></th><th align="center"><p>Theory</p></th><th align="center"><p>Ratio</p></th><th align="center"><p>Sequence</p></th><th align="center"><p>Experiment</p></th><th align="center"><p>Theory</p></th><th align="center"><p>Ratio</p></th></tr></thead><tbody><tr><td align="left"><p>ABCD</p></td><td align="center"><p>33243</p></td><td align="center"><p>33041</p></td><td align="center"><p>1.006</p></td><td align="center"><p>EDNA</p></td><td align="center"><p>20135</p></td><td align="center"><p>20254</p></td><td align="center"><p>0.994</p></td></tr><tr><td align="left"><p>FMGL</p></td><td align="center"><p>33389</p></td><td align="center"><p>33041</p></td><td align="center"><p>1.011</p></td><td align="center"><p>EGPS</p></td><td align="center"><p>20466</p></td><td align="center"><p>20254</p></td><td align="center"><p>1.010</p></td></tr><tr><td align="left"><p>LGRC</p></td><td align="center"><p>32793</p></td><td align="center"><p>33041</p></td><td align="center"><p>0.992</p></td><td align="center"><p>EKPH</p></td><td align="center"><p>20344</p></td><td align="center"><p>20254</p></td><td align="center"><p>1.004</p></td></tr><tr><td align="left"><p>RBCQ</p></td><td align="center"><p>32937</p></td><td align="center"><p>33041</p></td><td align="center"><p>0.997</p></td><td align="center"><p>EJDO</p></td><td align="center"><p>20190</p></td><td align="center"><p>20254</p></td><td align="center"><p>0.997</p></td></tr><tr><td colspan="2"><p>Probability</p></td><td colspan="2"><p>2.7530 × 10<sup>-5</sup></p></td><td colspan="2"><p>Probability</p></td><td colspan="2"><p>1.6876 × 10<sup>-5</sup></p></td></tr><tr><td align="left"><p>TBAC</p></td><td align="center"><p>20209</p></td><td align="center"><p>20254</p></td><td align="center"><p>0.998</p></td><td align="center"><p>ZAMR</p></td><td align="center"><p>33551</p></td><td align="center"><p>33547</p></td><td align="center"><p>1.000</p></td></tr><tr><td align="left"><p>TKIL</p></td><td align="center"><p>20303</p></td><td align="center"><p>20254</p></td><td align="center"><p>1.002</p></td><td align="center"><p>ZDKL</p></td><td align="center"><p>33650</p></td><td align="center"><p>33547</p></td><td align="center"><p>1.003</p></td></tr><tr><td align="left"><p>TRPC</p></td><td align="center"><p>20273</p></td><td align="center"><p>20254</p></td><td align="center"><p>1.001</p></td><td align="center"><p>ZSBC</p></td><td align="center"><p>33581</p></td><td align="center"><p>33547</p></td><td align="center"><p>1.001</p></td></tr><tr><td align="left"><p>TSBF</p></td><td align="center"><p>20111</p></td><td align="center"><p>20254</p></td><td align="center"><p>0.993</p></td><td align="center"><p>ZIII</p></td><td align="center"><p>33577</p></td><td align="center"><p>33547</p></td><td align="center"><p>1.001</p></td></tr><tr><td colspan="2"><p>Probability</p></td><td colspan="2"><p>1.6876 × 10-5</p></td><td colspan="2"><p>Probability</p></td><td colspan="2"><p>2.7951 × 10-5</p></td></tr></tbody></table></table-wrap></p>
            <p>The ratio of experimental and theoretical occurrences ranges from 0.99 to 1.01 and is very close to the ideal value of 1 (standard deviation for this ratio is 0.0055).</p>
            <p>We also performed additional tests with 3-, 4-, 5- and longer-letter sequences employing different sets of chemical structures; more than thirty billion (3 × 10<sup>10</sup>) InChIKeys were generated during this work.</p>
            <p>All the collected data demonstrate good agreement between experiment and theory. This indirectly confirms the theoretically expected uniform random distribution of InChIKey first block values, which in turn supports the declared collision resistance.</p>
          </sec>
        </sec>
        <sec id="Sec5" sec-type="conclusions">
          <title>Conclusions</title>
          <p>Combining the results of computational experiments for the first and the second blocks, we conclude that the observed statistical characteristics of InChIKey collision resistance are in good agreement with theoretical expectations. Of course, the collision resistance may be further improved by employing longer hashes; however, the current design and implementation seem to meet their goals.</p>
        </sec>
        <sec id="Sec6">
          <title>Endnotes</title>
          <p><sup>a</sup>The present study extends/updates our tests of InChIKey collision resistance performed in 2007–2009 which remained mainly unpublished. Also, some preliminary results concerning the first block were reported at the 2012 ACS Spring Meeting.</p>
          <p><sup>b</sup>Strictly speaking, the number of same-hash pairs of input values is slightly different from the number of collisions, i.e., ‘already seen’ hash values. The numbers are exactly equal if no composite collisions (i.e., 3 or more inputs mapped to the same output) occur.</p>
          <p><sup>c</sup>More precisely: D<sub>1</sub>(6.1 × 10<sup>9</sup>) =0.504; D<sub>2</sub>(3.7 × 10<sup>5</sup>) =0.498<italic>.</italic></p>
        </sec>
      </body>
      <back>
        <ack>
          <title>Disclaimer</title>
          <p>The following disclaimer is applicable since two of the authors (DT and SH) are affiliated with NIST: "Certain commercial products are identified in this paper in order to specify the procedures used adequately. Such identification is not intended to imply recommendation or endorsement by the National Institute of Standards and Technology, nor is it intended to imply that the materials or equipment identified are necessarily the best available for the purpose."</p>
        </ack>
        <ref-list id="Bib1">
          <title>References</title>
          <ref-list>
            <ref id="CR1">
              <label>1.</label>
              <mixed-citation publication-type="other">IUPAC International Chemical Identifier (InChI) Programs InChI version 1, software version 1.04 (September 2011). <ext-link xlink:href="http://www.inchi-trust.org/downloads/" ext-link-type="uri">http://www.inchi-trust.org/downloads/</ext-link> Last accessed 2012-09-12</mixed-citation>
            </ref>
            <ref id="CR2">
              <label>2.</label>
              <mixed-citation publication-type="other">Federal Information Processing Standards Publication 180–2 (+ Change Notice to include SHA-224). <ext-link xlink:href="http://csrc.nist.gov/publications/fips/fips180-2/fips180-2withchangenotice.pdf" ext-link-type="uri">http://csrc.nist.gov/publications/fips/fips180-2/fips180-2withchangenotice.pdf</ext-link> Last accessed 2012-09-12</mixed-citation>
            </ref>
            <ref id="CR3">
              <label>3.</label>
              <mixed-citation publication-type="other">IUPAC International Chemical Identifier (InChI) Programs InChI version 1, software version 1.04 (September 2011), User’s Guide. <ext-link xlink:href="http://www.inchi-trust.org/fileadmin/user_upload/software/inchi-v1.04/InChI_UserGuide.pdf" ext-link-type="uri">http://www.inchi-trust.org/fileadmin/user_upload/software/inchi-v1.04/InChI_UserGuide.pdf</ext-link> Last accessed 2012-09-12</mixed-citation>
            </ref>
            <ref id="CR4">
              <label>4.</label>
              <mixed-citation publication-type="book">
                <person-group person-group-type="author">
                  <name>
                    <surname>Graham</surname>
                    <given-names>RL</given-names>
                  </name>
                  <name>
                    <surname>Grötschel</surname>
                    <given-names>M</given-names>
                  </name>
                  <name>
                    <surname>Lovász</surname>
                    <given-names>L</given-names>
                  </name>
                </person-group>
                <source>Handbook of Combinatorics, Volume 2</source>
                <year>1995</year>
                <comment>Elseveir</comment>
              </mixed-citation>
            </ref>
            <ref id="CR5">
              <label>5.</label>
              <mixed-citation publication-type="other">InChIKey Collision. <ext-link xlink:href="http://www-jmg.ch.cam.ac.uk/data/inchi/" ext-link-type="uri">http://www-jmg.ch.cam.ac.uk/data/inchi/</ext-link> Last accessed 2012-09-12</mixed-citation>
            </ref>
            <ref id="CR6">
              <label>6.</label>
              <mixed-citation publication-type="other">An InChIkey Collision is Discovered and NOT Based on Stereochemistry. <ext-link xlink:href="http://www.chemconnector.com/2011/09/01/an-inchikey-collision-is-discovered-and-not-based-on-stereochemistry/" ext-link-type="uri">http://www.chemconnector.com/2011/09/01/an-inchikey-collision-is-discovered-and-not-based-on-stereochemistry/</ext-link> Last accessed 2012-09-12</mixed-citation>
            </ref>
            <ref id="CR7">
              <label>7.</label>
              <mixed-citation publication-type="book">
                <person-group person-group-type="author">
                  <name>
                    <surname>Feller</surname>
                    <given-names>W</given-names>
                  </name>
                </person-group>
                <source>An Introduction to Probability Theory and Its Applications, v.1. 3rd ed</source>
                <year>1968</year>
                <comment>Wiley</comment>
              </mixed-citation>
            </ref>
            <ref id="CR8">
              <label>8.</label>
              <mixed-citation publication-type="other">Cormen TH, Leiserson CE, Rivest RL, Stein C: Introduction to Algorithms, 3rd Edition. The MIT Press</mixed-citation>
            </ref>
            <ref id="CR9">
              <label>9.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Aho</surname>
                    <given-names>JE</given-names>
                  </name>
                  <name>
                    <surname>Pihko</surname>
                    <given-names>PM</given-names>
                  </name>
                  <name>
                    <surname>Rissa</surname>
                    <given-names>TK</given-names>
                  </name>
                </person-group>
                <source>Chem Rev</source>
                <year>2005</year>
                <volume>105</volume>
                <fpage>4406</fpage>
                <lpage>4440</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BD2MXht1Gmsr3K</pub-id>
                <pub-id pub-id-type="doi">10.1021/cr050559n</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR10">
              <label>10.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Molodtsov</surname>
                    <given-names>SG</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">MATCH Commun</article-title>
                <source>Math Comput Chem</source>
                <year>1994</year>
                <volume>30</volume>
                <fpage>213</fpage>
                <lpage>224</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DyaK2cXntVSitL4%3D</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR11">
              <label>11.</label>
              <mixed-citation publication-type="other">ACD/Structure Elucidator. <ext-link xlink:href="http://acdlabs.com/products/com_iden/elucidation/struc_eluc/" ext-link-type="uri">http://acdlabs.com/products/com_iden/elucidation/struc_eluc/</ext-link> Last accessed 2012-09-12</mixed-citation>
            </ref>
            <ref id="CR12">
              <label>12.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Elyashberg</surname>
                    <given-names>ME</given-names>
                  </name>
                  <name>
                    <surname>Blinov</surname>
                    <given-names>KA</given-names>
                  </name>
                  <name>
                    <surname>Martirosian</surname>
                    <given-names>ER</given-names>
                  </name>
                </person-group>
                <source>Autom Inf Manage</source>
                <year>1999</year>
                <volume>34</volume>
                <fpage>15</fpage>
                <lpage>30</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DyaK1MXotVCqu7g%3D</pub-id>
                <pub-id pub-id-type="doi">10.1016/S1381-141X(99)00002-7</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR13">
              <label>13.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Elyashberg</surname>
                    <given-names>ME</given-names>
                  </name>
                  <name>
                    <surname>Blinov</surname>
                    <given-names>KA</given-names>
                  </name>
                  <name>
                    <surname>Molodtsov</surname>
                    <given-names>SG</given-names>
                  </name>
                  <name>
                    <surname>Williams</surname>
                    <given-names>AJ</given-names>
                  </name>
                  <name>
                    <surname>Martin</surname>
                    <given-names>GE</given-names>
                  </name>
                </person-group>
                <source>J Chem Inf Comput Sci</source>
                <year>2004</year>
                <volume>44</volume>
                <fpage>771</fpage>
                <lpage>792</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BD2cXitlKksro%3D</pub-id>
                <pub-id pub-id-type="doi">10.1021/ci0341060</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR14">
              <label>14.</label>
              <mixed-citation publication-type="other">PowerGREP Software. <ext-link xlink:href="http://www.powergrep.com/" ext-link-type="uri">http://www.powergrep.com/</ext-link> Last accessed 2012-09-12</mixed-citation>
            </ref>
          </ref-list>
        </ref-list>
        <app-group>
          <app id="App1">
            <sec id="Sec7">
              <title>Electronic supplementary material</title>
              <p>
                <supplementary-material content-type="local-data" id="MOESM1" xlink:title="Electronic supplementary material">
                  <media mimetype="application" mime-subtype="pdf" xlink:href="MediaObjects/13321_2012_366_MOESM1_ESM.pdf" position="anchor">
                    <caption xml:lang="en">
                      <p>Additional file 1: Contains supplementary material related to the first block testing. Table S1 of this file presents an example of molecular formulae used with counts of generated structures and Figure S1 gives a structure generation software screenshot. The file also contains Table S2 which is a non-truncated version of Table 2 of the main body. (PDF 127 KB)</p>
                    </caption>
                  </media>
                </supplementary-material>
              </p>
            </sec>
            <sec id="Sec8">
              <title>Authors’ original submitted files for images</title>
              <p>Below are the links to the authors’ original submitted files for images.<supplementary-material content-type="local-data" id="MOESM2" xlink:title="Authors’ original submitted files for images"><media mimetype="image" mime-subtype="png" xlink:href="MediaObjects/13321_2012_366_MOESM2_ESM.png" position="anchor"><caption xml:lang="en"><p>Authors’ original file for figure 1</p></caption></media></supplementary-material><supplementary-material content-type="local-data" id="MOESM3" xlink:title="Authors’ original submitted files for images"><media mimetype="image" mime-subtype="png" xlink:href="MediaObjects/13321_2012_366_MOESM3_ESM.png" position="anchor"><caption xml:lang="en"><p>Authors’ original file for figure 2</p></caption></media></supplementary-material><supplementary-material content-type="local-data" id="MOESM4" xlink:title="Authors’ original submitted files for images"><media mimetype="image" mime-subtype="png" xlink:href="MediaObjects/13321_2012_366_MOESM4_ESM.png" position="anchor"><caption xml:lang="en"><p>Authors’ original file for figure 3</p></caption></media></supplementary-material><supplementary-material content-type="local-data" id="MOESM5" xlink:title="Authors’ original submitted files for images"><media mimetype="image" mime-subtype="png" xlink:href="MediaObjects/13321_2012_366_MOESM5_ESM.png" position="anchor"><caption xml:lang="en"><p>Authors’ original file for figure 4</p></caption></media></supplementary-material></p>
            </sec>
          </app>
        </app-group>
        <notes notes-type="Misc">
          <title>Competing interests</title>
          <p>The authors declare that they have no competing interests.</p>
        </notes>
        <notes notes-type="Misc">
          <title>Authors' contributions</title>
          <p>IP carried out the part of work concerning InChIKey 2nd block and drafted the related text and introductory notes. AE carried out the computations, interpreted the results and drafted the text concerning InChIKey 1st block, while KB designed the related computational experiments and developed necessary software. AM, DT, and SH participated in the design and coordination of the study, as well as in drafting/revising the manuscipt. All authors read and approved the final manuscript.</p>
        </notes>
      </back>
    </article>
