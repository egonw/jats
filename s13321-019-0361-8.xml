<?xml version="1.0"?>
<!ENTITY % article SYSTEM "http://jats.nlm.nih.gov/archiving/1.2/JATS-archivearticle1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="1.2" article-type="research-article" xml:lang="en">
      <front>
        <journal-meta>
          <journal-id journal-id-type="publisher-id">13321</journal-id>
          <journal-title-group>
            <journal-title>Journal of Cheminformatics</journal-title>
            <abbrev-journal-title abbrev-type="publisher">J Cheminform</abbrev-journal-title>
          </journal-title-group>
          <issn pub-type="epub">1758-2946</issn>
          <publisher>
            <publisher-name>Springer International Publishing</publisher-name>
            <publisher-loc>Cham</publisher-loc>
          </publisher>
        </journal-meta>
        <article-meta>
          <article-id pub-id-type="publisher-id">s13321-019-0361-8</article-id>
          <article-id pub-id-type="manuscript">361</article-id>
          <article-id pub-id-type="doi">10.1186/s13321-019-0361-8</article-id>
          <article-categories>
            <subj-group subj-group-type="heading">
              <subject>Software</subject>
            </subj-group>
          </article-categories>
          <title-group>
            <article-title xml:lang="en">ErtlFunctionalGroupsFinder: automated rule-based functional group detection with the Chemistry Development Kit (CDK)</article-title>
          </title-group>
          <contrib-group>
            <contrib contrib-type="author" id="Au1">
              <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-0368-700X</contrib-id>
              <name>
                <surname>Fritsch</surname>
                <given-names>Sebastian</given-names>
              </name>
              <address>
                <email>HIDDEN</email>
              </address>
              <xref ref-type="aff" rid="Aff1">1</xref>
            </contrib>
            <contrib contrib-type="author" id="Au2">
              <name>
                <surname>Neumann</surname>
                <given-names>Stefan</given-names>
              </name>
              <address>
                <email>HIDDEN</email>
              </address>
              <xref ref-type="aff" rid="Aff1">1</xref>
            </contrib>
            <contrib contrib-type="author" id="Au3">
              <name>
                <surname>Schaub</surname>
                <given-names>Jonas</given-names>
              </name>
              <address>
                <email>HIDDEN</email>
              </address>
              <xref ref-type="aff" rid="Aff2">2</xref>
            </contrib>
            <contrib contrib-type="author" id="Au4">
              <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-6966-0814</contrib-id>
              <name>
                <surname>Steinbeck</surname>
                <given-names>Christoph</given-names>
              </name>
              <address>
                <email>HIDDEN</email>
              </address>
              <xref ref-type="aff" rid="Aff3">3</xref>
            </contrib>
            <contrib contrib-type="author" corresp="yes" id="Au5">
              <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-0722-4229</contrib-id>
              <name>
                <surname>Zielesny</surname>
                <given-names>Achim</given-names>
              </name>
              <address>
                <email>HIDDEN</email>
              </address>
              <xref ref-type="aff" rid="Aff2">2</xref>
              <xref ref-type="corresp" rid="IDs1332101903618_cor5">e</xref>
            </contrib>
            <aff id="Aff1">
              <label>1</label>
              <institution-wrap>
                <institution content-type="org-name">GNWI – Gesellschaft für naturwissenschaftliche Informatik</institution>
              </institution-wrap>
              <addr-line content-type="city">Oer-Erkenschwick</addr-line>
              <country country="DE">Germany</country>
            </aff>
            <aff id="Aff2">
              <label>2</label>
              <institution-wrap>
                <institution content-type="org-division">Institute for Bioinformatics and Chemoinformatics</institution>
                <institution content-type="org-name">Westphalian University of Applied Sciences</institution>
              </institution-wrap>
              <addr-line content-type="street">August-Schmidt-Ring 10</addr-line>
              <addr-line content-type="postcode">45665</addr-line>
              <addr-line content-type="city">Recklinghausen</addr-line>
              <country country="DE">Germany</country>
            </aff>
            <aff id="Aff3">
              <label>3</label>
              <institution-wrap>
                <institution-id institution-id-type="ISNI">0000 0001 1939 2794</institution-id>
                <institution-id institution-id-type="GRID">grid.9613.d</institution-id>
                <institution content-type="org-division">Institute for Inorganic and Analytical Chemistry</institution>
                <institution content-type="org-name">Friedrich-Schiller-University</institution>
              </institution-wrap>
              <addr-line content-type="city">Jena</addr-line>
              <country country="DE">Germany</country>
            </aff>
          </contrib-group>
          <author-notes>
            <corresp id="IDs1332101903618_cor5">
              <label>e</label>
              <email>HIDDEN</email>
            </corresp>
          </author-notes>
          <pub-date date-type="pub" publication-format="electronic">
            <day>4</day>
            <month>6</month>
            <year>2019</year>
          </pub-date>
          <pub-date date-type="collection" publication-format="electronic">
            <month>12</month>
            <year>2019</year>
          </pub-date>
          <volume>11</volume>
          <issue seq="37">1</issue>
          <elocation-id>37</elocation-id>
          <history>
            <date date-type="registration">
              <day>29</day>
              <month>5</month>
              <year>2019</year>
            </date>
            <date date-type="received">
              <day>7</day>
              <month>3</month>
              <year>2019</year>
            </date>
            <date date-type="accepted">
              <day>28</day>
              <month>5</month>
              <year>2019</year>
            </date>
            <date date-type="online">
              <day>4</day>
              <month>6</month>
              <year>2019</year>
            </date>
          </history>
          <permissions>
            <copyright-statement content-type="compact">© The Author(s) 2019</copyright-statement>
            <copyright-year>2019</copyright-year>
            <copyright-holder>The Author(s)</copyright-holder>
            <license license-type="open-access" xlink:href="http://creativecommons.org/licenses/by/4.0/">
              <license-p><bold>Open Access</bold>This article is distributed under the terms of the Creative Commons Attribution 4.0 International License (<ext-link xlink:href="http://creativecommons.org/licenses/by/4.0/" ext-link-type="uri">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted use, distribution, and reproduction in any medium, provided you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The Creative Commons Public Domain Dedication waiver (<ext-link xlink:href="http://creativecommons.org/publicdomain/zero/1.0/" ext-link-type="uri">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated.</license-p>
            </license>
          </permissions>
          <abstract xml:lang="en" id="Abs1">
            <title>Abstract</title>
            <p id="Par1">The Ertl algorithm for automated functional groups (FG) detection and extraction of organic molecules is implemented on the basis of the Chemistry Development Kit (CDK). A distinct impact of the chosen CDK aromaticity model is demonstrated by an FG analysis of the ChEMBL database compounds. The average performance of less than a millisecond for a single-molecule FG extraction allows for fast processing of even large compound databases.</p>
          </abstract>
          <kwd-group xml:lang="en">
            <title>Keywords</title>
            <kwd>Chemistry Development Kit</kwd>
            <kwd>CDK</kwd>
            <kwd>Functional group</kwd>
            <kwd>Aromaticity</kwd>
            <kwd>Electron donation</kwd>
            <kwd>Cycle finder</kwd>
          </kwd-group>
          <custom-meta-group>
            <custom-meta>
              <meta-name>publisher-imprint-name</meta-name>
              <meta-value>Springer</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>volume-issue-count</meta-name>
              <meta-value>1</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>issue-article-count</meta-name>
              <meta-value>0</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>issue-toc-levels</meta-name>
              <meta-value>0</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>issue-pricelist-year</meta-name>
              <meta-value>2019</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>issue-copyright-holder</meta-name>
              <meta-value>The Author(s)</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>issue-copyright-year</meta-name>
              <meta-value>2019</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-contains-esm</meta-name>
              <meta-value>No</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-numbering-style</meta-name>
              <meta-value>Unnumbered</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-registration-date-year</meta-name>
              <meta-value>2019</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-registration-date-month</meta-name>
              <meta-value>5</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-registration-date-day</meta-name>
              <meta-value>29</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-toc-levels</meta-name>
              <meta-value>0</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>toc-levels</meta-name>
              <meta-value>0</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>volume-type</meta-name>
              <meta-value>Regular</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-product</meta-name>
              <meta-value>ArchiveJournal</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>numbering-style</meta-name>
              <meta-value>Unnumbered</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-grants-type</meta-name>
              <meta-value>OpenChoice</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>metadata-grant</meta-name>
              <meta-value>OpenAccess</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>abstract-grant</meta-name>
              <meta-value>OpenAccess</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>bodypdf-grant</meta-name>
              <meta-value>OpenAccess</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>bodyhtml-grant</meta-name>
              <meta-value>OpenAccess</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>bibliography-grant</meta-name>
              <meta-value>OpenAccess</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>esm-grant</meta-name>
              <meta-value>OpenAccess</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>online-first</meta-name>
              <meta-value>false</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>pdf-file-reference</meta-name>
              <meta-value>BodyRef/PDF/13321_2019_Article_361.pdf</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>target-type</meta-name>
              <meta-value>OnlinePDF</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>issue-type</meta-name>
              <meta-value>Regular</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>article-type</meta-name>
              <meta-value>OriginalPaper</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-subject-primary</meta-name>
              <meta-value>Chemistry</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-subject-secondary</meta-name>
              <meta-value>Computer Applications in Chemistry</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-subject-secondary</meta-name>
              <meta-value>Documentation and Information in Chemistry</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-subject-secondary</meta-name>
              <meta-value>Theoretical and Computational Chemistry</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-subject-secondary</meta-name>
              <meta-value>Computational Biology/Bioinformatics</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>journal-subject-collection</meta-name>
              <meta-value>Chemistry and Materials Science</meta-value>
            </custom-meta>
            <custom-meta>
              <meta-name>open-access</meta-name>
              <meta-value>true</meta-value>
            </custom-meta>
          </custom-meta-group>
        </article-meta>
      </front>
      <body>
        <sec id="Sec1">
          <title>Introduction</title>
          <p id="Par2">Functional groups (abbreviated FG) are an important concept of organic chemistry. They allow for a systematic and (in many cases) adequate molecular categorization according to a molecule’s reactivity and its chemical properties. Moreover, the FG concept may be successfully exploited across a wide range of molecular research, e.g. to construct quantitative structure–activity relationships (QSAR) in order to support drug discovery. In a recent publication [<xref ref-type="bibr" rid="CR1">1</xref>] Peter Ertl proposed a new purely rule-driven approach to identify FGs of an organic molecule. This effort may be regarded as the first genuine algorithmic method to tackle FG identification in contrast to the common manual FG definition performed by chemists. A first open implementation of the Ertl algorithm (denoted <italic>IFG</italic>—<italic>Identify Functional Groups</italic>) was realized by Guillaume Godin and Richard Hall for the RDKit package [<xref ref-type="bibr" rid="CR2">2</xref>].</p>
          <p id="Par3">In this work, the Ertl algorithm for automated FG detection and extraction is implemented on the basis of the Chemistry Development Kit (CDK) [<xref ref-type="bibr" rid="CR3">3</xref>–<xref ref-type="bibr" rid="CR6">6</xref>] with a new Java class <italic>ErtlFunctionalGroupsFinder</italic> to extend its open applicability for molecular research. The concrete CDK implementation and the distinct impact of the chosen CDK aromaticity model on FG detection as well as a comparison with the <italic>IFG</italic> RDKit implementation are discussed in detail. Due to the average performance of less than a millisecond for a single-molecule FG extraction using a single standard workstation processor core, <italic>ErtlFunctionalGroupsFinder</italic> may be used to process even large databases with a tenth of millions of molecules within an hour.</p>
        </sec>
        <sec id="Sec2">
          <title>Implementation details</title>
          <p id="Par4">The implementation of the Ertl algorithm is divided into three consecutive steps. Step I marks all atoms within a molecule that meet the Ertl rules. Step II detects groups of connected marked atoms and extracts each group as a FG including information about its environment. The final step III applies the Ertl generalization scheme to the detected FGs.</p>
        </sec>
        <sec id="Sec3">
          <title>Step I</title>
          <p id="Par5"><italic>AtomContainer</italic> is the basic molecule representation class of the CDK. In order to mark atoms according to the Ertl rules, atomic connectivity information of an <italic>AtomContainer</italic> has to be queried (e.g. ‘Is atom A connected to atom B?’). Since <italic>AtomContainer</italic> internally uses edge-lists the marking procedure would scale linearly with the number of a molecule’s bonds. To avoid this inefficiency, the CDK utility class <italic>GraphUtil</italic> is alternatively invoked to generate an adjacency list with a complementing edge-to-bond map for quick atomic connectivity access. The marking procedure iterates over all non-aromatic atoms of the molecule in the order given by its <italic>AtomContainer</italic>. Heteroatoms (unlike carbon or hydrogen) are identified by their atomic number, whereas for carbons all neighboring atoms and bonds are evaluated in a successive manner according to the Ertl rules. For special treatment in the following steps, aromatic heteroatoms are collected in a separate manner and marked carbons in carbonyl groups are specifically labeled. If not already the case, explicit hydrogens are set as an implicit property of the connected parent atoms. The iteration result is a set of marked atoms which acts as a basis for the following FG extraction in Step II.</p>
        </sec>
        <sec id="Sec4">
          <title>Step II</title>
          <p id="Par6">To identify groups of connected marked atoms in combination with their merger into FGs, a single unprocessed marked atom is picked as a starting point for a new FG. Then an iterative breadth-first search (BFS) based on the adjacency list explores all neighboring atoms and expands the group by adding connected marked atoms until unmarked carbons or aromatic heteroatoms are reached which form the FG’s environment. These terminal atoms are not included in the FG themselves but their aromaticity and bonding information is extracted and attributed to their connected marked atoms. The extraction process keeps the aromaticity assignments and molecular orbitals of the molecule under investigation. In addition, aromatic heteroatoms that are not included in a group are extracted separately as single-atom FGs. Once all marked atoms are processed, the complete list of FGs (including environmental carbon information) of the molecule is obtained in form of a list of <italic>AtomContainers</italic>.</p>
        </sec>
        <sec id="Sec5">
          <title>Step III</title>
          <p id="Par7">The final generalization step processes all extracted FGs separately according to the Ertl generalization scheme. Each FG is represented by an <italic>AtomContainer</italic> that contains marked atoms, their connecting bonds, and information on (former) neighboring environmental carbons. The information on environmental carbons comprises their location and their aromaticity as derived from the molecule under investigation. First, all exceptional cases are addressed where the FG contains a single marked atom only. This includes single-atomic nitrogen or oxygen FGs with one environmental carbon, simple thiols, and secondary amines or single aromatic hetero-atom FGs. Then an iteration over all atoms in the FG is performed. In case of a heteroatom, all hydrogens are replaced by new R-atoms which are implemented as instances of the <italic>PseudoAtom</italic> class—while oxygens in hydroxyl groups retain their hydrogens as an exception. According to the generalization scheme, any environmental information about carbon atoms is deleted with the exception of previously-labeled carbons in carbonyls which are replaced by R-atoms. The resulting generalized FGs of the molecule are finally returned as an <italic>AtomContainer</italic> list.</p>
          <p id="Par8"><italic>ErtlFunctionalGroupsFinder</italic> provides two basic processing modes which can be defined via the class constructor: The default <italic>generalization</italic> mode generalizes all detected FGs as outlined above whereas the <italic>no</italic>-<italic>generalization</italic> mode replaces generalization with an alternative outline of the environmental information with distinct atoms and bonds including their original aromaticity.</p>
        </sec>
        <sec id="Sec6">
          <title>Aromaticity models</title>
          <p id="Par9">For application of <italic>ErtlFunctionalGroupsFinder</italic>, a molecule has to be provided as an <italic>AtomContainer</italic> instance with well-defined CDK atom types and a distinct aromaticity model (electron donation type plus cycle finder algorithm for ring detection)—note that the <italic>AtomContainer</italic> instance is not allowed to contain any charged, metal or metalloid atoms or multiple unconnected structures as described in the preprocessing steps outlined in [<xref ref-type="bibr" rid="CR1">1</xref>]. The CDK provides four electron donation types: (1) <italic>ElectronDonation.cdk</italic>—CDK’s model which derives each atom’s electron contribution from the CDK atom types, (2) <italic>ElectronDonation.cdkAllowingExocyclic</italic>—as aforementioned but allows electron contributions from exocyclic pi-bonds, (3) <italic>ElectronDonation.piBonds</italic>—a simple model that only allows electron contributions from cyclic pi-bonds, and (4) <italic>ElectronDonation.daylight</italic>—a model that closely follows the one used by Daylight in the generation of SMILES. For ring detection, various cycle finder algorithms are available: <italic>Cycles.all</italic>, <italic>Cycles.mcb</italic>, <italic>Cycles.relevant</italic>, <italic>Cycles.essential</italic>, <italic>Cycles.tripleShort</italic>, <italic>Cycles.vertexShort</italic> and <italic>Cycles.edgeShort</italic>. The aromaticity model may distinctly influence FG detection since the marking procedure of step I depends on the separation of aromatic and aliphatic bonds/atoms as outlined above (see Fig. <xref rid="Fig1" ref-type="fig">1</xref>).<fig id="Fig1"><label>Fig. 1</label><caption xml:lang="en"><p>Influence of the different CDK electron donation types on FG detection (identified FGs are being highlighted by a colored background, the same cycle finder <italic>Cycles</italic>.<italic>all</italic> algorithm is used for all electron donation types). Left: The <italic>daylight</italic> electron donation type assigns a fully aromatic ring structure with corresponding FGs. Right: The electron donation types <italic>cdk, cdkAllowingExocyclic</italic> and <italic>piBonds</italic> assign an aromatic benzene ring plus an annulated aliphatic ring with only one resulting larger FG on the right (highlighted in pink) instead of three corresponding FGs (highlighted in red and orange) for the <italic>daylight</italic> electron donation</p></caption><graphic specific-use="web" mime-subtype="PNG" xlink:href="MediaObjects/13321_2019_361_Fig1_HTML.png" id="MO1" /></fig></p>
        </sec>
        <sec id="Sec7">
          <title>Results and discussion</title>
          <p id="Par10">The CDK implementation of the Ertl algorithm allows for a fast FG extraction. A performance snapshot with the <italic>ErtlFunctionalGroupsFinderPerformanceTest</italic> tool exhibits an in-memory processing speed of 74 s for 1.8 million ChEMBL compounds [<xref ref-type="bibr" rid="CR7">7</xref>, <xref ref-type="bibr" rid="CR8">8</xref>] using a single core of an Intel Xeon E5-2697 v2 workstation CPU [<xref ref-type="bibr" rid="CR9">9</xref>]. This corresponds to a single-core processing speed of more than 50 million molecules per hour. The FG extraction performance of parallelized <italic>ErtlFunctionalGroupsFinder</italic> threads with equal shares of the ChEMBL molecules (using the same hardware) is shown in Fig. <xref rid="Fig2" ref-type="fig">2</xref>: an initial distinct decrease of processing time flattens to only minor performance enhancements beyond four parallelized threads—the efficient FG extraction with four parallelized threads allows to process more than 150 million molecules per hour.<fig id="Fig2"><label>Fig. 2</label><caption xml:lang="en"><p>Performance snapshot of <italic>ErtlFunctionalGroupsFinder</italic> for FG extraction from 1.8 million ChEMBL compounds in dependence of the number of parallelized processing threads</p></caption><graphic specific-use="web" mime-subtype="PNG" xlink:href="MediaObjects/13321_2019_361_Fig2_HTML.png" id="MO2" /></fig></p>
          <p id="Par11">The <italic>ErtlFunctionalGroupsFinderEvaluationTest</italic> tool generates FG extraction results where FGs are represented as pseudo SMILES strings with aromatic atoms marked by an asterisk and pseudo-atoms indicated by character R. In a preliminary step <italic>ErtlFunctionalGroupsFinderEvaluationTest</italic> excludes molecules with metal or metalloid atoms, selects the largest part from compounds with multiple unconnected structures and neutralizes charged atoms. The latter is performed by zeroing the formal atomic charges and filling up free valences with hydrogen atoms (according to the CDK atom types). This procedure allows a more general charge treatment than a pre-defined transformation list but may produce “wrong” structures, e.g. it turns a nitro NO<sub>2</sub> group into pseudo SMILES “[H]O[N](= O)R” with an uncharged four-bonded nitrogen atom (other examples are “R[N](R)(R)R”, “[C]#[N]R” or “RS(R)(R)R”). Thus an improved charge neutralization scheme is desirable for future implementations. Figure <xref rid="Fig3" ref-type="fig">3</xref> shows the twenty most frequently detected FGs of 1.8 million ChEMBL compounds for the <italic>daylight</italic> electron donation in comparison to the findings with the three other electron donation types (cycle finder <italic>Cycles.</italic><italic>all</italic> algorithm is used which is substituted by <italic>Cycles.vertexShort</italic> in case of a CDK intractable exception).<fig id="Fig3"><label>Fig. 3</label><caption xml:lang="en"><p>Frequencies of the twenty most frequent FGs of 1.8 million ChEMBL compounds for different electron donation types with cycle finder <italic>Cycles.</italic><italic>all</italic></p></caption><graphic specific-use="web" mime-subtype="PNG" xlink:href="MediaObjects/13321_2019_361_Fig3_HTML.png" id="MO3" /></fig></p>
          <p id="Par12">The most common FG for <italic>daylight</italic> electron donation is a tertiary amine with an aromatic central nitrogen atom, followed by an ether group, an amide group and a tertiary amine with a non-aromatic central atom. Differences between the four electron donation types are obvious with some striking examples: The “O=C*” FG (representing a carbonyl group containing an aromatic carbon atom) is frequent for the <italic>daylight</italic> and <italic>cdkAllowingExocyclic</italic> type but does not appear at all for <italic>cdk</italic> and <italic>piBonds.</italic> The <italic>cdk</italic> type does not allow atoms with exocyclic double or triple bonds in aromatic systems. Therefore, a carbon atom connected to carbonyl oxygen is not considered aromatic in any case. For <italic>piBonds</italic> all possibly aromatic atoms must be connected to a cyclic pi-bond which is impossible for the carbon atom in a carbonyl group (and also for oxygen and sulfur atoms, compare FGs “RO*R” and “RS*R” in Fig. <xref rid="Fig3" ref-type="fig">3</xref>). Type <italic>cdkAllowingExocyclic</italic>, on the other hand, allows electron contributions from exocyclic pi-bonds and the <italic>daylight</italic> type tolerates a carbonyl carbon in an aromatic system but considers its electron contribution to be zero since the oxygen atom is more electronegative. The detected most frequent ChEMBL FGs are in correspondence with the findings in [<xref ref-type="bibr" rid="CR1">1</xref>] obtained from a specific bioactive subset of ChEMBL. The most frequent “RN*(R)R” aromatic amine FG is not explicitly mentioned in [<xref ref-type="bibr" rid="CR1">1</xref>] but published in the supplementary file.</p>
          <p id="Par13">Figure <xref rid="Fig4" ref-type="fig">4</xref> depicts the cycle finder algorithm influence on the resulting FG frequencies for the <italic>daylight</italic> electron donation type with a subset of the available CDK cycle finder algorithms. Compared to the differences between the electron donation types, the cycle finder algorithm influence is of minor importance but nonetheless leads to deviations of about 4% in FG frequencies (e.g. the frequency of ‘RS*R’ varies between 187,503 and 194,136 molecules containing this functional group).<fig id="Fig4"><label>Fig. 4</label><caption xml:lang="en"><p>Frequencies of the twenty most frequent FGs of 1.8 million ChEMBL compounds for different cycle finder algorithms and the <italic>daylight</italic> electron donation model</p></caption><graphic specific-use="web" mime-subtype="PNG" xlink:href="MediaObjects/13321_2019_361_Fig4_HTML.png" id="MO4" /></fig></p>
          <p id="Par14">We originally intended this article to purely describe our CDK implementation of the Ertl algorithm. During the publication process, one of the reviewers requested a comparison with the open <italic>IFG</italic> RDKit implementation, not in terms of the execution time but in terms of providing similar results. We agreed to include the following evaluation of both implementations, but would like to highlight some caveats. A direct one-to-one FG detection comparison of <italic>ErtlFunctionalGroupsFinder</italic> with the <italic>IFG</italic> RDKit implementation suffers from the fact that <italic>IFG</italic> RDKit does not provide generalized FGs according to the Ertl generalization scheme. But the resulting <italic>IFG</italic> RDKit SMILES string with only marked atoms can be regarded as an approximated generalized FG representation (since it does not contain environmental information) thus it can be mapped to a set of multiple pseudo SMILES FGs generated by <italic>ErtlFunctionalGroupsFinderEvaluationTest</italic>. As an example the <italic>IFG</italic> RDKit SMILES string “O=CO” represents a carboxyl group, an ester group and a formic acid ester group which correspond to pseudo SMILES FGs “[H]OC(=O)R”, “O=C(R)OR” and “O=[C]OR” of <italic>ErtlFunctionalGroupsFinderEvaluationTest</italic>. Figure <xref rid="Fig5" ref-type="fig">5</xref> shows the comparison for the twenty most frequent FGs detected in 1.8 million ChEMBL compounds using <italic>IFG</italic> RDKit with the AROMATICITY_RDKIT aromaticity model (plus standard RDKit valence model and standard cycle finder algorithm): Each <italic>IFG</italic> RDKit FG is represented by the corresponding set of <italic>ErtlFunctionalGroupsFinderEvaluationTest</italic> pseudo SMILES FGs with their individual frequencies summed up.<fig id="Fig5"><label>Fig. 5</label><caption xml:lang="en"><p>Comparison of FG detection between <italic>ErtlFunctionalGroupsFinder</italic> (blue bars) and <italic>IFG</italic> RDKit (green bars) for different aromaticity/electron donation models (the RDKit aromaticity model labels are abbreviated like <italic>IFG AROMATICITY_RDKIT</italic> to simply <italic>IFG RDKIT</italic>). For details see text</p></caption><graphic specific-use="web" mime-subtype="PNG" xlink:href="MediaObjects/13321_2019_361_Fig5_HTML.png" id="MO5" /></fig></p>
          <p id="Par15">The FG detection results of both implementations are in good general agreement: The most common FG detected by <italic>IFG</italic> RDKit is “O” (representing a single oxygen atom with unknown connections). It equals the generalized <italic>ErtlFunctionalGroupsFinderEvaluationTest</italic> FGs representing an ether group (pseudo SMILES “ROR”), hydroxyl groups connected to aromatic carbon atoms (pseudo SMILES “[H]OC*”) or aliphatic carbon atoms (pseudo SMILES “[H]O[C]”) and a carbonyl group containing an aromatic carbon atom (pseudo SMILES “O = C*”). A striking deviation is the chemically meaningful FG “RN*(R)N*(R)R” which represents two bonded aromatic nitrogen atoms (e.g. found in pyridazine): While this FG is frequently detected with <italic>IFG</italic> RDKit it is not at all found by <italic>ErtlFunctionalGroupsFinder</italic>—but this detection failure of the latter is in concordance with the Ertl algorithm which defines that aromatic heteroatoms are to be collected as single atoms if no aliphatic group is connected. Last but not least the total numbers of different identified FGs are smaller for <italic>IFG</italic> RDKit (11.000 with <italic>AROMATICITY_RDKIT</italic> up to 43.000 with <italic>AROMATICITY_MDL</italic>) compared to <italic>ErtlFunctionalGroupsFinder</italic> (41.000 with <italic>daylight</italic> up to 134.000 with <italic>piBonds</italic>) which can be traced to the different FG output representations.</p>
          <p id="Par16">As a résumé, chemical FG detection remains challenging—and different open implementations of the Ertl algorithm are a true virtue, not only for general comparisons but especially for their different oddities and subtleties. For example, the <italic>ErtlFunctionalGroupsFinderEvaluationTest</italic> pseudo SMILES FG “R[N]R” is not straight forward to comprehend, the same applies to “[S]R”, “O=C(R)[N]R” or “O=[C]R” (the latter does not represent an aldehyde group since this FG is represented by “[C]=O” thus it may be an artefact due to a SD file error or originate from an amide group containing an aromatic nitrogen atom). Further investigations of these rare problems may lead to an improved structural pre-processing as well as possible useful extensions of the Ertl FG detection rules.</p>
          <p id="Par17">The numerous possible applications of FG detection in molecular research are widespread: FGs may be regarded as “intrinsic seeds” for proper fragmentation of molecules. The FG sets of single molecules up to large molecule collections can be regarded as chemically meaningful “feature vectors” or “fingerprints”: This qualifies their use for molecular comparison, clustering/classification or ranking purposes (e.g. based on “overlap in FG space”) and may substantially improve QSAR/QSPR research, especially the growing and increasingly complex machine learning approaches.</p>
          <p id="Par18">The <italic>ErtlFunctionalGroupsFinder</italic> LGPL Java class code is openly available from its project page. It is recommended to place this java class in the <italic>tools</italic> package of the <italic>cdk</italic>-<italic>extra</italic> module. <italic>ErtlFunctionalGroupsFinder</italic> depends only on CDK base classes and interfaces as well as <italic>GraphUtil</italic> for quick connectivity queries. Unit tests for 20 compounds given in [<xref ref-type="bibr" rid="CR1">1</xref>] (with the <italic>daylight</italic> electron donation model and cycle finder <italic>Cylces.all</italic> for aromaticity detection) are implemented: They demonstrate adequate FG extraction of the new implementation by comparison of the expected FGs according to the Ertl rules with the actual results. The open tools <italic>ErtlFunctionalGroupsFinderPerformanceTest</italic> and <italic>ErtlFunctionalGroupsFinderEvaluationTest</italic> provide detailed sample code for using the new functionality. An integration into future CDK releases is requested and will hopefully be approved by the CDK community.</p>
        </sec>
      </body>
      <back>
        <ack>
          <title>Acknowledgements</title>
          <p>The authors like to thank Peter Ertl for describing his algorithm in a way that allowed easy re-implementation. This is not always the case. We also thank him for valuable discussions. We appreciate help from Egon Willighagen and John Mayfield with the CDK integration and from Felix Bänsch for unbiased release testing.</p>
        </ack>
        <sec sec-type="author-contribution">
          <title>Authors’ contributions</title>
          <p>CS initiated the project. SF designed and implemented the new code. JS contributed to the test code, performed the FG frequency distribution analysis and the run time measurements. SN, CS, and AZ lead the project development. All authors read and approved the final manuscript.</p>
        </sec>
        <sec>
          <title>Funding</title>
          <p>Not applicable.</p>
        </sec>
        <sec sec-type="data-availability">
          <title>Availability of data and materials</title>
          <p>Project name: ErtlFunctionalGroupsFinder. Project home page: <ext-link xlink:href="https://github.com/zielesny/ErtlFunctionalGroupsFinder" ext-link-type="uri">https://github.com/zielesny/ErtlFunctionalGroupsFinder</ext-link>. Operating system(s): Platform independent. Programming language: Java. Other requirements: None. License: LGPL.</p>
        </sec>
        <sec sec-type="ethics-statement">
          <sec id="FPar3">
            <title>Ethics approval and consent to participate</title>
            <p id="Par21">Not applicable.</p>
          </sec>
          <sec id="FPar4" sec-type="COI-statement">
            <title>Competing interests</title>
            <p id="Par22">The authors declare that they have no competing interests.</p>
          </sec>
        </sec>
        <ref-list id="Bib1">
          <title>References</title>
          <ref-list>
            <ref id="CR1">
              <label>1.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Ertl</surname>
                    <given-names>P</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">An algorithm to identify functional groups in organic molecules</article-title>
                <source>J Cheminform</source>
                <year>2017</year>
                <volume>9</volume>
                <fpage>36</fpage>
                <pub-id pub-id-type="doi">10.1186/s13321-017-0225-z</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR2">
              <label>2.</label>
              <mixed-citation publication-type="other">RDKit. <ext-link xlink:href="https://github.com/rdkit/rdkit/releases/tag/Release_2018_03_1" ext-link-type="uri">https://github.com/rdkit/rdkit/releases/tag/Release_2018_03_1</ext-link> and <ext-link xlink:href="https://github.com/rdkit/rdkit/tree/master/Contrib/IFG" ext-link-type="uri">https://github.com/rdkit/rdkit/tree/master/Contrib/IFG</ext-link>. Accessed 15 Feb 2019</mixed-citation>
            </ref>
            <ref id="CR3">
              <label>3.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Steinbeck</surname>
                    <given-names>C</given-names>
                  </name>
                  <name>
                    <surname>Han</surname>
                    <given-names>Y</given-names>
                  </name>
                  <name>
                    <surname>Kuhn</surname>
                    <given-names>S</given-names>
                  </name>
                  <name>
                    <surname>Horlacher</surname>
                    <given-names>O</given-names>
                  </name>
                  <name>
                    <surname>Luttmann</surname>
                    <given-names>E</given-names>
                  </name>
                  <name>
                    <surname>Willighagen</surname>
                    <given-names>EL</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">The Chemistry Development Kit (CDK): an open-source java library for chemo- and bioinformatics</article-title>
                <source>J Chem Inform Comput Sci</source>
                <year>2003</year>
                <volume>43</volume>
                <issue>2</issue>
                <fpage>493</fpage>
                <lpage>500</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BD3sXhtVaktbg%3D</pub-id>
                <pub-id pub-id-type="doi">10.1021/ci025584y</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR4">
              <label>4.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Steinbeck</surname>
                    <given-names>C</given-names>
                  </name>
                  <name>
                    <surname>Hoppe</surname>
                    <given-names>C</given-names>
                  </name>
                  <name>
                    <surname>Kuhn</surname>
                    <given-names>S</given-names>
                  </name>
                  <name>
                    <surname>Floris</surname>
                    <given-names>M</given-names>
                  </name>
                  <name>
                    <surname>Guha</surname>
                    <given-names>R</given-names>
                  </name>
                  <name>
                    <surname>Willighagen</surname>
                    <given-names>EL</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Recent developments of the Chemistry Development Kit (CDK)—an open-source java library for chemo- and bioinformatics</article-title>
                <source>Curr Pharm Des</source>
                <year>2006</year>
                <volume>12</volume>
                <issue>17</issue>
                <fpage>2111</fpage>
                <lpage>2120</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BD28XmslWqsL0%3D</pub-id>
                <pub-id pub-id-type="doi">10.2174/138161206777585274</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR5">
              <label>5.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>May</surname>
                    <given-names>JW</given-names>
                  </name>
                  <name>
                    <surname>Steinbeck</surname>
                    <given-names>C</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">Efficient ring perception for the Chemistry Development Kit</article-title>
                <source>J Cheminform</source>
                <year>2014</year>
                <volume>6</volume>
                <fpage>3</fpage>
                <pub-id pub-id-type="doi">10.1186/1758-2946-6-3</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR6">
              <label>6.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Willighagen</surname>
                    <given-names>EL</given-names>
                  </name>
                  <name>
                    <surname>Mayfield</surname>
                    <given-names>JW</given-names>
                  </name>
                  <name>
                    <surname>Alvarsson</surname>
                    <given-names>J</given-names>
                  </name>
                  <name>
                    <surname>Berg</surname>
                    <given-names>A</given-names>
                  </name>
                  <name>
                    <surname>Carlsson</surname>
                    <given-names>L</given-names>
                  </name>
                  <name>
                    <surname>Jeliazkova</surname>
                    <given-names>N</given-names>
                  </name>
                  <name>
                    <surname>Kuhn</surname>
                    <given-names>S</given-names>
                  </name>
                  <name>
                    <surname>Pluska</surname>
                    <given-names>T</given-names>
                  </name>
                  <name>
                    <surname>Rojas-Chertó</surname>
                    <given-names>M</given-names>
                  </name>
                  <name>
                    <surname>Spjuth</surname>
                    <given-names>O</given-names>
                  </name>
                  <name>
                    <surname>Torrance</surname>
                    <given-names>G</given-names>
                  </name>
                  <name>
                    <surname>Evelo</surname>
                    <given-names>CT</given-names>
                  </name>
                  <name>
                    <surname>Guha</surname>
                    <given-names>R</given-names>
                  </name>
                  <name>
                    <surname>Steinbeck</surname>
                    <given-names>C</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">The Chemistry Development Kit (CDK) v2.0: atom typing, depiction, molecular formulas, and substructure searching</article-title>
                <source>J Cheminform</source>
                <year>2017</year>
                <volume>9</volume>
                <fpage>33</fpage>
                <pub-id pub-id-type="doi">10.1186/s13321-017-0220-4</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR7">
              <label>7.</label>
              <mixed-citation publication-type="journal">
                <person-group person-group-type="author">
                  <name>
                    <surname>Gaulton</surname>
                    <given-names>A</given-names>
                  </name>
                  <name>
                    <surname>Hersey</surname>
                    <given-names>A</given-names>
                  </name>
                  <name>
                    <surname>Nowotka</surname>
                    <given-names>M</given-names>
                  </name>
                  <name>
                    <surname>Bento</surname>
                    <given-names>AP</given-names>
                  </name>
                  <name>
                    <surname>Chambers</surname>
                    <given-names>J</given-names>
                  </name>
                  <name>
                    <surname>Mendez</surname>
                    <given-names>D</given-names>
                  </name>
                  <name>
                    <surname>Mutowo</surname>
                    <given-names>P</given-names>
                  </name>
                  <name>
                    <surname>Atkinson</surname>
                    <given-names>F</given-names>
                  </name>
                  <name>
                    <surname>Bellis</surname>
                    <given-names>LJ</given-names>
                  </name>
                  <name>
                    <surname>Cibrián-Uhalte</surname>
                    <given-names>E</given-names>
                  </name>
                  <name>
                    <surname>Davies</surname>
                    <given-names>M</given-names>
                  </name>
                  <name>
                    <surname>Dedman</surname>
                    <given-names>N</given-names>
                  </name>
                  <name>
                    <surname>Karlsson</surname>
                    <given-names>A</given-names>
                  </name>
                  <name>
                    <surname>Magariños</surname>
                    <given-names>MP</given-names>
                  </name>
                  <name>
                    <surname>Overington</surname>
                    <given-names>JP</given-names>
                  </name>
                  <name>
                    <surname>Papadatos</surname>
                    <given-names>G</given-names>
                  </name>
                  <name>
                    <surname>Smit</surname>
                    <given-names>I</given-names>
                  </name>
                  <name>
                    <surname>Leach</surname>
                    <given-names>AR</given-names>
                  </name>
                </person-group>
                <article-title xml:lang="en">The ChEMBL database in 2017</article-title>
                <source>Nucleic Acids Res</source>
                <year>2017</year>
                <volume>45</volume>
                <issue>D1</issue>
                <fpage>D945</fpage>
                <lpage>D954</lpage>
                <pub-id pub-id-type="other" assigning-authority="ChemPort ( Chemical Abstract Service )">1:CAS:528:DC%2BC1cXhslWhurs%3D</pub-id>
                <pub-id pub-id-type="doi">10.1093/nar/gkw1074</pub-id>
              </mixed-citation>
            </ref>
            <ref id="CR8">
              <label>8.</label>
              <mixed-citation publication-type="other">ChEMBL database SD-file chembl_24_1.sdf.gz.ftp://ftp.ebi.ac.uk/pub/databases/chembl/ChEMBLdb/latest/chembl_24_1.sdf. Accessed 21 Jan 2019</mixed-citation>
            </ref>
            <ref id="CR9">
              <label>9.</label>
              <mixed-citation publication-type="other">Product specification Intel Xeon Processor E5 2697 v2. <ext-link xlink:href="https://ark.intel.com/products/75283/Intel-Xeon-Processor-E5-2697-v2-30M-Cache-2_70-GHz" ext-link-type="uri">https://ark.intel.com/products/75283/Intel-Xeon-Processor-E5-2697-v2-30M-Cache-2_70-GHz</ext-link>. Accessed 18 April 2018</mixed-citation>
            </ref>
          </ref-list>
        </ref-list>
        <notes notes-type="Misc">
          <title>Publisher's Note</title>
          <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
        </notes>
      </back>
    </article>
